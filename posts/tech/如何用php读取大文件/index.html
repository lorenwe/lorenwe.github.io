<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>å¦‚ä½•ç”¨PHPè¯»å–å¤§æ–‡ä»¶ | Lorenwe Blog</title>
<meta name=keywords content="PHP,å¤§æ–‡ä»¶"><meta name=description content="åœ¨ GitHub ä¸Šå¯ä»¥æ‰¾åˆ°æœ¬æ•™ç¨‹çš„æºç ã€‚
è¡¡é‡æˆåŠŸçš„æ ‡å‡†
ç¡®ä¿æˆ‘ä»¬å¯¹ä»£ç æœ‰æ”¹è¿›çš„å”¯ä¸€æ–¹æ³•æ˜¯æµ‹è¯•ä¸€ä¸ªä¸å¥½çš„æƒ…å†µï¼Œç„¶åå°†æˆ‘ä»¬ä¿®å¤ä¹‹åçš„æµ‹é‡ä¸å¦ä¸€ä¸ªè¿›è¡Œæ¯”è¾ƒã€‚æ¢å¥è¯è¯´ï¼Œé™¤éæˆ‘ä»¬çŸ¥é“â€œè§£å†³æ–¹æ¡ˆâ€å¯¹æˆ‘ä»¬æœ‰å¤šå¤§çš„å¸®åŠ©ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ï¼Œå¦åˆ™æˆ‘ä»¬ä¸çŸ¥é“å®ƒæ˜¯å¦çœŸçš„æ˜¯ä¸€ä¸ªè§£å†³æ–¹æ¡ˆã€‚
è¿™é‡Œæœ‰ä¸¤ä¸ªæˆ‘ä»¬å¯ä»¥å…³ç³»çš„è¡¡é‡æ ‡å‡†ã€‚é¦–å…ˆæ˜¯CPUä½¿ç”¨ç‡ã€‚æˆ‘ä»¬è¦å¤„ç†çš„è¿›ç¨‹æœ‰å¤šå¿«æˆ–å¤šæ…¢ï¼Ÿç¬¬äºŒæ˜¯å†…å­˜ä½¿ç”¨æƒ…å†µã€‚è„šæœ¬æ‰§è¡Œæ—¶éœ€è¦å¤šå°‘å†…å­˜ï¼Ÿè¿™ä¸¤ä¸ªé€šå¸¸æ˜¯æˆåæ¯”çš„ - è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ä»¥CPUä½¿ç”¨ç‡ä¸ºä»£ä»·æ¥é™ä½å†…å­˜ä½¿ç”¨ï¼Œåä¹‹äº¦ç„¶ã€‚"><meta name=author content="Lorenwe"><link rel=canonical href=https://lorenwe.eu.org/posts/tech/%E5%A6%82%E4%BD%95%E7%94%A8php%E8%AF%BB%E5%8F%96%E5%A4%A7%E6%96%87%E4%BB%B6/><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.js onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://lorenwe.eu.org/img/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://lorenwe.eu.org/img/favicon.ico><link rel=icon type=image/png sizes=32x32 href=https://lorenwe.eu.org/img/favicon.ico><link rel=apple-touch-icon href=https://lorenwe.eu.org/img/favicon.ico><link rel=mask-icon href=https://lorenwe.eu.org/img/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://lorenwe.eu.org/posts/tech/%E5%A6%82%E4%BD%95%E7%94%A8php%E8%AF%BB%E5%8F%96%E5%A4%A7%E6%96%87%E4%BB%B6/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/4.7.0/css/font-awesome.min.css><script src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><script src=https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/jquery/3.6.0/jquery.min.js></script><meta property="og:title" content="å¦‚ä½•ç”¨PHPè¯»å–å¤§æ–‡ä»¶"><meta property="og:description" content="åœ¨ GitHub ä¸Šå¯ä»¥æ‰¾åˆ°æœ¬æ•™ç¨‹çš„æºç ã€‚
è¡¡é‡æˆåŠŸçš„æ ‡å‡†
ç¡®ä¿æˆ‘ä»¬å¯¹ä»£ç æœ‰æ”¹è¿›çš„å”¯ä¸€æ–¹æ³•æ˜¯æµ‹è¯•ä¸€ä¸ªä¸å¥½çš„æƒ…å†µï¼Œç„¶åå°†æˆ‘ä»¬ä¿®å¤ä¹‹åçš„æµ‹é‡ä¸å¦ä¸€ä¸ªè¿›è¡Œæ¯”è¾ƒã€‚æ¢å¥è¯è¯´ï¼Œé™¤éæˆ‘ä»¬çŸ¥é“â€œè§£å†³æ–¹æ¡ˆâ€å¯¹æˆ‘ä»¬æœ‰å¤šå¤§çš„å¸®åŠ©ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ï¼Œå¦åˆ™æˆ‘ä»¬ä¸çŸ¥é“å®ƒæ˜¯å¦çœŸçš„æ˜¯ä¸€ä¸ªè§£å†³æ–¹æ¡ˆã€‚
è¿™é‡Œæœ‰ä¸¤ä¸ªæˆ‘ä»¬å¯ä»¥å…³ç³»çš„è¡¡é‡æ ‡å‡†ã€‚é¦–å…ˆæ˜¯CPUä½¿ç”¨ç‡ã€‚æˆ‘ä»¬è¦å¤„ç†çš„è¿›ç¨‹æœ‰å¤šå¿«æˆ–å¤šæ…¢ï¼Ÿç¬¬äºŒæ˜¯å†…å­˜ä½¿ç”¨æƒ…å†µã€‚è„šæœ¬æ‰§è¡Œæ—¶éœ€è¦å¤šå°‘å†…å­˜ï¼Ÿè¿™ä¸¤ä¸ªé€šå¸¸æ˜¯æˆåæ¯”çš„ - è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ä»¥CPUä½¿ç”¨ç‡ä¸ºä»£ä»·æ¥é™ä½å†…å­˜ä½¿ç”¨ï¼Œåä¹‹äº¦ç„¶ã€‚"><meta property="og:type" content="article"><meta property="og:url" content="https://lorenwe.eu.org/posts/tech/%E5%A6%82%E4%BD%95%E7%94%A8php%E8%AF%BB%E5%8F%96%E5%A4%A7%E6%96%87%E4%BB%B6/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-09-25T16:20:33+08:00"><meta property="article:modified_time" content="2024-09-25T16:20:33+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="å¦‚ä½•ç”¨PHPè¯»å–å¤§æ–‡ä»¶"><meta name=twitter:description content="åœ¨ GitHub ä¸Šå¯ä»¥æ‰¾åˆ°æœ¬æ•™ç¨‹çš„æºç ã€‚
è¡¡é‡æˆåŠŸçš„æ ‡å‡†
ç¡®ä¿æˆ‘ä»¬å¯¹ä»£ç æœ‰æ”¹è¿›çš„å”¯ä¸€æ–¹æ³•æ˜¯æµ‹è¯•ä¸€ä¸ªä¸å¥½çš„æƒ…å†µï¼Œç„¶åå°†æˆ‘ä»¬ä¿®å¤ä¹‹åçš„æµ‹é‡ä¸å¦ä¸€ä¸ªè¿›è¡Œæ¯”è¾ƒã€‚æ¢å¥è¯è¯´ï¼Œé™¤éæˆ‘ä»¬çŸ¥é“â€œè§£å†³æ–¹æ¡ˆâ€å¯¹æˆ‘ä»¬æœ‰å¤šå¤§çš„å¸®åŠ©ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ï¼Œå¦åˆ™æˆ‘ä»¬ä¸çŸ¥é“å®ƒæ˜¯å¦çœŸçš„æ˜¯ä¸€ä¸ªè§£å†³æ–¹æ¡ˆã€‚
è¿™é‡Œæœ‰ä¸¤ä¸ªæˆ‘ä»¬å¯ä»¥å…³ç³»çš„è¡¡é‡æ ‡å‡†ã€‚é¦–å…ˆæ˜¯CPUä½¿ç”¨ç‡ã€‚æˆ‘ä»¬è¦å¤„ç†çš„è¿›ç¨‹æœ‰å¤šå¿«æˆ–å¤šæ…¢ï¼Ÿç¬¬äºŒæ˜¯å†…å­˜ä½¿ç”¨æƒ…å†µã€‚è„šæœ¬æ‰§è¡Œæ—¶éœ€è¦å¤šå°‘å†…å­˜ï¼Ÿè¿™ä¸¤ä¸ªé€šå¸¸æ˜¯æˆåæ¯”çš„ - è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ä»¥CPUä½¿ç”¨ç‡ä¸ºä»£ä»·æ¥é™ä½å†…å­˜ä½¿ç”¨ï¼Œåä¹‹äº¦ç„¶ã€‚"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"ğŸ“šæ–‡ç« ","item":"https://lorenwe.eu.org/posts/"},{"@type":"ListItem","position":2,"name":"ğŸ‘¨ğŸ»â€ğŸ’» æŠ€æœ¯","item":"https://lorenwe.eu.org/posts/tech/"},{"@type":"ListItem","position":3,"name":"å¦‚ä½•ç”¨PHPè¯»å–å¤§æ–‡ä»¶","item":"https://lorenwe.eu.org/posts/tech/%E5%A6%82%E4%BD%95%E7%94%A8php%E8%AF%BB%E5%8F%96%E5%A4%A7%E6%96%87%E4%BB%B6/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"å¦‚ä½•ç”¨PHPè¯»å–å¤§æ–‡ä»¶","name":"å¦‚ä½•ç”¨PHPè¯»å–å¤§æ–‡ä»¶","description":"åœ¨ GitHub ä¸Šå¯ä»¥æ‰¾åˆ°æœ¬æ•™ç¨‹çš„æºç ã€‚\nè¡¡é‡æˆåŠŸçš„æ ‡å‡† ç¡®ä¿æˆ‘ä»¬å¯¹ä»£ç æœ‰æ”¹è¿›çš„å”¯ä¸€æ–¹æ³•æ˜¯æµ‹è¯•ä¸€ä¸ªä¸å¥½çš„æƒ…å†µï¼Œç„¶åå°†æˆ‘ä»¬ä¿®å¤ä¹‹åçš„æµ‹é‡ä¸å¦ä¸€ä¸ªè¿›è¡Œæ¯”è¾ƒã€‚æ¢å¥è¯è¯´ï¼Œé™¤éæˆ‘ä»¬çŸ¥é“â€œè§£å†³æ–¹æ¡ˆâ€å¯¹æˆ‘ä»¬æœ‰å¤šå¤§çš„å¸®åŠ©ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ï¼Œå¦åˆ™æˆ‘ä»¬ä¸çŸ¥é“å®ƒæ˜¯å¦çœŸçš„æ˜¯ä¸€ä¸ªè§£å†³æ–¹æ¡ˆã€‚\nè¿™é‡Œæœ‰ä¸¤ä¸ªæˆ‘ä»¬å¯ä»¥å…³ç³»çš„è¡¡é‡æ ‡å‡†ã€‚é¦–å…ˆæ˜¯CPUä½¿ç”¨ç‡ã€‚æˆ‘ä»¬è¦å¤„ç†çš„è¿›ç¨‹æœ‰å¤šå¿«æˆ–å¤šæ…¢ï¼Ÿç¬¬äºŒæ˜¯å†…å­˜ä½¿ç”¨æƒ…å†µã€‚è„šæœ¬æ‰§è¡Œæ—¶éœ€è¦å¤šå°‘å†…å­˜ï¼Ÿè¿™ä¸¤ä¸ªé€šå¸¸æ˜¯æˆåæ¯”çš„ - è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ä»¥CPUä½¿ç”¨ç‡ä¸ºä»£ä»·æ¥é™ä½å†…å­˜ä½¿ç”¨ï¼Œåä¹‹äº¦ç„¶ã€‚\n","keywords":["PHP","å¤§æ–‡ä»¶"],"articleBody":"åœ¨ GitHub ä¸Šå¯ä»¥æ‰¾åˆ°æœ¬æ•™ç¨‹çš„æºç ã€‚\nè¡¡é‡æˆåŠŸçš„æ ‡å‡† ç¡®ä¿æˆ‘ä»¬å¯¹ä»£ç æœ‰æ”¹è¿›çš„å”¯ä¸€æ–¹æ³•æ˜¯æµ‹è¯•ä¸€ä¸ªä¸å¥½çš„æƒ…å†µï¼Œç„¶åå°†æˆ‘ä»¬ä¿®å¤ä¹‹åçš„æµ‹é‡ä¸å¦ä¸€ä¸ªè¿›è¡Œæ¯”è¾ƒã€‚æ¢å¥è¯è¯´ï¼Œé™¤éæˆ‘ä»¬çŸ¥é“â€œè§£å†³æ–¹æ¡ˆâ€å¯¹æˆ‘ä»¬æœ‰å¤šå¤§çš„å¸®åŠ©ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ï¼Œå¦åˆ™æˆ‘ä»¬ä¸çŸ¥é“å®ƒæ˜¯å¦çœŸçš„æ˜¯ä¸€ä¸ªè§£å†³æ–¹æ¡ˆã€‚\nè¿™é‡Œæœ‰ä¸¤ä¸ªæˆ‘ä»¬å¯ä»¥å…³ç³»çš„è¡¡é‡æ ‡å‡†ã€‚é¦–å…ˆæ˜¯CPUä½¿ç”¨ç‡ã€‚æˆ‘ä»¬è¦å¤„ç†çš„è¿›ç¨‹æœ‰å¤šå¿«æˆ–å¤šæ…¢ï¼Ÿç¬¬äºŒæ˜¯å†…å­˜ä½¿ç”¨æƒ…å†µã€‚è„šæœ¬æ‰§è¡Œæ—¶éœ€è¦å¤šå°‘å†…å­˜ï¼Ÿè¿™ä¸¤ä¸ªé€šå¸¸æ˜¯æˆåæ¯”çš„ - è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ä»¥CPUä½¿ç”¨ç‡ä¸ºä»£ä»·æ¥é™ä½å†…å­˜ä½¿ç”¨ï¼Œåä¹‹äº¦ç„¶ã€‚\nåœ¨ä¸€ä¸ªå¼‚æ­¥æ‰§è¡Œæ¨¡å‹ï¼ˆå¦‚å¤šè¿›ç¨‹æˆ–å¤šçº¿ç¨‹çš„PHPåº”ç”¨ç¨‹åºï¼‰ä¸­ï¼ŒCPUå’Œå†…å­˜çš„ä½¿ç”¨ç‡æ˜¯å¾ˆé‡è¦çš„è€ƒé‡å› ç´ ã€‚åœ¨ä¼ ç»Ÿçš„PHPæ¶æ„ä¸­ï¼Œå½“ä»»ä½•ä¸€ä¸ªå€¼è¾¾åˆ°æœåŠ¡å™¨çš„æé™æ—¶ï¼Œè¿™äº›é€šå¸¸éƒ½ä¼šæˆä¸ºé—®é¢˜ã€‚\næµ‹é‡PHPå†…çš„CPUä½¿ç”¨ç‡æ˜¯ä¸åˆ‡å®é™…çš„ã€‚å¦‚æœè¿™æ˜¯ä½ è¦å…³æ³¨çš„é¢†åŸŸï¼Œè¯·è€ƒè™‘åœ¨Ubuntuæˆ–MacOSä¸Šä½¿ç”¨ç±»ä¼¼topçš„å·¥å…·ã€‚å¯¹äºWindowsï¼Œè¯·è€ƒè™‘ä½¿ç”¨Linuxå­ç³»ç»Ÿï¼Œä»¥ä¾¿åœ¨Ubuntuä¸­ä½¿ç”¨topã€‚\nä¸ºäº†æœ¬æ•™ç¨‹çš„ç›®çš„ï¼Œæˆ‘ä»¬å°†æµ‹é‡å†…å­˜ä½¿ç”¨æƒ…å†µã€‚æˆ‘ä»¬å°†çœ‹çœ‹åœ¨â€œä¼ ç»Ÿâ€çš„è„šæœ¬ä¸­ä½¿ç”¨äº†å¤šå°‘å†…å­˜ã€‚æˆ‘ä»¬å°†æ‰§è¡Œä¸€äº›ä¼˜åŒ–ç­–ç•¥å¹¶å¯¹å…¶è¿›è¡Œåº¦é‡ã€‚æœ€åï¼Œæˆ‘å¸Œæœ›ä½ èƒ½å¤Ÿåšå‡ºä¸€ä¸ªæœ‰ç»éªŒçš„é€‰æ‹©ã€‚ æˆ‘ä»¬æŸ¥çœ‹å†…å­˜ä½¿ç”¨å¤šå°‘çš„æ–¹æ³•æ˜¯ï¼š\n// formatBytes is taken from the php.net documentation memory_get_peak_usage(); function formatBytes($bytes, $precision = 2) { $units = array(\"b\", \"kb\", \"mb\", \"gb\", \"tb\"); $bytes = max($bytes, 0); $pow = floor(($bytes ? log($bytes) : 0) / log(1024)); $pow = min($pow, count($units) - 1); $bytes /= (1 \u003c\u003c (10 * $pow)); return round($bytes, $precision) . \" \" . $units[$pow]; } æˆ‘ä»¬å°†åœ¨è„šæœ¬çš„æœ€åä½¿ç”¨è¿™äº›å‡½æ•°ï¼Œä»¥ä¾¿æˆ‘ä»¬èƒ½å¤Ÿçœ‹åˆ°å“ªä¸ªè„šæœ¬ä¸€æ¬¡ä½¿ç”¨æœ€å¤§çš„å†…å­˜ã€‚\næˆ‘ä»¬çš„é€‰æ‹©æ˜¯ä»€ä¹ˆï¼Ÿ è¿™é‡Œæœ‰å¾ˆå¤šæ–¹æ³•å¯ä»¥æœ‰æ•ˆåœ°è¯»å–æ–‡ä»¶ã€‚ä½†æ˜¯ä¹Ÿæœ‰ä¸¤ç§æˆ‘ä»¬å¯èƒ½ä½¿ç”¨å®ƒä»¬çš„æƒ…å†µã€‚æˆ‘ä»¬æƒ³è¦åŒæ—¶è¯»å–å’Œå¤„ç†æ‰€æœ‰æ•°æ®ï¼Œè¾“å‡ºå¤„ç†è¿‡çš„æ•°æ®æˆ–æ ¹æ®æˆ‘ä»¬æ‰€è¯»å–çš„å†…å®¹æ‰§è¡Œå…¶ä»–æ“ä½œã€‚æˆ‘ä»¬ä¹Ÿå¯èƒ½æƒ³è¦è½¬æ¢ä¸€ä¸ªæ•°æ®æµï¼Œè€Œä¸éœ€è¦çœŸæ­£è®¿é—®çš„æ•°æ®ã€‚ è®©æˆ‘ä»¬è®¾æƒ³ä¸€ä¸‹ï¼Œå¯¹äºç¬¬ä¸€ç§æƒ…å†µï¼Œæˆ‘ä»¬å¸Œæœ›è¯»å–ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶ä¸”æ¯10,000è¡Œåˆ›å»ºä¸€ä¸ªç‹¬ç«‹æ’é˜Ÿçš„å¤„ç†ä½œä¸šã€‚æˆ‘ä»¬éœ€è¦åœ¨å†…å­˜ä¸­ä¿ç•™è‡³å°‘10000è¡Œï¼Œå¹¶å°†å®ƒä»¬ä¼ é€’ç»™æ’é˜Ÿçš„å·¥ä½œç®¡ç†å™¨ï¼ˆæ— è®ºé‡‡å–ä½•ç§å½¢å¼ï¼‰ã€‚ å¯¹äºç¬¬äºŒç§æƒ…å†µï¼Œæˆ‘ä»¬å‡è®¾æˆ‘ä»¬æƒ³è¦å‹ç¼©ä¸€ä¸ªç‰¹åˆ«å¤§çš„APIå“åº”çš„å†…å®¹ã€‚æˆ‘ä»¬ä¸åœ¨ä¹å®ƒçš„å†…å®¹æ˜¯ä»€ä¹ˆï¼Œä½†æˆ‘ä»¬éœ€è¦ç¡®ä¿å®ƒæ˜¯ä»¥å‹ç¼©å½¢å¼å¤‡ä»½çš„ã€‚ åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦è¯»å–å¤§æ–‡ä»¶ï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“æ•°æ®æ˜¯ä»€ä¹ˆã€‚ç¬¬äºŒï¼Œæˆ‘ä»¬å¹¶ä¸åœ¨ä¹æ•°æ®æ˜¯ä»€ä¹ˆã€‚è®©æˆ‘ä»¬æ¥æ¢ç´¢è¿™äº›é€‰æ‹©å§â€¦\né€è¡Œè¯»å–æ–‡ä»¶ æœ‰è®¸å¤šæ“ä½œæ–‡ä»¶çš„å‡½æ•°ï¼Œæˆ‘ä»¬æŠŠéƒ¨åˆ†ç»“åˆåˆ°ä¸€ä¸ªç®€å•çš„æ–‡ä»¶é˜…è¯»å™¨ä¸­(å°è£…ä¸ºä¸€ä¸ªæ–¹æ³•)ï¼š\n// from memory.php function formatBytes($bytes, $precision = 2) { $units = array(\"b\", \"kb\", \"mb\", \"gb\", \"tb\"); $bytes = max($bytes, 0); $pow = floor(($bytes ? log($bytes) : 0) / log(1024)); $pow = min($pow, count($units) - 1); $bytes /= (1 \u003c\u003c (10 * $pow)); return round($bytes, $precision) . \" \" . $units[$pow]; } print formatBytes(memory_get_peak_usage()); // from reading-files-line-by-line-1.php function readTheFile($path) { $lines = []; $handle = fopen($path, \"r\"); while(!feof($handle)) { $lines[] = trim(fgets($handle)); } fclose($handle); return $lines; } readTheFile(\"shakespeare.txt\"); require \"memory.php\"; æˆ‘ä»¬è¯»å–ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ä¸ºèå£«æ¯”äºšå…¨é›†ã€‚æ–‡ä»¶å¤§å°ä¸º5.5MBï¼Œå†…å­˜å ç”¨å³°å€¼ä¸º12.8MBã€‚ç°åœ¨è®©æˆ‘ä»¬ç”¨ä¸€ä¸ªç”Ÿæˆå™¨æ¥è¯»å–æ¯ä¸€è¡Œï¼š\n// from reading-files-line-by-line-2.php function readTheFile($path) { $handle = fopen($path, \"r\"); while(!feof($handle)) { yield trim(fgets($handle)); } fclose($handle); } readTheFile(\"shakespeare.txt\"); require \"memory.php\"; æ–‡æœ¬æ–‡ä»¶å¤§å°ä¸å˜ï¼Œä½†å†…å­˜ä½¿ç”¨å³°å€¼åªæ˜¯393KBã€‚å³ä½¿æˆ‘ä»¬èƒ½æŠŠè¯»å–åˆ°çš„æ•°æ®åšä¸€äº›äº‹æƒ…ä¹Ÿå¹¶ä¸æ„å‘³ç€ä»€ä¹ˆã€‚ä¹Ÿè®¸æˆ‘ä»¬å¯ä»¥åœ¨çœ‹åˆ°ä¸¤æ¡ç©ºç™½æ—¶æŠŠæ–‡æ¡£åˆ†å‰²æˆå—ï¼Œåƒè¿™æ ·ï¼š\n// from reading-files-line-by-line-3.php $iterator = readTheFile(\"shakespeare.txt\"); $buffer = \"\"; foreach ($iterator as $iteration) { preg_match(\"/\\n{3}/\", $buffer, $matches); if (count($matches)) { print \".\"; $buffer = \"\"; } else { $buffer .= $iteration . PHP_EOL; } } require \"memory.php\"; çŒœåˆ°æˆ‘ä»¬ä½¿ç”¨äº†å¤šå°‘å†…å­˜å—ï¼Ÿæˆ‘ä»¬æŠŠæ–‡æ¡£åˆ†å‰²ä¸º1216å—ï¼Œä»ç„¶åªä½¿ç”¨äº†459KBçš„å†…å­˜ï¼Œè¿™æ˜¯å¦è®©ä½ æƒŠè®¶ï¼Ÿè€ƒè™‘åˆ°ç”Ÿæˆå™¨çš„æ€§è´¨ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æœ€å¤šå†…å­˜æ˜¯ä½¿ç”¨åœ¨è¿­ä»£ä¸­æˆ‘ä»¬éœ€è¦å­˜å‚¨çš„æœ€å¤§æ–‡æœ¬å—ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæœ€å¤§çš„å—ä¸º101985å­—ç¬¦ã€‚\næˆ‘å·²ç»æ’°å†™äº†ä½¿ç”¨ç”Ÿæˆå™¨æç¤ºæ€§èƒ½å’ŒNikita Popovçš„è¿­ä»£å™¨åº“ï¼Œå¦‚æœä½ æ„Ÿå…´è¶£å°±å»çœ‹çœ‹å§ï¼\nç”Ÿæˆå™¨è¿˜æœ‰å…¶å®ƒç”¨é€”ï¼Œä½†æ˜¯æœ€æ˜æ˜¾çš„å¥½å¤„å°±æ˜¯é«˜æ€§èƒ½è¯»å–å¤§æ–‡ä»¶ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦å¤„ç†è¿™äº›æ•°æ®ï¼Œç”Ÿæˆå™¨å¯èƒ½æ˜¯æœ€å¥½çš„æ–¹æ³•ã€‚\nç®¡é“é—´çš„æ–‡ä»¶ åœ¨æˆ‘ä»¬ä¸éœ€è¦å¤„ç†æ•°æ®çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ–‡ä»¶æ•°æ®ä¼ é€’åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ã€‚é€šå¸¸è¢«ç§°ä¸ºç®¡é“ï¼ˆå¤§æ¦‚æ˜¯å› ä¸ºæˆ‘ä»¬çœ‹ä¸åˆ°é™¤äº†ä¸¤ç«¯çš„ç®¡å­é‡Œé¢ï¼Œå½“ç„¶ï¼Œå®ƒä¹Ÿæ˜¯ä¸é€æ˜çš„ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨æµæ–¹æ³•å®ç°ã€‚è®©æˆ‘ä»¬å…ˆå†™ä¸€ä¸ªè„šæœ¬ä»ä¸€ä¸ªæ–‡ä»¶ä¼ åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ã€‚è¿™æ ·æˆ‘ä»¬å¯ä»¥æµ‹é‡å†…å­˜çš„å ç”¨æƒ…å†µï¼š\n// from piping-files-1.php file_put_contents( \"piping-files-1.txt\", file_get_contents(\"shakespeare.txt\") ); require \"memory.php\"; ä¸å‡ºæ‰€æ–™ï¼Œè¿™ä¸ªè„šæœ¬ä½¿ç”¨æ›´å¤šçš„å†…å­˜æ¥è¿›è¡Œæ–‡æœ¬æ–‡ä»¶å¤åˆ¶ã€‚è¿™æ˜¯å› ä¸ºå®ƒè¯»å–(å’Œä¿ç•™)æ–‡ä»¶å†…å®¹åœ¨å†…å­˜ä¸­ï¼Œç›´åˆ°å®ƒè¢«å†™åˆ°æ–°æ–‡ä»¶ä¸­ã€‚å¯¹äºå°æ–‡ä»¶è¿™ç§æ–¹æ³•ä¹Ÿè®¸æ²¡é—®é¢˜ã€‚å½“ä¸ºæ›´å¤§çš„æ–‡ä»¶æ—¶ï¼Œå°±æ‰è¥Ÿè§è‚˜äº†â€¦\nè®©æˆ‘ä»¬å°è¯•ç”¨æµ(ç®¡é“)æ¥ä¼ é€ä¸€ä¸ªæ–‡ä»¶åˆ°å¦ä¸€ä¸ªï¼š\n// from piping-files-2.php $handle1 = fopen(\"shakespeare.txt\", \"r\"); $handle2 = fopen(\"piping-files-2.txt\", \"w\"); stream_copy_to_stream($handle1, $handle2); fclose($handle1); fclose($handle2); require \"memory.php\"; è¿™æ®µä»£ç ç¨å¾®æœ‰ç‚¹é™Œç”Ÿã€‚æˆ‘ä»¬æ‰“å¼€äº†ä¸¤æ–‡ä»¶çš„å¥æŸ„ï¼Œç¬¬ä¸€ä¸ªæ˜¯åªè¯»æ¨¡å¼ï¼Œç¬¬äºŒä¸ªæ˜¯åªå†™æ¨¡å¼ï¼Œç„¶åæˆ‘ä»¬ä»ç¬¬ä¸€ä¸ªå¤åˆ¶åˆ°ç¬¬äºŒä¸ªä¸­ã€‚æœ€åæˆ‘ä»¬å…³é—­äº†å®ƒï¼Œä¹Ÿè®¸ä½¿ä½ æƒŠè®¶ï¼Œå†…å­˜åªå ç”¨äº†393KB\nè¿™ä¼¼ä¹å¾ˆç†Ÿæ‚‰ã€‚åƒä»£ç ç”Ÿæˆå™¨åœ¨å­˜å‚¨å®ƒè¯»åˆ°çš„æ¯ä¸€è¡Œä»£ç ï¼Ÿé‚£æ˜¯å› ä¸ºç¬¬äºŒä¸ªå‚æ•°fgetsè§„å®šäº†æ¯è¡Œè¯»å¤šå°‘ä¸ªå­—èŠ‚ï¼ˆé»˜è®¤å€¼æ˜¯-1æˆ–è€…ç›´åˆ°ä¸‹ä¸€è¡Œä¸ºæ­¢ï¼‰ã€‚\nç¬¬ä¸‰ä¸ªå‚æ•°stream_copy_to_streamå’Œç¬¬äºŒä¸ªå‚æ•°æ˜¯åŒä¸€ç±»å‚æ•°ï¼ˆé»˜è®¤å€¼ç›¸åŒï¼‰ï¼Œstream_copy_to_streamä¸€æ¬¡ä»ä¸€ä¸ªæ•°æ®æµé‡Œè¯»ä¸€è¡Œï¼ŒåŒæ—¶å†™åˆ°å¦ä¸€ä¸ªæ•°æ®æµé‡Œã€‚å®ƒè·³è¿‡ç”Ÿæˆå™¨åªæœ‰ä¸€ä¸ªå€¼çš„éƒ¨åˆ†ï¼ˆå› ä¸ºæˆ‘ä»¬ä¸éœ€è¦è¿™ä¸ªå€¼ï¼‰ã€‚\nè¿™ç¯‡æ–‡ç« å¯¹äºæˆ‘ä»¬æ¥è¯´å¯èƒ½æ˜¯æ²¡ç”¨çš„ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬æƒ³ä¸€äº›æˆ‘ä»¬å¯èƒ½ä¼šç”¨åˆ°çš„ä¾‹å­ã€‚å‡è®¾æˆ‘ä»¬æƒ³ä»æˆ‘ä»¬çš„CDNä¸­è¾“å‡ºä¸€å¼ å›¾ç‰‡ï¼Œä½œä¸ºä¸€ç§é‡å®šå‘çš„è·¯ç”±åº”ç”¨ç¨‹åºã€‚æˆ‘ä»¬å¯ä»¥å‚ç…§ä¸‹è¾¹çš„ä»£ç æ¥å®ç°å®ƒï¼š\n// from piping-files-3.php file_put_contents( \"piping-files-3.jpeg\", file_get_contents( \"https://github.com/assertchris/uploads/raw/master/rick.jpg\" ) ); // ...or write this straight to stdout, if we don't need the memory info require \"memory.php\"; è®¾æƒ³ä¸€ä¸‹ï¼Œä¸€ä¸ªè·¯ç”±åº”ç”¨ç¨‹åºè®©æˆ‘ä»¬çœ‹åˆ°è¿™æ®µä»£ç ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬æƒ³ä»CDNè·å–ä¸€ä¸ªæ–‡ä»¶ï¼Œè€Œä¸æ˜¯ä»æœ¬åœ°çš„æ–‡ä»¶ç³»ç»Ÿè·å–ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ä¸€äº›å…¶ä»–çš„ä¸œè¥¿æ¥æ›´å¥½çš„æ›¿æ¢file_get_contentsï¼ˆå°±åƒGuzzleï¼‰ï¼Œå³ä½¿åœ¨å¼•æ“å†…éƒ¨å®ƒä»¬å‡ ä¹æ˜¯ä¸€æ ·çš„ã€‚\nå›¾ç‰‡çš„å†…å­˜å¤§æ¦‚æœ‰581Kã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥è¯•è¯•è¿™ä¸ª\n// from piping-files-4.php $handle1 = fopen( \"https://github.com/assertchris/uploads/raw/master/rick.jpg\", \"r\" ); $handle2 = fopen( \"piping-files-4.jpeg\", \"w\" ); // ...or write this straight to stdout, if we don't need the memory info stream_copy_to_stream($handle1, $handle2); fclose($handle1); fclose($handle2); require \"memory.php\"; å†…å­˜ä½¿ç”¨æ˜æ˜¾å˜å°‘ï¼ˆå¤§æ¦‚400Kï¼‰ï¼Œä½†æ˜¯ç»“æœæ˜¯ä¸€æ ·çš„ã€‚å¦‚æœæˆ‘ä»¬ä¸å…³æ³¨å†…å­˜ä¿¡æ¯ï¼Œæˆ‘ä»¬ä¾æ—§å¯ä»¥ç”¨æ ‡å‡†æ¨¡å¼è¾“å‡ºã€‚å®é™…ä¸Šï¼ŒPHPæä¾›äº†ä¸€ä¸ªç®€å•çš„æ–¹å¼æ¥å®Œæˆï¼š\n$handle1 = fopen( \"https://github.com/assertchris/uploads/raw/master/rick.jpg\", \"r\" ); $handle2 = fopen( \"php://stdout\", \"w\" ); stream_copy_to_stream($handle1, $handle2); fclose($handle1); fclose($handle2); // require \"memory.php\"; å…¶å®ƒæµ è¿˜æœ‰å…¶å®ƒä¸€äº›æµï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç®¡é“æ¥å†™å…¥å’Œè¯»å–ï¼ˆæˆ–åªè¯»å–/åªå†™å…¥ï¼‰ï¼š\nphp://stdin (åªè¯») php://stderr (åªå†™, å¦‚php://stdout) php://input (åªè¯») è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿè®¿é—®åŸå§‹è¯·æ±‚ä½“ php://output (åªå†™) è®©æˆ‘ä»¬å†™å…¥è¾“å‡ºç¼“å†²åŒº php://memory å’Œ php://temp (è¯»-å†™) æ˜¯æˆ‘ä»¬å¯ä»¥ä¸´æ—¶å­˜å‚¨æ•°æ®çš„åœ°æ–¹ã€‚ ä¸åŒä¹‹å¤„åœ¨äºä¸€æ—¦å®ƒå˜å¾—è¶³å¤Ÿå¤§ php://temp ä¼šå°†æ•°æ®å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œè€Œ php://memory å°†ä¸€ç›´æŒå­˜å‚¨åœ¨å†…å­˜ä¸­ç›´åˆ°èµ„æºè€—å°½ã€‚ è¿‡æ»¤å™¨ è¿˜æœ‰ä¸€ä¸ªæˆ‘ä»¬å¯ä»¥åœ¨streamä¸Šä½¿ç”¨çš„æŠ€å·§ï¼Œç§°ä¸ºè¿‡æ»¤å™¨ã€‚å®ƒä»¬æ˜¯ä¸€ç§ä¸­é—´çš„æ­¥éª¤ï¼Œæä¾›å¯¹streamæ•°æ®çš„ä¸€äº›æ§åˆ¶ï¼Œä½†ä¸æŠŠä»–ä»¬æš´éœ²ç»™æˆ‘ä»¬ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨Zipæ‰©å±•åæ¥å‹ç¼©æˆ‘ä»¬çš„shakespeare.txtæ–‡ä»¶ã€‚\n// from filters-1.php $zip = new ZipArchive(); $filename = \"filters-1.zip\"; $zip-\u003eopen($filename, ZipArchive::CREATE); $zip-\u003eaddFromString(\"shakespeare.txt\", file_get_contents(\"shakespeare.txt\")); $zip-\u003eclose(); require \"memory.php\"; è¿™æ˜¯ä¸€å°æ®µæ•´æ´çš„ä»£ç ï¼Œä½†å®ƒæµ‹é‡å†…å­˜å ç”¨åœ¨10.75MBå·¦å³ã€‚ä½¿ç”¨è¿‡æ»¤å™¨çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥å‡å°‘å†…å­˜ï¼š\n// from filters-2.php $handle1 = fopen( \"php://filter/zlib.deflate/resource=shakespeare.txt\", \"r\" ); $handle2 = fopen( \"filters-2.deflated\", \"w\" ); stream_copy_to_stream($handle1, $handle2); fclose($handle1); fclose($handle2); require \"memory.php\"; æ­¤å¤„ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åä¸ºphp://filter/zlib.deflateçš„è¿‡æ»¤å™¨ï¼Œå®ƒè¯»å–å¹¶å‹ç¼©èµ„æºçš„å†…å®¹ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ä¹‹åå°†å‹ç¼©æ•°æ®å¯¼å‡ºåˆ°å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚è¿™ä»…ä½¿ç”¨äº†896KB.\næˆ‘çŸ¥é“è¿™æ˜¯ä¸ä¸€æ ·çš„æ ¼å¼ï¼Œæˆ–è€…åˆ¶ä½œzipå­˜æ¡£æ˜¯æœ‰å¥½å¤„çš„ã€‚ä½ ä¸å¾—ä¸æ€€ç–‘ï¼šå¦‚æœä½ å¯ä»¥é€‰æ‹©ä¸åŒçš„æ ¼å¼å¹¶èŠ‚çœçº¦12å€çš„å†…å­˜ï¼Œä¸ºä»€ä¹ˆä¸é€‰å‘¢ï¼Ÿ\nä¸ºäº†è§£å‹æ­¤æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰§è¡Œå¦ä¸€ä¸ªzlib filterå°†å‹ç¼©åçš„æ•°æ®è¿˜åŸï¼š\n// from filters-2.php file_get_contents( \"php://filter/zlib.inflate/resource=filters-2.deflated\" ); Streams have been extensively covered in Streamåœ¨â€œç†è§£PHPä¸­çš„æµâ€å’Œâ€œé«˜æ•ˆä½¿ç”¨PHPä¸­çš„æµâ€ä¸­å·²ç»è¢«å…¨é¢ä»‹ç»äº†ã€‚å¦‚æœä½ å–œæ¬¢ä¸€ä¸ªå®Œå…¨ä¸åŒçš„è§†è§’ï¼Œå¯ä»¥é˜…è¯»ä¸€ä¸‹ã€‚\nå®šåˆ¶æµ fopenå’Œfile_get_contentsæœ‰å®ƒä»¬è‡ªå·±çš„ä¸€å¥—é»˜è®¤é€‰é¡¹ï¼Œä½†æ˜¯è¿™äº›éƒ½æ˜¯å®Œå…¨å¯å®šåˆ¶çš„ã€‚ä¸ºäº†å®šä¹‰å®ƒä»¬ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„æµä¸Šä¸‹æ–‡ï¼š\n// from creating-contexts-1.php $data = join(\"\u0026\", [ \"twitter=assertchris\", ]); $headers = join(\"\\r\\n\", [ \"Content-type: application/x-www-form-urlencoded\", \"Content-length: \" . strlen($data), ]); $options = [ \"http\" =\u003e [ \"method\" =\u003e \"POST\", \"header\"=\u003e $headers, \"content\" =\u003e $data, ], ]; $context = stream_content_create($options); $handle = fopen(\"https://example.com/register\", \"r\", false, $context); $response = stream_get_contents($handle); fclose($handle); åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ­£åœ¨å°è¯•å‘APIå‘å‡ºPOSTè¯·æ±‚ã€‚ APIç»ˆç«¯æ˜¯å®‰å…¨çš„ï¼Œä½†æˆ‘ä»¬ä»ç„¶éœ€è¦ä½¿ç”¨httpä¸Šä¸‹æ–‡å±æ€§ï¼ˆç”¨äºhttpå’Œhttpsï¼‰ã€‚æˆ‘ä»¬è®¾ç½®ä¸€äº›æ¶ˆæ¯å¤´å‚æ•°ï¼Œå¹¶æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶å¥æŸ„åˆ°APIã€‚ç”±äºä¸Šä¸‹æ–‡å¤„ç†å†™æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥å°†å¥æŸ„æ‰“å¼€ä¸ºåªè¯»ã€‚\næŸ¥çœ‹æ–‡æ¡£äº†è§£æ›´å¤šã€‚\nåˆ¶å®šè‡ªå®šä¹‰åè®®å’Œè¿‡æ»¤å™¨ åœ¨æˆ‘ä»¬ç»“æŸä¹‹å‰ï¼Œè®©æˆ‘ä»¬è°ˆè°ˆåˆ¶å®šè‡ªå®šä¹‰åè®®ã€‚ å¦‚æœä½ æŸ¥çœ‹æ–‡æ¡£ï¼Œä½ å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªç¤ºä¾‹ç±»æ¥å®ç°ï¼š\nProtocol { public resource $context; public __construct ( void ) public __destruct ( void ) public bool dir_closedir ( void ) public bool dir_opendir ( string $path , int $options ) public string dir_readdir ( void ) public bool dir_rewinddir ( void ) public bool mkdir ( string $path , int $mode , int $options ) public bool rename ( string $path_from , string $path_to ) public bool rmdir ( string $path , int $options ) public resource stream_cast ( int $cast_as ) public void stream_close ( void ) public bool stream_eof ( void ) public bool stream_flush ( void ) public bool stream_lock ( int $operation ) public bool stream_metadata ( string $path , int $option , mixed $value ) public bool stream_open ( string $path , string $mode , int $options , string \u0026$opened_path ) public string stream_read ( int $count ) public bool stream_seek ( int $offset , int $whence = SEEK_SET ) public bool stream_set_option ( int $option , int $arg1 , int $arg2 ) public array stream_stat ( void ) public int stream_tell ( void ) public bool stream_truncate ( int $new_size ) public int stream_write ( string $data ) public bool unlink ( string $path ) public array url_stat ( string $path , int $flags ) } æˆ‘ä»¬ä¸æ‰“ç®—å®ç°å…¶ä¸­çš„ä¸€ä¸ªï¼Œå› ä¸ºæˆ‘è®¤ä¸ºå®ƒåº”è¯¥æœ‰è‡ªå·±çš„æ•™ç¨‹ã€‚è¿™é‡Œæœ‰å¾ˆå¤šå·¥ä½œéœ€è¦å®Œæˆã€‚ä½†æ˜¯ä¸€æ—¦è¿™ä¸ªå·¥ä½œå®Œæˆï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°æ³¨å†Œæˆ‘ä»¬çš„æµåŒ…è£…ï¼š\nif (in_array(\"highlight-names\", stream_get_wrappers())) { stream_wrapper_unregister(\"highlight-names\"); } stream_wrapper_register(\"highlight-names\", \"HighlightNamesProtocol\"); $highlighted = file_get_contents(\"highlight-names://story.txt\"); åŒæ ·ï¼Œä¹Ÿå¯ä»¥åˆ›å»ºè‡ªå®šä¹‰æµè¿‡æ»¤å™¨ã€‚è¯¥æ–‡æ¡£æœ‰ä¸€ä¸ªç¤ºä¾‹è¿‡æ»¤å™¨ç±»ï¼š\nFilter { public $filtername; public $params public int filter ( resource $in , resource $out , int \u0026$consumed , bool $closing ) public void onClose ( void ) public bool onCreate ( void ) } è¿™å¯ä»¥å¾ˆå®¹æ˜“åœ°æ³¨å†Œï¼š\n$handle = fopen(\"story.txt\", \"w+\"); stream_filter_append($handle, \"highlight-names\", STREAM_FILTER_READ); çªå‡ºæ˜¾ç¤ºåç§°éœ€è¦åŒ¹é…æ–°çš„ç­›é€‰å™¨ç±»çš„filternameå±æ€§ã€‚ä¹Ÿå¯ä»¥åœ¨phpï¼š//filter/highligh-names/resource=story.txtå­—ç¬¦ä¸²ä¸­ä½¿ç”¨è‡ªå®šä¹‰è¿‡æ»¤å™¨ã€‚å®šä¹‰è¿‡æ»¤å™¨æ¯”å®šä¹‰åè®®è¦å®¹æ˜“å¾—å¤šã€‚å› ä¸ºåè®®éœ€è¦å¤„ç†ç›®å½•æ“ä½œï¼Œè€Œè¿‡æ»¤å™¨åªéœ€å¤„ç†æ¯ä¸ªæ•°æ®å—ã€‚\nå¦‚æœä½ æœ‰è¿™ä¸ªæƒ³æ³•ï¼Œæˆ‘å¼ºçƒˆå»ºè®®ä½ å°è¯•åˆ›å»ºè‡ªå®šä¹‰åè®®å’Œè¿‡æ»¤å™¨ã€‚å¦‚æœä½ å¯ä»¥å°†è¿‡æ»¤å™¨åº”ç”¨äºstream_copy_to_streamoperationsï¼Œé‚£ä¹ˆå³ä½¿åœ¨ä½¿ç”¨å¤§å®¹é‡æ–‡ä»¶æ—¶ï¼Œä½ çš„åº”ç”¨ç¨‹åºä¹Ÿå¯ä»¥åœ¨æ²¡æœ‰å†…å­˜çš„æƒ…å†µä¸‹ä½¿ç”¨ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œç¼–å†™ä¸€ä¸ªè°ƒæ•´å¤§å°çš„å›¾åƒè¿‡æ»¤å™¨æˆ–åŠ å¯†çš„åº”ç”¨ç¨‹åºè¿‡æ»¤å™¨ã€‚\næ€»ç»“ è™½ç„¶è¿™ä¸æ˜¯æˆ‘ä»¬ç»å¸¸é‡åˆ°çš„é—®é¢˜ï¼Œä½†åœ¨å¤„ç†å¤§æ–‡ä»¶æ—¶å¾ˆå®¹æ˜“æç ¸ã€‚åœ¨å¼‚æ­¥åº”ç”¨ç¨‹åºä¸­ï¼Œå½“æˆ‘ä»¬ä¸æ³¨æ„å°å¿ƒä½¿ç”¨å†…å­˜çš„è¯ï¼Œå¾ˆå®¹æ˜“å¯¼è‡´æ•´ä¸ªæœåŠ¡å™¨å®•æœºã€‚ æœ¬æ•™ç¨‹å¸Œæœ›å‘ä½ ä»‹ç»ä¸€äº›æ–°çš„æƒ³æ³•ï¼ˆæˆ–è€…è®©ä½ é‡æ–°è®¤è¯†ä»–ä»¬ï¼‰ï¼Œä»¥ä¾¿ä½ å¯ä»¥æ›´å¤šåœ°è€ƒè™‘å¦‚ä½•é«˜æ•ˆåœ°è¯»å–å’Œå†™å…¥å¤§å‹æ–‡ä»¶ã€‚å½“æˆ‘ä»¬å¼€å§‹ç†Ÿæ‚‰æµç¨‹å’Œç”Ÿæˆå™¨ï¼Œå¹¶åœæ­¢ä½¿ç”¨åƒfile_get_contentsè¿™æ ·çš„å‡½æ•°æ—¶ï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­å°±ä¼šå‡å°‘é”™è¯¯çš„ç±»åˆ«ï¼Œè¿™çœ‹èµ·æ¥æ˜¯å¾ˆå¥½ã€‚\n","wordCount":"4160","inLanguage":"zh","datePublished":"2024-09-25T16:20:33+08:00","dateModified":"2024-09-25T16:20:33+08:00","author":[{"@type":"Person","name":"Lorenwe"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://lorenwe.eu.org/posts/tech/%E5%A6%82%E4%BD%95%E7%94%A8php%E8%AF%BB%E5%8F%96%E5%A4%A7%E6%96%87%E4%BB%B6/"},"publisher":{"@type":"Organization","name":"Lorenwe Blog","logo":{"@type":"ImageObject","url":"https://lorenwe.eu.org/img/favicon.ico"}}}</script></head><body id=top><script>(function(){let e,t=new RegExp("(^| )change-themes=([^;]*)(;|$)");(e=document.cookie.match(t))||((new Date).getHours()>=19||(new Date).getHours()<6?(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark")):(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")))})(),localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://lorenwe.eu.org/ accesskey=h title="Lorenwe Blog (Alt + H)"><img src=https://lorenwe.eu.org/img/kaola.png alt=logo aria-label=logo height=35>Lorenwe Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://lorenwe.eu.org/search title="ğŸ” æœç´¢ (Alt + /)" accesskey=/><span>ğŸ” æœç´¢</span></a></li><li><a href=https://lorenwe.eu.org/ title="ğŸ  ä¸»é¡µ"><span>ğŸ  ä¸»é¡µ</span></a></li><li><a href=https://lorenwe.eu.org/posts title="ğŸ“š æ–‡ç« "><span>ğŸ“š æ–‡ç« </span></a></li><li><a href=https://lorenwe.eu.org/tags title="ğŸ§© æ ‡ç­¾"><span>ğŸ§© æ ‡ç­¾</span></a></li><li><a href=https://lorenwe.eu.org/archives/ title="â±ï¸ æ—¶é—´è½´"><span>â±ï¸ æ—¶é—´è½´</span></a></li><li><a href=https://lorenwe.eu.org/about title="ğŸ™‹ğŸ»â€â™‚ï¸ å…³äº"><span>ğŸ™‹ğŸ»â€â™‚ï¸ å…³äº</span></a></li><li><a href=https://lorenwe.eu.org/links title="ğŸ¤ å‹é“¾"><span>ğŸ¤ å‹é“¾</span></a></li></ul></nav></header><main class="main page"><style>i[id*=post_meta_style]{display:flex;align-items:center;margin:0 0 10px}</style><article class=post-single><div id=single-content><header class=post-header><div class=breadcrumbs><a href=https://lorenwe.eu.org/>ğŸ  ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href=https://lorenwe.eu.org/posts/>ğŸ“šæ–‡ç« </a>&nbsp;Â»&nbsp;<a href=https://lorenwe.eu.org/posts/tech/>ğŸ‘¨ğŸ»â€ğŸ’» æŠ€æœ¯</a></div><h1 class=post-title>å¦‚ä½•ç”¨PHPè¯»å–å¤§æ–‡ä»¶</h1><div class=post-meta><style>i[id*=post_meta_style]{display:flex;align-items:center;margin:0 0 10px}.parent-post-meta{display:flex;flex-wrap:wrap;opacity:.8}</style><span class=parent-post-meta><span id=post_meta_style_1><span class="fa fa-calendar-check-o"></span>
<span>2024-09-25
&nbsp;&nbsp;
</span></span><span id=post_meta_style_3><span class="fa fa-file-word-o"></span>
<span>4160å­—
&nbsp;&nbsp;
</span></span><span id=post_meta_style_4><span class="fa fa-clock-o"></span>
<span>9åˆ†é’Ÿ
&nbsp;&nbsp;
</span></span><span id=post_meta_style_5><span class="fa fa-user-o"></span>
<span>Lorenwe
&nbsp;&nbsp;
</span></span><span id=post_meta_style_6><span class="fa fa-tags" style=opacity:.8></span>
<span><span class=post-tags-meta><a href=https://lorenwe.eu.org/tags/php/ style=color:var(--secondary)!important>PHP</a>
&nbsp;<a href=https://lorenwe.eu.org/tags/%E5%A4%A7%E6%96%87%E4%BB%B6/ style=color:var(--secondary)!important>å¤§æ–‡ä»¶</a></span></span></span></span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>ç›®å½•</span></summary><div class=inner><ul><li><a href=#%e8%a1%a1%e9%87%8f%e6%88%90%e5%8a%9f%e7%9a%84%e6%a0%87%e5%87%86 aria-label=è¡¡é‡æˆåŠŸçš„æ ‡å‡†>è¡¡é‡æˆåŠŸçš„æ ‡å‡†</a></li><li><a href=#%e6%88%91%e4%bb%ac%e7%9a%84%e9%80%89%e6%8b%a9%e6%98%af%e4%bb%80%e4%b9%88 aria-label=æˆ‘ä»¬çš„é€‰æ‹©æ˜¯ä»€ä¹ˆï¼Ÿ>æˆ‘ä»¬çš„é€‰æ‹©æ˜¯ä»€ä¹ˆï¼Ÿ</a></li><li><a href=#%e9%80%90%e8%a1%8c%e8%af%bb%e5%8f%96%e6%96%87%e4%bb%b6 aria-label=é€è¡Œè¯»å–æ–‡ä»¶>é€è¡Œè¯»å–æ–‡ä»¶</a></li><li><a href=#%e7%ae%a1%e9%81%93%e9%97%b4%e7%9a%84%e6%96%87%e4%bb%b6 aria-label=ç®¡é“é—´çš„æ–‡ä»¶>ç®¡é“é—´çš„æ–‡ä»¶</a></li><li><a href=#%e8%bf%87%e6%bb%a4%e5%99%a8 aria-label=è¿‡æ»¤å™¨>è¿‡æ»¤å™¨</a></li><li><a href=#%e5%ae%9a%e5%88%b6%e6%b5%81 aria-label=å®šåˆ¶æµ>å®šåˆ¶æµ</a></li><li><a href=#%e5%88%b6%e5%ae%9a%e8%87%aa%e5%ae%9a%e4%b9%89%e5%8d%8f%e8%ae%ae%e5%92%8c%e8%bf%87%e6%bb%a4%e5%99%a8 aria-label=åˆ¶å®šè‡ªå®šä¹‰åè®®å’Œè¿‡æ»¤å™¨>åˆ¶å®šè‡ªå®šä¹‰åè®®å’Œè¿‡æ»¤å™¨</a></li><li><a href=#%e6%80%bb%e7%bb%93 aria-label=æ€»ç»“>æ€»ç»“</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{elements&&(activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")}))},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><p>åœ¨ <a href=https://github.com/sitepoint-editors/sitepoint-performant-reading-of-big-files-in-php>GitHub</a> ä¸Šå¯ä»¥æ‰¾åˆ°æœ¬æ•™ç¨‹çš„æºç ã€‚</p><h3 id=è¡¡é‡æˆåŠŸçš„æ ‡å‡†>è¡¡é‡æˆåŠŸçš„æ ‡å‡†<a hidden class=anchor aria-hidden=true href=#è¡¡é‡æˆåŠŸçš„æ ‡å‡†>#</a></h3><p>ç¡®ä¿æˆ‘ä»¬å¯¹ä»£ç æœ‰æ”¹è¿›çš„å”¯ä¸€æ–¹æ³•æ˜¯æµ‹è¯•ä¸€ä¸ªä¸å¥½çš„æƒ…å†µï¼Œç„¶åå°†æˆ‘ä»¬ä¿®å¤ä¹‹åçš„æµ‹é‡ä¸å¦ä¸€ä¸ªè¿›è¡Œæ¯”è¾ƒã€‚æ¢å¥è¯è¯´ï¼Œé™¤éæˆ‘ä»¬çŸ¥é“â€œè§£å†³æ–¹æ¡ˆâ€å¯¹æˆ‘ä»¬æœ‰å¤šå¤§çš„å¸®åŠ©ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ï¼Œå¦åˆ™æˆ‘ä»¬ä¸çŸ¥é“å®ƒæ˜¯å¦çœŸçš„æ˜¯ä¸€ä¸ªè§£å†³æ–¹æ¡ˆã€‚</p><p>è¿™é‡Œæœ‰ä¸¤ä¸ªæˆ‘ä»¬å¯ä»¥å…³ç³»çš„è¡¡é‡æ ‡å‡†ã€‚é¦–å…ˆæ˜¯CPUä½¿ç”¨ç‡ã€‚æˆ‘ä»¬è¦å¤„ç†çš„è¿›ç¨‹æœ‰å¤šå¿«æˆ–å¤šæ…¢ï¼Ÿç¬¬äºŒæ˜¯å†…å­˜ä½¿ç”¨æƒ…å†µã€‚è„šæœ¬æ‰§è¡Œæ—¶éœ€è¦å¤šå°‘å†…å­˜ï¼Ÿè¿™ä¸¤ä¸ªé€šå¸¸æ˜¯æˆåæ¯”çš„ - è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ä»¥CPUä½¿ç”¨ç‡ä¸ºä»£ä»·æ¥é™ä½å†…å­˜ä½¿ç”¨ï¼Œåä¹‹äº¦ç„¶ã€‚</p><p>åœ¨ä¸€ä¸ªå¼‚æ­¥æ‰§è¡Œæ¨¡å‹ï¼ˆå¦‚å¤šè¿›ç¨‹æˆ–å¤šçº¿ç¨‹çš„PHPåº”ç”¨ç¨‹åºï¼‰ä¸­ï¼ŒCPUå’Œå†…å­˜çš„ä½¿ç”¨ç‡æ˜¯å¾ˆé‡è¦çš„è€ƒé‡å› ç´ ã€‚åœ¨ä¼ ç»Ÿçš„PHPæ¶æ„ä¸­ï¼Œå½“ä»»ä½•ä¸€ä¸ªå€¼è¾¾åˆ°æœåŠ¡å™¨çš„æé™æ—¶ï¼Œè¿™äº›é€šå¸¸éƒ½ä¼šæˆä¸ºé—®é¢˜ã€‚</p><p>æµ‹é‡PHPå†…çš„CPUä½¿ç”¨ç‡æ˜¯ä¸åˆ‡å®é™…çš„ã€‚å¦‚æœè¿™æ˜¯ä½ è¦å…³æ³¨çš„é¢†åŸŸï¼Œè¯·è€ƒè™‘åœ¨Ubuntuæˆ–MacOSä¸Šä½¿ç”¨ç±»ä¼¼topçš„å·¥å…·ã€‚å¯¹äºWindowsï¼Œè¯·è€ƒè™‘ä½¿ç”¨Linuxå­ç³»ç»Ÿï¼Œä»¥ä¾¿åœ¨Ubuntuä¸­ä½¿ç”¨topã€‚</p><p>ä¸ºäº†æœ¬æ•™ç¨‹çš„ç›®çš„ï¼Œæˆ‘ä»¬å°†æµ‹é‡å†…å­˜ä½¿ç”¨æƒ…å†µã€‚æˆ‘ä»¬å°†çœ‹çœ‹åœ¨â€œä¼ ç»Ÿâ€çš„è„šæœ¬ä¸­ä½¿ç”¨äº†å¤šå°‘å†…å­˜ã€‚æˆ‘ä»¬å°†æ‰§è¡Œä¸€äº›ä¼˜åŒ–ç­–ç•¥å¹¶å¯¹å…¶è¿›è¡Œåº¦é‡ã€‚æœ€åï¼Œæˆ‘å¸Œæœ›ä½ èƒ½å¤Ÿåšå‡ºä¸€ä¸ªæœ‰ç»éªŒçš„é€‰æ‹©ã€‚
æˆ‘ä»¬æŸ¥çœ‹å†…å­˜ä½¿ç”¨å¤šå°‘çš„æ–¹æ³•æ˜¯ï¼š</p><pre><code class=language-php>// formatBytes is taken from the php.net documentation

memory_get_peak_usage();

function formatBytes($bytes, $precision = 2) {
    $units = array(&quot;b&quot;, &quot;kb&quot;, &quot;mb&quot;, &quot;gb&quot;, &quot;tb&quot;);

    $bytes = max($bytes, 0);
    $pow = floor(($bytes ? log($bytes) : 0) / log(1024));
    $pow = min($pow, count($units) - 1);

    $bytes /= (1 &lt;&lt; (10 * $pow));

    return round($bytes, $precision) . &quot; &quot; . $units[$pow];
}
</code></pre><p>æˆ‘ä»¬å°†åœ¨è„šæœ¬çš„æœ€åä½¿ç”¨è¿™äº›å‡½æ•°ï¼Œä»¥ä¾¿æˆ‘ä»¬èƒ½å¤Ÿçœ‹åˆ°å“ªä¸ªè„šæœ¬ä¸€æ¬¡ä½¿ç”¨æœ€å¤§çš„å†…å­˜ã€‚</p><h3 id=æˆ‘ä»¬çš„é€‰æ‹©æ˜¯ä»€ä¹ˆ>æˆ‘ä»¬çš„é€‰æ‹©æ˜¯ä»€ä¹ˆï¼Ÿ<a hidden class=anchor aria-hidden=true href=#æˆ‘ä»¬çš„é€‰æ‹©æ˜¯ä»€ä¹ˆ>#</a></h3><p>è¿™é‡Œæœ‰å¾ˆå¤šæ–¹æ³•å¯ä»¥æœ‰æ•ˆåœ°è¯»å–æ–‡ä»¶ã€‚ä½†æ˜¯ä¹Ÿæœ‰ä¸¤ç§æˆ‘ä»¬å¯èƒ½ä½¿ç”¨å®ƒä»¬çš„æƒ…å†µã€‚æˆ‘ä»¬æƒ³è¦åŒæ—¶è¯»å–å’Œå¤„ç†æ‰€æœ‰æ•°æ®ï¼Œè¾“å‡ºå¤„ç†è¿‡çš„æ•°æ®æˆ–æ ¹æ®æˆ‘ä»¬æ‰€è¯»å–çš„å†…å®¹æ‰§è¡Œå…¶ä»–æ“ä½œã€‚æˆ‘ä»¬ä¹Ÿå¯èƒ½æƒ³è¦è½¬æ¢ä¸€ä¸ªæ•°æ®æµï¼Œè€Œä¸éœ€è¦çœŸæ­£è®¿é—®çš„æ•°æ®ã€‚
è®©æˆ‘ä»¬è®¾æƒ³ä¸€ä¸‹ï¼Œå¯¹äºç¬¬ä¸€ç§æƒ…å†µï¼Œæˆ‘ä»¬å¸Œæœ›è¯»å–ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶ä¸”æ¯10,000è¡Œåˆ›å»ºä¸€ä¸ªç‹¬ç«‹æ’é˜Ÿçš„å¤„ç†ä½œä¸šã€‚æˆ‘ä»¬éœ€è¦åœ¨å†…å­˜ä¸­ä¿ç•™è‡³å°‘10000è¡Œï¼Œå¹¶å°†å®ƒä»¬ä¼ é€’ç»™æ’é˜Ÿçš„å·¥ä½œç®¡ç†å™¨ï¼ˆæ— è®ºé‡‡å–ä½•ç§å½¢å¼ï¼‰ã€‚
å¯¹äºç¬¬äºŒç§æƒ…å†µï¼Œæˆ‘ä»¬å‡è®¾æˆ‘ä»¬æƒ³è¦å‹ç¼©ä¸€ä¸ªç‰¹åˆ«å¤§çš„APIå“åº”çš„å†…å®¹ã€‚æˆ‘ä»¬ä¸åœ¨ä¹å®ƒçš„å†…å®¹æ˜¯ä»€ä¹ˆï¼Œä½†æˆ‘ä»¬éœ€è¦ç¡®ä¿å®ƒæ˜¯ä»¥å‹ç¼©å½¢å¼å¤‡ä»½çš„ã€‚
åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦è¯»å–å¤§æ–‡ä»¶ï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“æ•°æ®æ˜¯ä»€ä¹ˆã€‚ç¬¬äºŒï¼Œæˆ‘ä»¬å¹¶ä¸åœ¨ä¹æ•°æ®æ˜¯ä»€ä¹ˆã€‚è®©æˆ‘ä»¬æ¥æ¢ç´¢è¿™äº›é€‰æ‹©å§&mldr;</p><h3 id=é€è¡Œè¯»å–æ–‡ä»¶>é€è¡Œè¯»å–æ–‡ä»¶<a hidden class=anchor aria-hidden=true href=#é€è¡Œè¯»å–æ–‡ä»¶>#</a></h3><p>æœ‰è®¸å¤šæ“ä½œæ–‡ä»¶çš„å‡½æ•°ï¼Œæˆ‘ä»¬æŠŠéƒ¨åˆ†ç»“åˆåˆ°ä¸€ä¸ªç®€å•çš„æ–‡ä»¶é˜…è¯»å™¨ä¸­(å°è£…ä¸ºä¸€ä¸ªæ–¹æ³•)ï¼š</p><pre><code class=language-php>// from memory.php

function formatBytes($bytes, $precision = 2) {
    $units = array(&quot;b&quot;, &quot;kb&quot;, &quot;mb&quot;, &quot;gb&quot;, &quot;tb&quot;);

    $bytes = max($bytes, 0);
    $pow = floor(($bytes ? log($bytes) : 0) / log(1024));
    $pow = min($pow, count($units) - 1);

    $bytes /= (1 &lt;&lt; (10 * $pow));

    return round($bytes, $precision) . &quot; &quot; . $units[$pow];
}

print formatBytes(memory_get_peak_usage());
</code></pre><pre><code class=language-php>// from reading-files-line-by-line-1.php

function readTheFile($path) {
    $lines = [];
    $handle = fopen($path, &quot;r&quot;);

    while(!feof($handle)) {
        $lines[] = trim(fgets($handle));
    }

    fclose($handle);
    return $lines;
}

readTheFile(&quot;shakespeare.txt&quot;);

require &quot;memory.php&quot;;
</code></pre><p>æˆ‘ä»¬è¯»å–ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ä¸ºèå£«æ¯”äºšå…¨é›†ã€‚æ–‡ä»¶å¤§å°ä¸º5.5MBï¼Œå†…å­˜å ç”¨å³°å€¼ä¸º12.8MBã€‚ç°åœ¨è®©æˆ‘ä»¬ç”¨ä¸€ä¸ªç”Ÿæˆå™¨æ¥è¯»å–æ¯ä¸€è¡Œï¼š</p><pre><code class=language-php>// from reading-files-line-by-line-2.php

function readTheFile($path) {
    $handle = fopen($path, &quot;r&quot;);

    while(!feof($handle)) {
        yield trim(fgets($handle));
    }

    fclose($handle);
}

readTheFile(&quot;shakespeare.txt&quot;);

require &quot;memory.php&quot;;
</code></pre><p>æ–‡æœ¬æ–‡ä»¶å¤§å°ä¸å˜ï¼Œä½†å†…å­˜ä½¿ç”¨å³°å€¼åªæ˜¯393KBã€‚å³ä½¿æˆ‘ä»¬èƒ½æŠŠè¯»å–åˆ°çš„æ•°æ®åšä¸€äº›äº‹æƒ…ä¹Ÿå¹¶ä¸æ„å‘³ç€ä»€ä¹ˆã€‚ä¹Ÿè®¸æˆ‘ä»¬å¯ä»¥åœ¨çœ‹åˆ°ä¸¤æ¡ç©ºç™½æ—¶æŠŠæ–‡æ¡£åˆ†å‰²æˆå—ï¼Œåƒè¿™æ ·ï¼š</p><pre><code class=language-php>// from reading-files-line-by-line-3.php

$iterator = readTheFile(&quot;shakespeare.txt&quot;);

$buffer = &quot;&quot;;

foreach ($iterator as $iteration) {
    preg_match(&quot;/\n{3}/&quot;, $buffer, $matches);

    if (count($matches)) {
        print &quot;.&quot;;
        $buffer = &quot;&quot;;
    } else {
        $buffer .= $iteration . PHP_EOL;
    }
}

require &quot;memory.php&quot;;
</code></pre><p>çŒœåˆ°æˆ‘ä»¬ä½¿ç”¨äº†å¤šå°‘å†…å­˜å—ï¼Ÿæˆ‘ä»¬æŠŠæ–‡æ¡£åˆ†å‰²ä¸º1216å—ï¼Œä»ç„¶åªä½¿ç”¨äº†459KBçš„å†…å­˜ï¼Œè¿™æ˜¯å¦è®©ä½ æƒŠè®¶ï¼Ÿè€ƒè™‘åˆ°ç”Ÿæˆå™¨çš„æ€§è´¨ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æœ€å¤šå†…å­˜æ˜¯ä½¿ç”¨åœ¨è¿­ä»£ä¸­æˆ‘ä»¬éœ€è¦å­˜å‚¨çš„æœ€å¤§æ–‡æœ¬å—ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæœ€å¤§çš„å—ä¸º101985å­—ç¬¦ã€‚</p><p>æˆ‘å·²ç»æ’°å†™äº†ä½¿ç”¨<a href=https://www.sitepoint.com/memory-performance-boosts-with-generators-and-nikiciter/>ç”Ÿæˆå™¨æç¤ºæ€§èƒ½</a>å’Œ<a href=https://github.com/nikic/iter>Nikita Popovçš„è¿­ä»£å™¨åº“</a>ï¼Œå¦‚æœä½ æ„Ÿå…´è¶£å°±å»çœ‹çœ‹å§ï¼</p><p>ç”Ÿæˆå™¨è¿˜æœ‰å…¶å®ƒç”¨é€”ï¼Œä½†æ˜¯æœ€æ˜æ˜¾çš„å¥½å¤„å°±æ˜¯é«˜æ€§èƒ½è¯»å–å¤§æ–‡ä»¶ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦å¤„ç†è¿™äº›æ•°æ®ï¼Œç”Ÿæˆå™¨å¯èƒ½æ˜¯æœ€å¥½çš„æ–¹æ³•ã€‚</p><h3 id=ç®¡é“é—´çš„æ–‡ä»¶>ç®¡é“é—´çš„æ–‡ä»¶<a hidden class=anchor aria-hidden=true href=#ç®¡é“é—´çš„æ–‡ä»¶>#</a></h3><p>åœ¨æˆ‘ä»¬ä¸éœ€è¦å¤„ç†æ•°æ®çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ–‡ä»¶æ•°æ®ä¼ é€’åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ã€‚é€šå¸¸è¢«ç§°ä¸ºç®¡é“ï¼ˆå¤§æ¦‚æ˜¯å› ä¸ºæˆ‘ä»¬çœ‹ä¸åˆ°é™¤äº†ä¸¤ç«¯çš„ç®¡å­é‡Œé¢ï¼Œå½“ç„¶ï¼Œå®ƒä¹Ÿæ˜¯ä¸é€æ˜çš„ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨æµæ–¹æ³•å®ç°ã€‚è®©æˆ‘ä»¬å…ˆå†™ä¸€ä¸ªè„šæœ¬ä»ä¸€ä¸ªæ–‡ä»¶ä¼ åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ã€‚è¿™æ ·æˆ‘ä»¬å¯ä»¥æµ‹é‡å†…å­˜çš„å ç”¨æƒ…å†µï¼š</p><pre><code class=language-php>// from piping-files-1.php

file_put_contents(
    &quot;piping-files-1.txt&quot;, file_get_contents(&quot;shakespeare.txt&quot;)
);

require &quot;memory.php&quot;;
</code></pre><p>ä¸å‡ºæ‰€æ–™ï¼Œè¿™ä¸ªè„šæœ¬ä½¿ç”¨æ›´å¤šçš„å†…å­˜æ¥è¿›è¡Œæ–‡æœ¬æ–‡ä»¶å¤åˆ¶ã€‚è¿™æ˜¯å› ä¸ºå®ƒè¯»å–(å’Œä¿ç•™)æ–‡ä»¶å†…å®¹åœ¨å†…å­˜ä¸­ï¼Œç›´åˆ°å®ƒè¢«å†™åˆ°æ–°æ–‡ä»¶ä¸­ã€‚å¯¹äºå°æ–‡ä»¶è¿™ç§æ–¹æ³•ä¹Ÿè®¸æ²¡é—®é¢˜ã€‚å½“ä¸ºæ›´å¤§çš„æ–‡ä»¶æ—¶ï¼Œå°±æ‰è¥Ÿè§è‚˜äº†â€¦</p><p>è®©æˆ‘ä»¬å°è¯•ç”¨æµ(ç®¡é“)æ¥ä¼ é€ä¸€ä¸ªæ–‡ä»¶åˆ°å¦ä¸€ä¸ªï¼š</p><pre><code class=language-php>// from piping-files-2.php

$handle1 = fopen(&quot;shakespeare.txt&quot;, &quot;r&quot;);
$handle2 = fopen(&quot;piping-files-2.txt&quot;, &quot;w&quot;);

stream_copy_to_stream($handle1, $handle2);

fclose($handle1);
fclose($handle2);

require &quot;memory.php&quot;;
</code></pre><p>è¿™æ®µä»£ç ç¨å¾®æœ‰ç‚¹é™Œç”Ÿã€‚æˆ‘ä»¬æ‰“å¼€äº†ä¸¤æ–‡ä»¶çš„å¥æŸ„ï¼Œç¬¬ä¸€ä¸ªæ˜¯åªè¯»æ¨¡å¼ï¼Œç¬¬äºŒä¸ªæ˜¯åªå†™æ¨¡å¼ï¼Œç„¶åæˆ‘ä»¬ä»ç¬¬ä¸€ä¸ªå¤åˆ¶åˆ°ç¬¬äºŒä¸ªä¸­ã€‚æœ€åæˆ‘ä»¬å…³é—­äº†å®ƒï¼Œä¹Ÿè®¸ä½¿ä½ æƒŠè®¶ï¼Œå†…å­˜åªå ç”¨äº†393KB</p><p>è¿™ä¼¼ä¹å¾ˆç†Ÿæ‚‰ã€‚åƒä»£ç ç”Ÿæˆå™¨åœ¨å­˜å‚¨å®ƒè¯»åˆ°çš„æ¯ä¸€è¡Œä»£ç ï¼Ÿé‚£æ˜¯å› ä¸ºç¬¬äºŒä¸ªå‚æ•°fgetsè§„å®šäº†æ¯è¡Œè¯»å¤šå°‘ä¸ªå­—èŠ‚ï¼ˆé»˜è®¤å€¼æ˜¯-1æˆ–è€…ç›´åˆ°ä¸‹ä¸€è¡Œä¸ºæ­¢ï¼‰ã€‚</p><p>ç¬¬ä¸‰ä¸ªå‚æ•°stream_copy_to_streamå’Œç¬¬äºŒä¸ªå‚æ•°æ˜¯åŒä¸€ç±»å‚æ•°ï¼ˆé»˜è®¤å€¼ç›¸åŒï¼‰ï¼Œstream_copy_to_streamä¸€æ¬¡ä»ä¸€ä¸ªæ•°æ®æµé‡Œè¯»ä¸€è¡Œï¼ŒåŒæ—¶å†™åˆ°å¦ä¸€ä¸ªæ•°æ®æµé‡Œã€‚å®ƒè·³è¿‡ç”Ÿæˆå™¨åªæœ‰ä¸€ä¸ªå€¼çš„éƒ¨åˆ†ï¼ˆå› ä¸ºæˆ‘ä»¬ä¸éœ€è¦è¿™ä¸ªå€¼ï¼‰ã€‚</p><p>è¿™ç¯‡æ–‡ç« å¯¹äºæˆ‘ä»¬æ¥è¯´å¯èƒ½æ˜¯æ²¡ç”¨çš„ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬æƒ³ä¸€äº›æˆ‘ä»¬å¯èƒ½ä¼šç”¨åˆ°çš„ä¾‹å­ã€‚å‡è®¾æˆ‘ä»¬æƒ³ä»æˆ‘ä»¬çš„CDNä¸­è¾“å‡ºä¸€å¼ å›¾ç‰‡ï¼Œä½œä¸ºä¸€ç§é‡å®šå‘çš„è·¯ç”±åº”ç”¨ç¨‹åºã€‚æˆ‘ä»¬å¯ä»¥å‚ç…§ä¸‹è¾¹çš„ä»£ç æ¥å®ç°å®ƒï¼š</p><pre><code class=language-php>// from piping-files-3.php

file_put_contents(
    &quot;piping-files-3.jpeg&quot;, file_get_contents(
        &quot;https://github.com/assertchris/uploads/raw/master/rick.jpg&quot;
    )
);

// ...or write this straight to stdout, if we don't need the memory info

require &quot;memory.php&quot;;
</code></pre><p>è®¾æƒ³ä¸€ä¸‹ï¼Œä¸€ä¸ªè·¯ç”±åº”ç”¨ç¨‹åºè®©æˆ‘ä»¬çœ‹åˆ°è¿™æ®µä»£ç ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬æƒ³ä»CDNè·å–ä¸€ä¸ªæ–‡ä»¶ï¼Œè€Œä¸æ˜¯ä»æœ¬åœ°çš„æ–‡ä»¶ç³»ç»Ÿè·å–ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ä¸€äº›å…¶ä»–çš„ä¸œè¥¿æ¥æ›´å¥½çš„æ›¿æ¢file_get_contentsï¼ˆå°±åƒGuzzleï¼‰ï¼Œå³ä½¿åœ¨å¼•æ“å†…éƒ¨å®ƒä»¬å‡ ä¹æ˜¯ä¸€æ ·çš„ã€‚</p><p>å›¾ç‰‡çš„å†…å­˜å¤§æ¦‚æœ‰581Kã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥è¯•è¯•è¿™ä¸ª</p><pre><code class=language-php>// from piping-files-4.php

$handle1 = fopen(
    &quot;https://github.com/assertchris/uploads/raw/master/rick.jpg&quot;, &quot;r&quot;
);

$handle2 = fopen(
    &quot;piping-files-4.jpeg&quot;, &quot;w&quot;
);

// ...or write this straight to stdout, if we don't need the memory info

stream_copy_to_stream($handle1, $handle2);

fclose($handle1);
fclose($handle2);

require &quot;memory.php&quot;;
</code></pre><p>å†…å­˜ä½¿ç”¨æ˜æ˜¾å˜å°‘ï¼ˆå¤§æ¦‚400Kï¼‰ï¼Œä½†æ˜¯ç»“æœæ˜¯ä¸€æ ·çš„ã€‚å¦‚æœæˆ‘ä»¬ä¸å…³æ³¨å†…å­˜ä¿¡æ¯ï¼Œæˆ‘ä»¬ä¾æ—§å¯ä»¥ç”¨æ ‡å‡†æ¨¡å¼è¾“å‡ºã€‚å®é™…ä¸Šï¼ŒPHPæä¾›äº†ä¸€ä¸ªç®€å•çš„æ–¹å¼æ¥å®Œæˆï¼š</p><pre><code class=language-php>$handle1 = fopen(
    &quot;https://github.com/assertchris/uploads/raw/master/rick.jpg&quot;, &quot;r&quot;
);

$handle2 = fopen(
    &quot;php://stdout&quot;, &quot;w&quot;
);

stream_copy_to_stream($handle1, $handle2);

fclose($handle1);
fclose($handle2);

// require &quot;memory.php&quot;;
</code></pre><p>å…¶å®ƒæµ
è¿˜æœ‰å…¶å®ƒä¸€äº›æµï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç®¡é“æ¥å†™å…¥å’Œè¯»å–ï¼ˆæˆ–åªè¯»å–/åªå†™å…¥ï¼‰ï¼š</p><ul><li>php://stdin (åªè¯»)</li><li>php://stderr (åªå†™, å¦‚php://stdout)</li><li>php://input (åªè¯») è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿè®¿é—®åŸå§‹è¯·æ±‚ä½“</li><li>php://output (åªå†™) è®©æˆ‘ä»¬å†™å…¥è¾“å‡ºç¼“å†²åŒº</li><li>php://memory å’Œ php://temp (è¯»-å†™) æ˜¯æˆ‘ä»¬å¯ä»¥ä¸´æ—¶å­˜å‚¨æ•°æ®çš„åœ°æ–¹ã€‚ ä¸åŒä¹‹å¤„åœ¨äºä¸€æ—¦å®ƒå˜å¾—è¶³å¤Ÿå¤§ php://temp ä¼šå°†æ•°æ®å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œè€Œ php://memory å°†ä¸€ç›´æŒå­˜å‚¨åœ¨å†…å­˜ä¸­ç›´åˆ°èµ„æºè€—å°½ã€‚</li></ul><h3 id=è¿‡æ»¤å™¨>è¿‡æ»¤å™¨<a hidden class=anchor aria-hidden=true href=#è¿‡æ»¤å™¨>#</a></h3><p>è¿˜æœ‰ä¸€ä¸ªæˆ‘ä»¬å¯ä»¥åœ¨streamä¸Šä½¿ç”¨çš„æŠ€å·§ï¼Œç§°ä¸ºè¿‡æ»¤å™¨ã€‚å®ƒä»¬æ˜¯ä¸€ç§ä¸­é—´çš„æ­¥éª¤ï¼Œæä¾›å¯¹streamæ•°æ®çš„ä¸€äº›æ§åˆ¶ï¼Œä½†ä¸æŠŠä»–ä»¬æš´éœ²ç»™æˆ‘ä»¬ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨Zipæ‰©å±•åæ¥å‹ç¼©æˆ‘ä»¬çš„shakespeare.txtæ–‡ä»¶ã€‚</p><pre><code class=language-php>// from filters-1.php

$zip = new ZipArchive();
$filename = &quot;filters-1.zip&quot;;

$zip-&gt;open($filename, ZipArchive::CREATE);
$zip-&gt;addFromString(&quot;shakespeare.txt&quot;, file_get_contents(&quot;shakespeare.txt&quot;));
$zip-&gt;close();

require &quot;memory.php&quot;;
</code></pre><p>è¿™æ˜¯ä¸€å°æ®µæ•´æ´çš„ä»£ç ï¼Œä½†å®ƒæµ‹é‡å†…å­˜å ç”¨åœ¨10.75MBå·¦å³ã€‚ä½¿ç”¨è¿‡æ»¤å™¨çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥å‡å°‘å†…å­˜ï¼š</p><pre><code class=language-php>// from filters-2.php

$handle1 = fopen(
    &quot;php://filter/zlib.deflate/resource=shakespeare.txt&quot;, &quot;r&quot;
);

$handle2 = fopen(
    &quot;filters-2.deflated&quot;, &quot;w&quot;
);

stream_copy_to_stream($handle1, $handle2);

fclose($handle1);
fclose($handle2);

require &quot;memory.php&quot;;
</code></pre><p>æ­¤å¤„ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åä¸ºphp://filter/zlib.deflateçš„è¿‡æ»¤å™¨ï¼Œå®ƒè¯»å–å¹¶å‹ç¼©èµ„æºçš„å†…å®¹ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ä¹‹åå°†å‹ç¼©æ•°æ®å¯¼å‡ºåˆ°å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚è¿™ä»…ä½¿ç”¨äº†896KB.</p><p>æˆ‘çŸ¥é“è¿™æ˜¯ä¸ä¸€æ ·çš„æ ¼å¼ï¼Œæˆ–è€…åˆ¶ä½œzipå­˜æ¡£æ˜¯æœ‰å¥½å¤„çš„ã€‚ä½ ä¸å¾—ä¸æ€€ç–‘ï¼šå¦‚æœä½ å¯ä»¥é€‰æ‹©ä¸åŒçš„æ ¼å¼å¹¶èŠ‚çœçº¦12å€çš„å†…å­˜ï¼Œä¸ºä»€ä¹ˆä¸é€‰å‘¢ï¼Ÿ</p><p>ä¸ºäº†è§£å‹æ­¤æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰§è¡Œå¦ä¸€ä¸ªzlib filterå°†å‹ç¼©åçš„æ•°æ®è¿˜åŸï¼š</p><pre><code class=language-php>// from filters-2.php

file_get_contents(
    &quot;php://filter/zlib.inflate/resource=filters-2.deflated&quot;
);
</code></pre><p>Streams have been extensively covered in Streamåœ¨â€œç†è§£PHPä¸­çš„æµâ€å’Œâ€œ<a href=https://www.sitepoint.com/using-php-streams-effectively/>é«˜æ•ˆä½¿ç”¨PHPä¸­çš„æµ</a>â€ä¸­å·²ç»è¢«å…¨é¢ä»‹ç»äº†ã€‚å¦‚æœä½ å–œæ¬¢ä¸€ä¸ªå®Œå…¨ä¸åŒçš„è§†è§’ï¼Œå¯ä»¥é˜…è¯»ä¸€ä¸‹ã€‚</p><h3 id=å®šåˆ¶æµ>å®šåˆ¶æµ<a hidden class=anchor aria-hidden=true href=#å®šåˆ¶æµ>#</a></h3><p>fopenå’Œfile_get_contentsæœ‰å®ƒä»¬è‡ªå·±çš„ä¸€å¥—é»˜è®¤é€‰é¡¹ï¼Œä½†æ˜¯è¿™äº›éƒ½æ˜¯å®Œå…¨å¯å®šåˆ¶çš„ã€‚ä¸ºäº†å®šä¹‰å®ƒä»¬ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„æµä¸Šä¸‹æ–‡ï¼š</p><pre><code class=language-php>// from creating-contexts-1.php

$data = join(&quot;&amp;&quot;, [
    &quot;twitter=assertchris&quot;,
]);

$headers = join(&quot;\r\n&quot;, [
    &quot;Content-type: application/x-www-form-urlencoded&quot;,
    &quot;Content-length: &quot; . strlen($data),
]);

$options = [
    &quot;http&quot; =&gt; [
        &quot;method&quot; =&gt; &quot;POST&quot;,
        &quot;header&quot;=&gt; $headers,
        &quot;content&quot; =&gt; $data,
    ],
];

$context = stream_content_create($options);

$handle = fopen(&quot;https://example.com/register&quot;, &quot;r&quot;, false, $context);
$response = stream_get_contents($handle);

fclose($handle);
</code></pre><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ­£åœ¨å°è¯•å‘APIå‘å‡ºPOSTè¯·æ±‚ã€‚ APIç»ˆç«¯æ˜¯å®‰å…¨çš„ï¼Œä½†æˆ‘ä»¬ä»ç„¶éœ€è¦ä½¿ç”¨httpä¸Šä¸‹æ–‡å±æ€§ï¼ˆç”¨äºhttpå’Œhttpsï¼‰ã€‚æˆ‘ä»¬è®¾ç½®ä¸€äº›æ¶ˆæ¯å¤´å‚æ•°ï¼Œå¹¶æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶å¥æŸ„åˆ°APIã€‚ç”±äºä¸Šä¸‹æ–‡å¤„ç†å†™æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥å°†å¥æŸ„æ‰“å¼€ä¸ºåªè¯»ã€‚</p><p>æŸ¥çœ‹<a href=https://www.php.net/function.stream-context-create>æ–‡æ¡£</a>äº†è§£æ›´å¤šã€‚</p><h3 id=åˆ¶å®šè‡ªå®šä¹‰åè®®å’Œè¿‡æ»¤å™¨>åˆ¶å®šè‡ªå®šä¹‰åè®®å’Œè¿‡æ»¤å™¨<a hidden class=anchor aria-hidden=true href=#åˆ¶å®šè‡ªå®šä¹‰åè®®å’Œè¿‡æ»¤å™¨>#</a></h3><p>åœ¨æˆ‘ä»¬ç»“æŸä¹‹å‰ï¼Œè®©æˆ‘ä»¬è°ˆè°ˆåˆ¶å®šè‡ªå®šä¹‰åè®®ã€‚ å¦‚æœä½ æŸ¥çœ‹<a href=https://www.php.net/manual/en/class.streamwrapper.php>æ–‡æ¡£</a>ï¼Œä½ å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªç¤ºä¾‹ç±»æ¥å®ç°ï¼š</p><pre><code class=language-php>Protocol {
    public resource $context;
    public __construct ( void )
    public __destruct ( void )
    public bool dir_closedir ( void )
    public bool dir_opendir ( string $path , int $options )
    public string dir_readdir ( void )
    public bool dir_rewinddir ( void )
    public bool mkdir ( string $path , int $mode , int $options )
    public bool rename ( string $path_from , string $path_to )
    public bool rmdir ( string $path , int $options )
    public resource stream_cast ( int $cast_as )
    public void stream_close ( void )
    public bool stream_eof ( void )
    public bool stream_flush ( void )
    public bool stream_lock ( int $operation )
    public bool stream_metadata ( string $path , int $option , mixed $value )
    public bool stream_open ( string $path , string $mode , int $options ,
        string &amp;$opened_path )
    public string stream_read ( int $count )
    public bool stream_seek ( int $offset , int $whence = SEEK_SET )
    public bool stream_set_option ( int $option , int $arg1 , int $arg2 )
    public array stream_stat ( void )
    public int stream_tell ( void )
    public bool stream_truncate ( int $new_size )
    public int stream_write ( string $data )
    public bool unlink ( string $path )
    public array url_stat ( string $path , int $flags )
}
</code></pre><p>æˆ‘ä»¬ä¸æ‰“ç®—å®ç°å…¶ä¸­çš„ä¸€ä¸ªï¼Œå› ä¸ºæˆ‘è®¤ä¸ºå®ƒåº”è¯¥æœ‰è‡ªå·±çš„æ•™ç¨‹ã€‚è¿™é‡Œæœ‰å¾ˆå¤šå·¥ä½œéœ€è¦å®Œæˆã€‚ä½†æ˜¯ä¸€æ—¦è¿™ä¸ªå·¥ä½œå®Œæˆï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°æ³¨å†Œæˆ‘ä»¬çš„æµåŒ…è£…ï¼š</p><pre><code class=language-php>if (in_array(&quot;highlight-names&quot;, stream_get_wrappers())) {
    stream_wrapper_unregister(&quot;highlight-names&quot;);
}

stream_wrapper_register(&quot;highlight-names&quot;, &quot;HighlightNamesProtocol&quot;);

$highlighted = file_get_contents(&quot;highlight-names://story.txt&quot;);
</code></pre><p>åŒæ ·ï¼Œä¹Ÿå¯ä»¥åˆ›å»ºè‡ªå®šä¹‰æµè¿‡æ»¤å™¨ã€‚è¯¥<a href=https://www.php.net/manual/en/class.streamwrapper.php>æ–‡æ¡£</a>æœ‰ä¸€ä¸ªç¤ºä¾‹è¿‡æ»¤å™¨ç±»ï¼š</p><pre><code class=language-php>Filter {
    public $filtername;
    public $params
    public int filter ( resource $in , resource $out , int &amp;$consumed ,
        bool $closing )
    public void onClose ( void )
    public bool onCreate ( void )
}
</code></pre><p>è¿™å¯ä»¥å¾ˆå®¹æ˜“åœ°æ³¨å†Œï¼š</p><pre><code class=language-php>$handle = fopen(&quot;story.txt&quot;, &quot;w+&quot;);
stream_filter_append($handle, &quot;highlight-names&quot;, STREAM_FILTER_READ);
</code></pre><p>çªå‡ºæ˜¾ç¤ºåç§°éœ€è¦åŒ¹é…æ–°çš„ç­›é€‰å™¨ç±»çš„filternameå±æ€§ã€‚ä¹Ÿå¯ä»¥åœ¨phpï¼š//filter/highligh-names/resource=story.txtå­—ç¬¦ä¸²ä¸­ä½¿ç”¨è‡ªå®šä¹‰è¿‡æ»¤å™¨ã€‚å®šä¹‰è¿‡æ»¤å™¨æ¯”å®šä¹‰åè®®è¦å®¹æ˜“å¾—å¤šã€‚å› ä¸ºåè®®éœ€è¦å¤„ç†ç›®å½•æ“ä½œï¼Œè€Œè¿‡æ»¤å™¨åªéœ€å¤„ç†æ¯ä¸ªæ•°æ®å—ã€‚</p><p>å¦‚æœä½ æœ‰è¿™ä¸ªæƒ³æ³•ï¼Œæˆ‘å¼ºçƒˆå»ºè®®ä½ å°è¯•åˆ›å»ºè‡ªå®šä¹‰åè®®å’Œè¿‡æ»¤å™¨ã€‚å¦‚æœä½ å¯ä»¥å°†è¿‡æ»¤å™¨åº”ç”¨äºstream_copy_to_streamoperationsï¼Œé‚£ä¹ˆå³ä½¿åœ¨ä½¿ç”¨å¤§å®¹é‡æ–‡ä»¶æ—¶ï¼Œä½ çš„åº”ç”¨ç¨‹åºä¹Ÿå¯ä»¥åœ¨æ²¡æœ‰å†…å­˜çš„æƒ…å†µä¸‹ä½¿ç”¨ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œç¼–å†™ä¸€ä¸ªè°ƒæ•´å¤§å°çš„å›¾åƒè¿‡æ»¤å™¨æˆ–åŠ å¯†çš„åº”ç”¨ç¨‹åºè¿‡æ»¤å™¨ã€‚</p><h3 id=æ€»ç»“>æ€»ç»“<a hidden class=anchor aria-hidden=true href=#æ€»ç»“>#</a></h3><p>è™½ç„¶è¿™ä¸æ˜¯æˆ‘ä»¬ç»å¸¸é‡åˆ°çš„é—®é¢˜ï¼Œä½†åœ¨å¤„ç†å¤§æ–‡ä»¶æ—¶å¾ˆå®¹æ˜“æç ¸ã€‚åœ¨å¼‚æ­¥åº”ç”¨ç¨‹åºä¸­ï¼Œå½“æˆ‘ä»¬ä¸æ³¨æ„å°å¿ƒä½¿ç”¨å†…å­˜çš„è¯ï¼Œå¾ˆå®¹æ˜“å¯¼è‡´æ•´ä¸ªæœåŠ¡å™¨å®•æœºã€‚
æœ¬æ•™ç¨‹å¸Œæœ›å‘ä½ ä»‹ç»ä¸€äº›æ–°çš„æƒ³æ³•ï¼ˆæˆ–è€…è®©ä½ é‡æ–°è®¤è¯†ä»–ä»¬ï¼‰ï¼Œä»¥ä¾¿ä½ å¯ä»¥æ›´å¤šåœ°è€ƒè™‘å¦‚ä½•é«˜æ•ˆåœ°è¯»å–å’Œå†™å…¥å¤§å‹æ–‡ä»¶ã€‚å½“æˆ‘ä»¬å¼€å§‹ç†Ÿæ‚‰æµç¨‹å’Œç”Ÿæˆå™¨ï¼Œå¹¶åœæ­¢ä½¿ç”¨åƒfile_get_contentsè¿™æ ·çš„å‡½æ•°æ—¶ï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­å°±ä¼šå‡å°‘é”™è¯¯çš„ç±»åˆ«ï¼Œè¿™çœ‹èµ·æ¥æ˜¯å¾ˆå¥½ã€‚</p></div><div class=post-reward><div style=padding:0;margin:0;width:100%;font-size:16px;text-align:center><div id=QR style=opacity:0><div id=wechat style=display:inline-block><a class=fancybox rel=group><img id=wechat_qr src=https://lorenwe.eu.org/img/wechat_pay.png alt=wechat_pay></a><p>å¾®ä¿¡</p></div><div id=alipay style=display:inline-block><a class=fancybox rel=group><img id=alipay_qr src=https://lorenwe.eu.org/img/alipay.png alt=alipay></a><p>æ”¯ä»˜å®</p></div></div><button id=rewardButton onclick='var qr=document.getElementById("QR");qr.style.opacity==="0"?qr.style.opacity="1":qr.style.opacity="0"'>
<span>ğŸ§§ é¼“åŠ±</span></button></div></div><footer class=post-footer><nav class=paginav><a class=prev href=https://lorenwe.eu.org/posts/tech/%E4%BD%BF%E7%94%A8githubactions%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2hugo%E7%AB%99%E7%82%B9/><span class=title>Â« ä¸Šä¸€é¡µ</span><br><span>ä½¿ç”¨ GitHub Actions è‡ªåŠ¨éƒ¨ç½² Hugo ç«™ç‚¹</span>
</a><a class=next href=https://lorenwe.eu.org/posts/tech/%E5%9B%9B%E7%A7%8D%E5%B8%B8%E8%A7%81%E7%9A%84post%E6%8F%90%E4%BA%A4%E6%95%B0%E6%8D%AE%E6%96%B9%E5%BC%8F/><span class=title>ä¸‹ä¸€é¡µ Â»</span><br><span>å››ç§å¸¸è§çš„POSTæäº¤æ•°æ®æ–¹å¼</span></a></nav></footer></div><div id=giscus-comment></div><script>function sendMessage(e){const t=document.querySelector("iframe.giscus-frame");if(!t||!t.contentWindow)return;t.contentWindow.postMessage({giscus:e},"https://giscus.app")}function createGusicScript(){const t=document.querySelector("#giscus-comment"),n=localStorage.getItem("pref-theme");let e=document.createElement("script");e.src="https://giscus.app/client.js",e.setAttribute("data-repo","lorenwe/lorenwe.github.io"),e.setAttribute("data-repo-id","MDEwOlJlcG9zaXRvcnk3NDY0NzM4MQ=="),e.setAttribute("data-category","Announcements"),e.setAttribute("data-category-id","DIC_kwDOBHMHVc4CizTN"),e.setAttribute("data-mapping","title"),e.setAttribute("data-strict","0"),e.setAttribute("data-reactions-enabled","1"),e.setAttribute("data-emit-metadata","0"),e.setAttribute("data-input-position","bottom"),e.setAttribute("data-theme",n),e.setAttribute("data-lang","zh-CN"),e.setAttribute("data-loading","lazy"),e.setAttribute("crossorigin","anonymous"),e.async=!0,t&&t.appendChild(e)}createGusicScript()</script></article></main><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><span class=topInner><svg class="topSvg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
<span id=read_progress></span>
</span></a><script>document.addEventListener("scroll",function(){const t=document.getElementById("read_progress"),n=document.documentElement.scrollHeight,s=document.documentElement.clientHeight,o=document.documentElement.scrollTop||document.body.scrollTop;t.innerText=((o/(n-s)).toFixed(2)*100).toFixed(0)})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>let mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>200||document.documentElement.scrollTop>200?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{(function(){document.cookie="change-themes="+escape("false")})(),document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light"),sendMessage({setConfig:{theme:"light"}})):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"),sendMessage({setConfig:{theme:"dark"}}))})</script><script>document.body.addEventListener("copy",function(e){if(window.getSelection().toString()&&window.getSelection().toString().length>50){let t=e.clipboardData||window.clipboardData;if(t){e.preventDefault();let n=window.getSelection().toString()+`\r

â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r
ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€ŒLorenwe Blogã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚\r
åŸæ–‡é“¾æ¥ï¼š`+location.href,s=window.getSelection().toString()+`\r

â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r
ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€ŒLorenwe Blogã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚\r
åŸæ–‡é“¾æ¥ï¼š`+location.href;t.setData("text/html",n),t.setData("text/plain",s)}}})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="å¤åˆ¶";function i(){t.innerText="å·²å¤åˆ¶ï¼",setTimeout(()=>{t.innerText="å¤åˆ¶"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){let t=e.textContent+`\r
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r
ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€ŒLorenwe Blogã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚\r
åŸæ–‡é“¾æ¥ï¼š`+location.href;navigator.clipboard.writeText(t),i();return}const n=document.createRange();n.selectNodeContents(e);const s=window.getSelection();s.removeAllRanges(),s.addRange(n);try{document.execCommand("copy"),i()}catch{}s.removeRange(n)});let l=e.className.replaceAll("language-",""),n=document.createElement("div"),a=document.createElement("div"),r=document.createElement("div"),c=document.createElement("div"),o=document.createElement("div");o.innerText=l,n.setAttribute("class","mac-tool"),a.setAttribute("class","mac bb1"),r.setAttribute("class","mac bb2"),c.setAttribute("class","mac bb3"),o.setAttribute("class","language-type"),n.appendChild(a),n.appendChild(r),n.appendChild(c),n.appendChild(o),s.classList.contains("highlight")?(s.appendChild(t),s.appendChild(n)):s.parentNode.firstChild==s||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?(e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t),s.appendChild(n)):(e.parentNode.appendChild(t),s.appendChild(n)))})</script></body></html>