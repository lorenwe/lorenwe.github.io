<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Rustå¦‚ä½•æ­£ç¡®è§£æyamlæ–‡ä»¶ | Lorenwe Blog</title><meta name=keywords content><meta name=description content="ä¸€ã€ç®€ä»‹
serde_yaml æ˜¯ Rust è¯­è¨€ä¸­ä¸€ä¸ªç”¨äºåºåˆ—åŒ–å’Œååºåˆ—åŒ– YAML æ•°æ®çš„åº“ã€‚å®ƒä»¥å…¶é«˜æ€§èƒ½å’Œçµæ´»æ€§è€Œå¹¿å—æ¬¢è¿ï¼Œç‰¹åˆ«é€‚ç”¨äºéœ€è¦å¤„ç† YAML é…ç½®æ–‡ä»¶çš„é¡¹ç›®ã€‚åœ¨è¿™ç¯‡åšå®¢ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨ serde_yaml çš„åŸºæœ¬ç”¨æ³•ï¼Œå¹¶æä¾›ä¸€äº›å®ç”¨çš„ç¤ºä¾‹ä»£ç ã€‚
äºŒã€ä½¿ç”¨åœºæ™¯
serde_yaml å¸¸ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š

é…ç½®ç®¡ç†ï¼šè®¸å¤šåº”ç”¨ç¨‹åºä½¿ç”¨ YAML æ–‡ä»¶æ¥å­˜å‚¨é…ç½®å‚æ•°ï¼Œserde_yaml å¯ä»¥è½»æ¾è§£æè¿™äº›æ–‡ä»¶ã€‚
æ•°æ®äº¤æ¢ï¼šåœ¨ç³»ç»Ÿä¹‹é—´ä¼ é€’æ•°æ®æ—¶ï¼ŒYAML æ ¼å¼å› å…¶å¯è¯»æ€§è€Œå¸¸è¢«é€‰ç”¨ã€‚
æ–‡æ¡£ç”Ÿæˆï¼šä¸€äº›å·¥å…·ä½¿ç”¨ YAML æ¥æè¿°æ–‡æ¡£ç»“æ„ï¼Œserde_yaml å¯ä»¥å¸®åŠ©ç”Ÿæˆå’Œè§£æè¿™äº›æ–‡æ¡£ã€‚

ä¸‰ã€åŸºæœ¬ä½¿ç”¨
å¼€å§‹ä½¿ç”¨ serde_yaml ä¹‹å‰ï¼Œå…ˆåˆ›å»ºä¸€ä¸ª serde_yaml_test é¡¹ç›®æ–‡ä»¶å¤¹ï¼Œåœ¨æ–‡ä»¶å¤¹ä¸­ä½¿ç”¨ cargo init åˆå§‹åŒ– rust é¡¹ç›®ï¼Œç„¶ååœ¨é¡¹ç›®çš„ Cargo.toml æ–‡ä»¶ä¸­æ·»åŠ ä¾èµ–ï¼š"><meta name=author content="Lorenwe"><link rel=canonical href=https://lorenwe.eu.org/posts/tech/rust%E5%A6%82%E4%BD%95%E6%AD%A3%E7%A1%AE%E8%A7%A3%E6%9E%90yaml%E6%96%87%E4%BB%B6/><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.js onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://lorenwe.eu.org/img/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://lorenwe.eu.org/img/favicon.ico><link rel=icon type=image/png sizes=32x32 href=https://lorenwe.eu.org/img/favicon.ico><link rel=apple-touch-icon href=https://lorenwe.eu.org/img/favicon.ico><link rel=mask-icon href=https://lorenwe.eu.org/img/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://lorenwe.eu.org/posts/tech/rust%E5%A6%82%E4%BD%95%E6%AD%A3%E7%A1%AE%E8%A7%A3%E6%9E%90yaml%E6%96%87%E4%BB%B6/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script defer src=https://unpkg.com/mermaid@8.8.1/dist/mermaid.min.js></script><link rel=stylesheet href=https://lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/4.7.0/css/font-awesome.min.css><script src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><script src=https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/jquery/3.6.0/jquery.min.js></script><meta property="og:title" content="Rustå¦‚ä½•æ­£ç¡®è§£æyamlæ–‡ä»¶"><meta property="og:description" content="ä¸€ã€ç®€ä»‹
serde_yaml æ˜¯ Rust è¯­è¨€ä¸­ä¸€ä¸ªç”¨äºåºåˆ—åŒ–å’Œååºåˆ—åŒ– YAML æ•°æ®çš„åº“ã€‚å®ƒä»¥å…¶é«˜æ€§èƒ½å’Œçµæ´»æ€§è€Œå¹¿å—æ¬¢è¿ï¼Œç‰¹åˆ«é€‚ç”¨äºéœ€è¦å¤„ç† YAML é…ç½®æ–‡ä»¶çš„é¡¹ç›®ã€‚åœ¨è¿™ç¯‡åšå®¢ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨ serde_yaml çš„åŸºæœ¬ç”¨æ³•ï¼Œå¹¶æä¾›ä¸€äº›å®ç”¨çš„ç¤ºä¾‹ä»£ç ã€‚
äºŒã€ä½¿ç”¨åœºæ™¯
serde_yaml å¸¸ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š

é…ç½®ç®¡ç†ï¼šè®¸å¤šåº”ç”¨ç¨‹åºä½¿ç”¨ YAML æ–‡ä»¶æ¥å­˜å‚¨é…ç½®å‚æ•°ï¼Œserde_yaml å¯ä»¥è½»æ¾è§£æè¿™äº›æ–‡ä»¶ã€‚
æ•°æ®äº¤æ¢ï¼šåœ¨ç³»ç»Ÿä¹‹é—´ä¼ é€’æ•°æ®æ—¶ï¼ŒYAML æ ¼å¼å› å…¶å¯è¯»æ€§è€Œå¸¸è¢«é€‰ç”¨ã€‚
æ–‡æ¡£ç”Ÿæˆï¼šä¸€äº›å·¥å…·ä½¿ç”¨ YAML æ¥æè¿°æ–‡æ¡£ç»“æ„ï¼Œserde_yaml å¯ä»¥å¸®åŠ©ç”Ÿæˆå’Œè§£æè¿™äº›æ–‡æ¡£ã€‚

ä¸‰ã€åŸºæœ¬ä½¿ç”¨
å¼€å§‹ä½¿ç”¨ serde_yaml ä¹‹å‰ï¼Œå…ˆåˆ›å»ºä¸€ä¸ª serde_yaml_test é¡¹ç›®æ–‡ä»¶å¤¹ï¼Œåœ¨æ–‡ä»¶å¤¹ä¸­ä½¿ç”¨ cargo init åˆå§‹åŒ– rust é¡¹ç›®ï¼Œç„¶ååœ¨é¡¹ç›®çš„ Cargo.toml æ–‡ä»¶ä¸­æ·»åŠ ä¾èµ–ï¼š"><meta property="og:type" content="article"><meta property="og:url" content="https://lorenwe.eu.org/posts/tech/rust%E5%A6%82%E4%BD%95%E6%AD%A3%E7%A1%AE%E8%A7%A3%E6%9E%90yaml%E6%96%87%E4%BB%B6/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-10-23T11:14:01+08:00"><meta property="article:modified_time" content="2024-10-23T11:14:01+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Rustå¦‚ä½•æ­£ç¡®è§£æyamlæ–‡ä»¶"><meta name=twitter:description content="ä¸€ã€ç®€ä»‹
serde_yaml æ˜¯ Rust è¯­è¨€ä¸­ä¸€ä¸ªç”¨äºåºåˆ—åŒ–å’Œååºåˆ—åŒ– YAML æ•°æ®çš„åº“ã€‚å®ƒä»¥å…¶é«˜æ€§èƒ½å’Œçµæ´»æ€§è€Œå¹¿å—æ¬¢è¿ï¼Œç‰¹åˆ«é€‚ç”¨äºéœ€è¦å¤„ç† YAML é…ç½®æ–‡ä»¶çš„é¡¹ç›®ã€‚åœ¨è¿™ç¯‡åšå®¢ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨ serde_yaml çš„åŸºæœ¬ç”¨æ³•ï¼Œå¹¶æä¾›ä¸€äº›å®ç”¨çš„ç¤ºä¾‹ä»£ç ã€‚
äºŒã€ä½¿ç”¨åœºæ™¯
serde_yaml å¸¸ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š

é…ç½®ç®¡ç†ï¼šè®¸å¤šåº”ç”¨ç¨‹åºä½¿ç”¨ YAML æ–‡ä»¶æ¥å­˜å‚¨é…ç½®å‚æ•°ï¼Œserde_yaml å¯ä»¥è½»æ¾è§£æè¿™äº›æ–‡ä»¶ã€‚
æ•°æ®äº¤æ¢ï¼šåœ¨ç³»ç»Ÿä¹‹é—´ä¼ é€’æ•°æ®æ—¶ï¼ŒYAML æ ¼å¼å› å…¶å¯è¯»æ€§è€Œå¸¸è¢«é€‰ç”¨ã€‚
æ–‡æ¡£ç”Ÿæˆï¼šä¸€äº›å·¥å…·ä½¿ç”¨ YAML æ¥æè¿°æ–‡æ¡£ç»“æ„ï¼Œserde_yaml å¯ä»¥å¸®åŠ©ç”Ÿæˆå’Œè§£æè¿™äº›æ–‡æ¡£ã€‚

ä¸‰ã€åŸºæœ¬ä½¿ç”¨
å¼€å§‹ä½¿ç”¨ serde_yaml ä¹‹å‰ï¼Œå…ˆåˆ›å»ºä¸€ä¸ª serde_yaml_test é¡¹ç›®æ–‡ä»¶å¤¹ï¼Œåœ¨æ–‡ä»¶å¤¹ä¸­ä½¿ç”¨ cargo init åˆå§‹åŒ– rust é¡¹ç›®ï¼Œç„¶ååœ¨é¡¹ç›®çš„ Cargo.toml æ–‡ä»¶ä¸­æ·»åŠ ä¾èµ–ï¼š"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"ğŸ“šæ–‡ç« ","item":"https://lorenwe.eu.org/posts/"},{"@type":"ListItem","position":2,"name":"ğŸ‘¨ğŸ»â€ğŸ’» æŠ€æœ¯","item":"https://lorenwe.eu.org/posts/tech/"},{"@type":"ListItem","position":3,"name":"Rustå¦‚ä½•æ­£ç¡®è§£æyamlæ–‡ä»¶","item":"https://lorenwe.eu.org/posts/tech/rust%E5%A6%82%E4%BD%95%E6%AD%A3%E7%A1%AE%E8%A7%A3%E6%9E%90yaml%E6%96%87%E4%BB%B6/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Rustå¦‚ä½•æ­£ç¡®è§£æyamlæ–‡ä»¶","name":"Rustå¦‚ä½•æ­£ç¡®è§£æyamlæ–‡ä»¶","description":"ä¸€ã€ç®€ä»‹ serde_yaml æ˜¯ Rust è¯­è¨€ä¸­ä¸€ä¸ªç”¨äºåºåˆ—åŒ–å’Œååºåˆ—åŒ– YAML æ•°æ®çš„åº“ã€‚å®ƒä»¥å…¶é«˜æ€§èƒ½å’Œçµæ´»æ€§è€Œå¹¿å—æ¬¢è¿ï¼Œç‰¹åˆ«é€‚ç”¨äºéœ€è¦å¤„ç† YAML é…ç½®æ–‡ä»¶çš„é¡¹ç›®ã€‚åœ¨è¿™ç¯‡åšå®¢ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨ serde_yaml çš„åŸºæœ¬ç”¨æ³•ï¼Œå¹¶æä¾›ä¸€äº›å®ç”¨çš„ç¤ºä¾‹ä»£ç ã€‚\näºŒã€ä½¿ç”¨åœºæ™¯ serde_yaml å¸¸ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š\né…ç½®ç®¡ç†ï¼šè®¸å¤šåº”ç”¨ç¨‹åºä½¿ç”¨ YAML æ–‡ä»¶æ¥å­˜å‚¨é…ç½®å‚æ•°ï¼Œserde_yaml å¯ä»¥è½»æ¾è§£æè¿™äº›æ–‡ä»¶ã€‚ æ•°æ®äº¤æ¢ï¼šåœ¨ç³»ç»Ÿä¹‹é—´ä¼ é€’æ•°æ®æ—¶ï¼ŒYAML æ ¼å¼å› å…¶å¯è¯»æ€§è€Œå¸¸è¢«é€‰ç”¨ã€‚ æ–‡æ¡£ç”Ÿæˆï¼šä¸€äº›å·¥å…·ä½¿ç”¨ YAML æ¥æè¿°æ–‡æ¡£ç»“æ„ï¼Œserde_yaml å¯ä»¥å¸®åŠ©ç”Ÿæˆå’Œè§£æè¿™äº›æ–‡æ¡£ã€‚ ä¸‰ã€åŸºæœ¬ä½¿ç”¨ å¼€å§‹ä½¿ç”¨ serde_yaml ä¹‹å‰ï¼Œå…ˆåˆ›å»ºä¸€ä¸ª serde_yaml_test é¡¹ç›®æ–‡ä»¶å¤¹ï¼Œåœ¨æ–‡ä»¶å¤¹ä¸­ä½¿ç”¨ cargo init åˆå§‹åŒ– rust é¡¹ç›®ï¼Œç„¶ååœ¨é¡¹ç›®çš„ Cargo.toml æ–‡ä»¶ä¸­æ·»åŠ ä¾èµ–ï¼š\n","keywords":[""],"articleBody":"ä¸€ã€ç®€ä»‹ serde_yaml æ˜¯ Rust è¯­è¨€ä¸­ä¸€ä¸ªç”¨äºåºåˆ—åŒ–å’Œååºåˆ—åŒ– YAML æ•°æ®çš„åº“ã€‚å®ƒä»¥å…¶é«˜æ€§èƒ½å’Œçµæ´»æ€§è€Œå¹¿å—æ¬¢è¿ï¼Œç‰¹åˆ«é€‚ç”¨äºéœ€è¦å¤„ç† YAML é…ç½®æ–‡ä»¶çš„é¡¹ç›®ã€‚åœ¨è¿™ç¯‡åšå®¢ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨ serde_yaml çš„åŸºæœ¬ç”¨æ³•ï¼Œå¹¶æä¾›ä¸€äº›å®ç”¨çš„ç¤ºä¾‹ä»£ç ã€‚\näºŒã€ä½¿ç”¨åœºæ™¯ serde_yaml å¸¸ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š\né…ç½®ç®¡ç†ï¼šè®¸å¤šåº”ç”¨ç¨‹åºä½¿ç”¨ YAML æ–‡ä»¶æ¥å­˜å‚¨é…ç½®å‚æ•°ï¼Œserde_yaml å¯ä»¥è½»æ¾è§£æè¿™äº›æ–‡ä»¶ã€‚ æ•°æ®äº¤æ¢ï¼šåœ¨ç³»ç»Ÿä¹‹é—´ä¼ é€’æ•°æ®æ—¶ï¼ŒYAML æ ¼å¼å› å…¶å¯è¯»æ€§è€Œå¸¸è¢«é€‰ç”¨ã€‚ æ–‡æ¡£ç”Ÿæˆï¼šä¸€äº›å·¥å…·ä½¿ç”¨ YAML æ¥æè¿°æ–‡æ¡£ç»“æ„ï¼Œserde_yaml å¯ä»¥å¸®åŠ©ç”Ÿæˆå’Œè§£æè¿™äº›æ–‡æ¡£ã€‚ ä¸‰ã€åŸºæœ¬ä½¿ç”¨ å¼€å§‹ä½¿ç”¨ serde_yaml ä¹‹å‰ï¼Œå…ˆåˆ›å»ºä¸€ä¸ª serde_yaml_test é¡¹ç›®æ–‡ä»¶å¤¹ï¼Œåœ¨æ–‡ä»¶å¤¹ä¸­ä½¿ç”¨ cargo init åˆå§‹åŒ– rust é¡¹ç›®ï¼Œç„¶ååœ¨é¡¹ç›®çš„ Cargo.toml æ–‡ä»¶ä¸­æ·»åŠ ä¾èµ–ï¼š\nserde = { version = \"1.0\", features = [\"derive\"] } serde_yaml = \"0.9.34\" è¦ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ serde çš„è¯å¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œæ¥æ·»åŠ ä¾èµ–ï¼Œå¦‚ï¼š\ncargo add serde --features=\"derive\" cargo add serde_yaml ä¾èµ–çš„åŒ…éƒ½å‡†å¤‡å®Œæˆåï¼Œå°±æ¥çœ‹çœ‹å‡ ä¸ªç¤ºä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½•è¯»å–ã€è§£æå’Œç”Ÿæˆ YAML æ–‡ä»¶ã€‚\n1ã€è¯»å–å’Œè§£æ YAML æ–‡ä»¶ ä»¥ä¸‹æ˜¯ä¸€ä¸ªåŸºæœ¬ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ serde_yaml è¯»å–å’Œè§£æä¸€ä¸ªåä¸ºÂ ä»¥ä¸‹æ˜¯ä¸€ä¸ªåŸºæœ¬ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ serde_yaml è¯»å–å’Œè§£æä¸€ä¸ªåä¸ºÂ hello.ymlÂ çš„æ–‡ä»¶ï¼šÂ çš„æ–‡ä»¶ï¼š\n# åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ª hello.yml æ–‡ä»¶ touch hello.yml # æ­¤æ—¶ç›®å½•ç»“æ„ä¸º #|-serde_yaml_test # |--src # |--target # |--.gitignore # |--Cargo.lock # |--Cargo.toml # |--hello.yml use std::collections::BTreeMap; use std::fs::File; use std::io::Read; use serde_yaml; fn main() -\u003e Result\u003c(), Box\u003e { let mut file = File::open(\"hello.yml\")?; // æ‰“å¼€æ–‡ä»¶ hello.yml let mut contents = String::new(); // åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸² file.read_to_string(\u0026mut contents)?; // è¯»å–æ–‡ä»¶å†…å®¹åˆ°å­—ç¬¦ä¸²ç¼“å†²åŒº println!(\"YAML file contents:\\n{}\", contents); // æ‰“å°åŸå§‹çš„YAMLå­—ç¬¦ä¸² // å°†YAMLå­—ç¬¦ä¸²ååºåˆ—åŒ–ä¸ºBTreeMap let deserialized_map: BTreeMap = serde_yaml::from_str(\u0026contents)?; println!(\"Deserialized map: {:#?}\", deserialized_map); // æ‰“å°ååºåˆ—åŒ–åçš„æ•°æ®ç»“æ„ if let Some(name) = deserialized_map.get(\"name\").and_then(|v| v.as_str()) { println!(\"name: {}\", name); // æ‰“å° name } else { println!(\"The key 'name' was not found or is not a string.\"); } Ok(()) } // è¾“å‡ºç»“æœï¼š // Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.03s // Running `target\\debug\\serde_yaml_test.exe` // YAML file contents: // name: data // Deserialized map: { // \"name\": String(\"data\"), // } // name: data 2ã€åºåˆ—åŒ–æ•°æ®ç»“æ„ä¸º YAML ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•å°†ä¸€ä¸ª Rust æ•°æ®ç»“æ„åºåˆ—åŒ–ä¸º YAML æ ¼å¼çš„å­—ç¬¦ä¸²ï¼š\nuse std::collections::BTreeMap; use serde_yaml; fn main() -\u003e Result\u003c(), Box\u003e { // åˆ›å»ºä¸€ä¸ª BTreeMap æ•°æ®ç»“æ„ let mut data = BTreeMap::new(); data.insert(\"name\".to_string(), serde_yaml::Value::String(\"Alice\".to_string())); data.insert(\"age\".to_string(), serde_yaml::Value::Number(serde_yaml::Number::from(30))); // å°†æ•°æ®ç»“æ„åºåˆ—åŒ–ä¸º YAML å­—ç¬¦ä¸² let yaml_string = serde_yaml::to_string(\u0026data)?; // æ‰“å°åºåˆ—åŒ–åçš„ YAML å­—ç¬¦ä¸² println!(\"Serialized YAML:\\n{}\", yaml_string); Ok(()) } 3ã€ä½¿ç”¨è‡ªå®šä¹‰ç»“æ„ä½“è¿›è¡Œååºåˆ—åŒ– ä½¿ç”¨è‡ªå®šä¹‰ç»“æ„ä½“æ¥è§£æ YAML æ•°æ®ä¼šæ›´åŠ æ–¹ä¾¿å’Œç›´è§‚ã€‚ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•å®šä¹‰ä¸€ä¸ªç»“æ„ä½“å¹¶è§£æ YAML æ•°æ®ï¼š\nuse serde::{Deserialize, Serialize}; use serde_yaml; #[derive(Debug, Serialize, Deserialize)] struct Person { name: String, age: u8, } fn main() -\u003e Result\u003c(), Box\u003e { // å®šä¹‰ä¸€ä¸ª YAML å­—ç¬¦ä¸² let yaml_str = \" name: Bob age: 25 \"; // å°† YAML å­—ç¬¦ä¸²ååºåˆ—åŒ–ä¸º Person ç»“æ„ä½“ let person: Person = serde_yaml::from_str(yaml_str)?; // æ‰“å°ååºåˆ—åŒ–åçš„ç»“æ„ä½“ println!(\"Deserialized person: {:?}\", person); Ok(()) } 4ã€ä»æ–‡ä»¶æµä¸­ç›´æ¥è§£æ æœ‰æ—¶ï¼Œä¸ºäº†ä¼˜åŒ–å†…å­˜ä½¿ç”¨ï¼Œå¯ä»¥ç›´æ¥ä»æ–‡ä»¶æµä¸­è¿›è¡Œè§£æï¼š\nuse serde::{Deserialize, Serialize}; use std::fs::File; #[derive(Debug, Serialize, Deserialize)] struct Config { database_url: String, port: u16, } fn main() -\u003e Result\u003c(), Box\u003e { // æ‰“å¼€é…ç½®æ–‡ä»¶ let file = File::open(\"config.yml\")?; // ä»æ–‡ä»¶æµä¸­ç›´æ¥ååºåˆ—åŒ– let config: Config = serde_yaml::from_reader(file)?; // æ‰“å°ååºåˆ—åŒ–åçš„é…ç½® println!(\"Config: {:?}\", config); Ok(()) } å››ã€å¤æ‚ YAML æ–‡ä»¶è§£æ åŸºäºä»¥ä¸Šæ¡ˆä¾‹ï¼Œæ¥å°è¯•è§£æä¸€ä¸ªå¤æ‚çš„ yaml æ–‡ä»¶ï¼Œæ—¢ç„¶è¦å¤æ‚ï¼Œé‚£å°±å°è¯•è§£æä¸€ä¸‹ docker-compose.ymlæ–‡ä»¶å§ï¼å…ˆæ¥å‡†å¤‡ä¸€ä¸ª yaml æ–‡ä»¶ï¼Œæ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œå¦‚ä¸‹ï¼š\nversion: \"3.9\" services: redis: image: redis:latest restart: always privileged: true ports: - 6379:6379 volumes: - ./data/redis/data:/data - ./redis/etc:/usr/local/etc/redis command: redis-server /usr/local/etc/redis/redis.conf nginx: image: nginx:latest restart: always privileged: true volumes: - ./nginx/etc/nginx:/etc/nginx - ./var/www:/var/www/html ports: - \"80:80\" - \"443:443\" depends_on: - redis networks: mynet1: driver: overlay attachable: false å†å†™ä»£ç ä¹‹å‰ï¼Œå…ˆæŠŠ rust å¼•å…¥çš„åŒ…å…ˆè´´å‡ºæ¥ï¼Œåé¢è´´ä»£ç æ—¶å¯ä»¥å°‘å†™ä¸€ç‚¹å•°å—¦ä»£ç ï¼Œåªå…³æ³¨æ ¸å¿ƒé€»è¾‘ï¼Œçœ‹èµ·æ¥æ›´æ¸…æ™°æ˜“æ‡‚ï¼Œè¿™æ˜¯æ•´ä¸ªé¡¹ç›®æ‰€ä¾èµ–çš„åŒ…ï¼Œä¹Ÿæ²¡æœ‰å¾ˆå¤š\nuse std::collections::HashMap; use std::fmt::{Debug, Display}; use std::fs::File; use std::io::Read; use serde::{Deserialize, Serialize}; 1.å›ºå®šå­—æ®µè§£æ æ•´ä¸ª yml æ–‡ä»¶çœ‹ä¸‹æ¥ï¼Œå¹¶æ²¡æœ‰å¾ˆå¤šï¼Œä½†ç®—æ˜¯ä¸€ä¸ªæ¯”è¾ƒå…¨é¢çš„ docker-compose é…ç½®æ–‡ä»¶äº†ï¼Œè™½ç„¶æ²¡æœ‰ç”¨åˆ°æ‰€æœ‰çš„é…ç½®å­—æ®µï¼Œè§¦ç±»æ—é€šï¼Œå†å¤šçš„é…ç½®å­—æ®µéƒ½èƒ½è½»è½¦ç†Ÿè·¯çš„è§£æå§ï¼Œå…ˆä¸€çº§ä¸€çº§çš„çœ‹ï¼Œä¸€çº§æœ‰ version services networksï¼Œé€šè¿‡ä»¥ä¸Šï¼Œå°±å¯ä»¥å®šä¹‰å‡ºéœ€è¦çš„ç»“æ„ä½“äº†ï¼š\n#[derive(Debug, Serialize, Deserialize)] struct DockerYaml { version: String, services: HashMap, } è¿™é‡Œçš„ services çš„ç±»å‹ç”¨çš„æ˜¯ HashMapï¼Œå› ä¸º services åç§°æ˜¯ä¸€ä¸ªå˜é‡ï¼Œè€Œä¸”æ•°é‡ä¸å›ºå®šï¼Œæ¯”å¦‚è¿˜å¯ä»¥å¢åŠ  mysql æœåŠ¡ï¼Œæ‰€ä»¥ services æ˜¯ä¸€ä¸ªåŠ¨æ€ï¼Œservices é‡Œé¢åˆå¼•å…¥äº† ServiceCfg ç±»å‹ï¼Œç°åœ¨ç»§ç»­çœ‹ services ä¸‹ä¸€çº§çš„é…ç½®å­—æ®µï¼Œå…¶ä¸­ image æ˜¯å¿…é¡»è¦å­˜åœ¨çš„é…ç½®ï¼Œé‚£ ServiceCfg ç»“æ„ä½“å¯ä»¥å®šä¹‰æˆï¼š\n#[derive(Debug, Clone, Serialize, Deserialize)] struct ServiceCfg { image: String, } å¥½äº†ï¼Œå°±è¿™ä¹ˆç®€å•ï¼Œå…ˆå†™ä¸ª main å‡½æ•°æŠŠä»£ç è·‘èµ·æ¥çœ‹çœ‹å§ï¼\nfn main() -\u003e Result\u003c(), Box\u003e { let mut file = File::open(\"docker-compose.yml\")?; // æ‰“å¼€æ–‡ä»¶ let mut contents = String::new(); // åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸² file.read_to_string(\u0026mut contents)?; // è¯»å–æ–‡ä»¶å†…å®¹åˆ°å­—ç¬¦ä¸²ç¼“å†²åŒº // println!(\"è¯»å–åˆ°çš„ YAML å†…å®¹:\\n{}\", contents); // æ‰“å°åŸå§‹çš„YAMLå­—ç¬¦ä¸² // å°† YAML å­—ç¬¦ä¸²ååºåˆ—åŒ–ä¸º DockerYaml ç»“æ„ä½“ let docker_yaml: DockerYaml = serde_yaml::from_str(\u0026contents)?; // æ‰“å°ååºåˆ—åŒ–åçš„ç»“æ„ä½“ println!(\"ååºåˆ—åŒ–åçš„ç»“æ„ä½“: {:?}\", docker_yaml); // è¯»å–å‡º services let services = \u0026docker_yaml.services; for (serve, config) in services { println!(\"services name: {}\", serve); println!(\"services config: {:?}\", config); } Ok(()) } // æ‰“å°çš„å†…å®¹ï¼š // ååºåˆ—åŒ–åçš„ç»“æ„ä½“: DockerYaml { version: \"3.9\", services: {\"nginx\": ServiceCfg { image: \"nginx:latest\" }, \"redis\": ServiceCfg { image: \"redis:latest\" }} } // services name: nginx // services config: ServiceCfg { image: \"nginx:latest\" } // services name: redis // services config: ServiceCfg { image: \"redis:latest\" } æ­£å¸¸æ‰“å°äº†ï¼Œç°åœ¨å¯ä»¥å®Œå–„ ServiceCfg è¿™ä¸ªç»“æ„ä½“äº†\n2.åŠ¨æ€å­—æ®µè§£æ docker-compose é…ç½®çš„ services ä¸­ï¼Œå¤§éƒ¨åˆ†é…ç½®éƒ½å¯é€‰çš„ï¼Œå¦‚æœä¸é…ç½®ï¼Œå°±ä¼šæœ‰ä¸ªé»˜è®¤å€¼ï¼Œå…ˆä¸å…³å¿ƒè¿™ä¸ªé»˜è®¤å€¼æ˜¯ä»€ä¹ˆï¼Œä½†èµ·ç è¦å®ç°ä¸€ä¸ªä¸é…ç½®ä¼šæœ‰é»˜è®¤å€¼çš„åŠŸèƒ½ï¼Œå¸¦ç€ç–‘é—®ï¼Œå…ˆå»å†™ä¸€ä¸‹ä»£ç ï¼Œ\næŠŠ ServiceCfg ç»“æ„ä½“ä¿®æ”¹æˆä»¥ä¸‹çš„æ ·å­ï¼š\n#[derive(Debug, Clone, Serialize, Deserialize)] struct ServiceCfg { image: String, restart: String, } åªæ˜¯æ·»åŠ äº†ä¸€ä¸ª restart é…ç½®é¡¹ï¼Œmain å‡½æ•°ä¸å˜ï¼Œcargo run ä¸€ä¸‹å‘ç°æ­£å¸¸æ‰“å°äº†å¦‚ä¸‹ï¼š\nååºåˆ—åŒ–åçš„ç»“æ„ä½“: DockerYaml { version: \"3.9\", services: {\"nginx\": ServiceCfg { image: \"nginx:latest\", restart: \"always\" }, \"redis\": ServiceCfg { image: \"redis:latest\", restart: \"always\" }} } services name: nginx services config: ServiceCfg { image: \"nginx:latest\", restart: \"always\" } services name: redis services config: ServiceCfg { image: \"redis:latest\", restart: \"always\" } restart é…ç½®é¡¹æ­£å¸¸è¯»å–åˆ°äº†ï¼Œå¥½åƒä¸€åˆ‡éƒ½å¾ˆå®Œç¾ï¼Œä½† restart é…ç½®æ˜¯ä¸ªå¯é€‰é…ç½®ï¼Œé‚£åœ¨ docker-compose.ymlÂ æ–‡ä»¶ä¸­éšä¾¿æŒ‘ä¸€ä¸ª restart é…ç½®æ³¨é‡Šæ‰çœ‹çœ‹\nversion: \"3.9\" services: redis: image: redis:latest # restart: always privileged: false å†æ¬¡è¿è¡Œ cargo run å°±ä¼šå‘ç°æŠ¥é”™äº†ï¼ŒæŠ¥é”™å¾ˆæ˜æ˜¾ï¼Œç¼ºå°‘ restart è¿™ä¸ªé…ç½®\nError: Error(\"services.redis: missing field `restart`\", line: 4, column: 5) error: process didn't exit successfully: `target\\debug\\serde_yaml_test.exe` (exit code: 1) è¦è§£å†³è¿™ä¸ªé—®é¢˜å¾ˆç®€å•ï¼Œserde æä¾›äº†ä¸€ä¸ªå­—æ®µå±æ€§å¯ä»¥å¿«é€Ÿè®¾ç½®è¿™ä¸ªå­—æ®µçš„é»˜è®¤å€¼ï¼Œ\n#[serde(default)] å¦‚æœååºåˆ—åŒ–æ—¶è¯¥å€¼ä¸å­˜åœ¨ï¼Œä½¿ç”¨Default::default()ç”Ÿæˆé»˜è®¤å€¼\nåœ¨ ServiceCfg.restart ä¸­åŠ ä¸Šå°±å¯ä»¥ï¼Œæ‰€ä»¥æŠŠ ServiceCfg ç»“æ„ä½“ä¿®æ”¹æˆä»¥ä¸‹çš„æ ·å­ï¼š\n#[derive(Debug, Clone, Serialize, Deserialize)] struct ServiceCfg { image: String, #[serde(default)] restart: String, } // å†æ¬¡æ‰§è¡Œ cargo run åä¼šå¾—åˆ°ä»¥ä¸‹è¾“å‡º // ååºåˆ—åŒ–åçš„ç»“æ„ä½“: DockerYaml { version: \"3.9\", services: {\"nginx\": ServiceCfg { image: \"nginx:latest\", restart: \"always\" }, \"redis\": ServiceCfg { image: \"redis:latest\", restart: \"\" }} } // services name: nginx // services config: ServiceCfg { image: \"nginx:latest\", restart: \"always\" } // services name: redis // services config: ServiceCfg { image: \"redis:latest\", restart: \"\" } è‡ªæ­¤ï¼Œå¯é€‰é…ç½®çš„é»˜è®¤å€¼é—®é¢˜å°±è§£å†³äº†ï¼Œä½†åˆæœ‰ä¸ªé—®é¢˜ï¼Œports å’Œ volumes è¯¥ä½¿ç”¨ä»€ä¹ˆæ•°æ®ç±»å‹æ¥æ‰¿è½½å‘¢ï¼Œå…¶å® yml æ–‡ä»¶ä¸­ï¼Œæ‰€æœ‰ä»¥ - å¼€å¤´çš„ï¼Œéƒ½è¡¨ç¤ºåŒä¸€çº§ä¸‹æœ‰å¤šä¸ªå€¼ï¼Œå°±é‚£ redis çš„ volumes æ¥è¯´ï¼Œä»–è¡¨ç¤ºè¦æ˜ å°„æœ¬åœ°å¤šä¸ªæ•°æ®å·åˆ°å®¹å™¨ä¸­ï¼Œå…·ä½“å¤šå°‘ä¸ªï¼Ÿä¸çŸ¥é“ï¼Œé‚£è¿™ç§ç»“æ„æ˜¯ä¸æ˜¯æœ‰ç‚¹åƒå¯å˜é•¿åº¦çš„æ•°ç»„ï¼Œåœ¨ rust ä¸­æœ€é€‚åˆè¿™ç§ç»“æ„çš„ç±»å‹æ˜¯ä¸æ˜¯å°±æ˜¯ Vec äº†ï¼ŒåŸºäºæ­¤æœ€ç»ˆå®Œå–„ ServiceCfg ç»“æ„ä½“çš„å†…å®¹å¦‚ä¸‹ï¼š\n#[derive(Debug, Clone, Serialize, Deserialize)] struct ServiceCfg { image: String, #[serde(default)] restart: String, #[serde(default)] privileged: bool, #[serde(default)] ports: Vec, #[serde(default)] volumes: Vec, #[serde(default)] command: String, #[serde(default)] depends_on: Vec, } ç°åœ¨å¯ä»¥éšæ„æ³¨é‡Šæ‰ services ä¸­çš„é™¤ image é…ç½®å¤–çš„æ‰€æœ‰é…ç½®äº†ï¼Œè€Œä¸”è§£æä¹Ÿä¸ä¼šæŠ¥é”™ï¼Œä¹Ÿæœ‰é»˜è®¤å€¼äº†ï¼ŒæŠŠ networks é…ç½®ä¹Ÿä¸€å¹¶å®ç°äº†å§\n#[derive(Debug, Serialize, Deserialize)] struct DockerYaml { version: String, services: HashMap, #[serde(default)] networks: HashMap, } #[derive(Debug, Clone, Serialize, Deserialize)] struct ServiceCfg { image: String, #[serde(default)] restart: String, #[serde(default)] privileged: bool, #[serde(default)] ports: Vec, #[serde(default)] volumes: Vec, #[serde(default)] command: String, #[serde(default)] depends_on: Vec, } #[derive(Debug, Clone, Serialize, Deserialize)] struct NetworkCfg { #[serde(default)] driver: Option, #[serde(default)] attachable: Option, } fn main() -\u003e Result\u003c(), Box\u003e { let mut file = File::open(\"docker-compose.yml\")?; // æ‰“å¼€æ–‡ä»¶ let mut contents = String::new(); // åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸² file.read_to_string(\u0026mut contents)?; // è¯»å–æ–‡ä»¶å†…å®¹åˆ°å­—ç¬¦ä¸²ç¼“å†²åŒº // println!(\"è¯»å–åˆ°çš„ YAML å†…å®¹:\\n{}\", contents); // æ‰“å°åŸå§‹çš„YAMLå­—ç¬¦ä¸² // å°† YAML å­—ç¬¦ä¸²ååºåˆ—åŒ–ä¸º DockerYaml ç»“æ„ä½“ let docker_yaml: DockerYaml = serde_yaml::from_str(\u0026contents)?; // æ‰“å°ååºåˆ—åŒ–åçš„ç»“æ„ä½“ println!(\"ååºåˆ—åŒ–åçš„ç»“æ„ä½“: {:?}\", docker_yaml); // è¯»å–å‡º services let services = \u0026docker_yaml.services; for (serve, config) in services { println!(\"services name: {}\", serve); println!(\"services config: {:?}\", config); } // è¯»å–å‡º networks let networks = \u0026docker_yaml.networks; for (serve, config) in networks { println!(\"networks name: {}\", serve); println!(\"networks config: {:?}\", config); } // å°†æ•°æ®ç»“æ„åºåˆ—åŒ–ä¸º YAML å­—ç¬¦ä¸² let yaml_string = serde_yaml::to_string(\u0026docker_yaml)?; println!(\"åºåˆ—åŒ–ä¸º YAML å­—ç¬¦ä¸²:\\n{}\", yaml_string); // æ‰“å°åºåˆ—åŒ–åçš„ YAML å­—ç¬¦ä¸² Ok(()) } å› ä¸º networks é…ç½®ä¹Ÿæ˜¯ä¸€ä¸ªå¯é€‰é…ç½®ï¼Œæ‰€ä»¥åœ¨ DockerYaml ç»“æ„ä½“ä¸­è¦åŠ ä¸Š #[serde(default)]å­—æ®µå±æ€§ï¼Œè‡³æ­¤ï¼Œè¯»å– yml æ–‡ä»¶ç®—æ˜¯å®Œæˆäº†ï¼Œä½†çœ‹ä¸Šé¢çš„ main å‡½æ•°ï¼ŒæŠŠååºåˆ—åŒ–çš„ç»“æ„ä½“å†è½¬æ¢ä¸º yml æ–‡ä»¶ï¼Œå°±ä¼šæœ‰ç‚¹ç‚¹å°é—®é¢˜ï¼Œå®é™…ä¸Šä¸Šé¢ä»£ç æ‰§è¡Œå®Œåä¼šç”Ÿæˆä¸€ä¸ªè·Ÿè¯»å–çš„ yml æ–‡ä»¶ä¸ä¸€æ ·å†…å®¹çš„ yml å­—ç¬¦ä¸²å‡ºæ¥ï¼Œå¦‚æœæœŸæœ›è¯»å–çš„ä»€ä¹ˆ yml ç”Ÿæˆçš„ yml ä¹Ÿä¸€æ¨¡ä¸€æ ·æ€ä¹ˆåŠï¼Ÿ\n3.åºåˆ—åŒ–æ—¶å‰”é™¤é»˜è®¤é…ç½® éœ€è¦å¯é€‰å­—æ®µåœ¨æœªè®¾ç½®æ—¶åœ¨ååºåˆ—æ—¶æœ‰ç”Ÿæˆé»˜è®¤å€¼ï¼Œä½†åœ¨åºåˆ—åŒ–æ—¶æŠŠé»˜è®¤å€¼å»é™¤ï¼Œå¯ä»¥ä½¿ç”¨ serde çš„ #[serde(skip_serializing_if = \"path\")] è°ƒç”¨ä¸€ä¸ªå‡½æ•°æ¥ç¡®å®šæ˜¯å¦è·³è¿‡åºåˆ—åŒ–è¯¥å­—æ®µã€‚ç»™å®šçš„å‡½æ•°å¿…é¡»å¯ä»¥ä½œä¸ºfn(\u0026T)-\u003eboolè°ƒç”¨ï¼Œå°½ç®¡å®ƒå¯èƒ½æ˜¯Tä¸Šçš„æ³›å‹ã€‚ä¾‹å¦‚skip_serializing_if=\"Option::is_none\"å¦‚æœå€¼æ˜¯ Noneï¼Œé‚£ä¹ˆå°±ä¼šè·³è¿‡ã€‚\nç°åœ¨æ¥æ”¹é€ ä¸€ä¸‹ä¸Šé¢çš„ ServiceCfg ï¼š\n#[derive(Debug, Clone, Serialize, Deserialize)] struct ServiceCfg { image: String, #[serde(skip_serializing_if = \"String::is_empty\", default)] restart: String, #[serde(skip_serializing_if = \"Option::is_none\", default)] privileged: Option, #[serde(skip_serializing_if = \"Vec::is_empty\", default)] ports: Vec, #[serde(skip_serializing_if = \"Vec::is_empty\", default)] volumes: Vec, #[serde(skip_serializing_if = \"String::is_empty\", default)] command: String, #[serde(skip_serializing_if = \"Vec::is_empty\", default)] depends_on: Vec, } è¿™é‡Œæœ‰ä¸ªç»†èŠ‚æ˜¯ privileged å±æ€§ç”±åŸæ¥çš„ bool ç±»å‹æ¢æˆäº† Optionï¼Œ å…¶ä¸­ç¼˜ç”±å°±æ˜¯ bool ç±»å‹ä¸å¥½åšç±»å‹é»˜è®¤å€¼åˆ¤æ–­ï¼Œ åƒå…¶ä»–çš„ Stringï¼ŒVecï¼ŒOption éƒ½æœ‰å¯¹åº”çš„å‡½æ•°ç»™ skip_serializing_if åšé»˜è®¤å€¼åˆ¤æ–­ï¼Œæ¢æˆ Option åï¼Œè§£ææ—¶å¦‚æœé‡åˆ°æœªé…ç½®æ—¶å°±ä¼šä½¿ç”¨ None ä»£æ›¿åŸæ¥çš„ bool é»˜è®¤å€¼ï¼Œå› ä¸º Option ç±»å‹çš„é»˜è®¤å€¼å°±æ˜¯ None ï¼Œåé¢ä½¿ç”¨èµ·æ¥ä¹Ÿæ˜¯å¾ˆæ–¹ä¾¿çš„ï¼Œå®é™…ä¸Šæ‰€æœ‰çš„å¯é€‰å­—æ®µé…ç½®éƒ½å¯ä»¥ä½¿ç”¨ Option ç±»å‹åŒ…èµ·æ¥ï¼Œæ¯”å¦‚: depends_on : Option","wordCount":"3950","inLanguage":"zh","datePublished":"2024-10-23T11:14:01+08:00","dateModified":"2024-10-23T11:14:01+08:00","author":[{"@type":"Person","name":"Lorenwe"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://lorenwe.eu.org/posts/tech/rust%E5%A6%82%E4%BD%95%E6%AD%A3%E7%A1%AE%E8%A7%A3%E6%9E%90yaml%E6%96%87%E4%BB%B6/"},"publisher":{"@type":"Organization","name":"Lorenwe Blog","logo":{"@type":"ImageObject","url":"https://lorenwe.eu.org/img/favicon.ico"}}}</script></head><body id=top><script>(function(){let e,t=new RegExp("(^| )change-themes=([^;]*)(;|$)");(e=document.cookie.match(t))||((new Date).getHours()>=19||(new Date).getHours()<6?(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark")):(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")))})(),localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://lorenwe.eu.org/ accesskey=h title="Lorenwe Blog (Alt + H)"><img src=https://lorenwe.eu.org/img/kaola.png alt=logo aria-label=logo height=35>Lorenwe Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)">
<svg id="moon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://lorenwe.eu.org/search title="ğŸ” æœç´¢ (Alt + /)" accesskey=/><span>ğŸ” æœç´¢</span></a></li><li><a href=https://lorenwe.eu.org/ title="ğŸ  ä¸»é¡µ"><span>ğŸ  ä¸»é¡µ</span></a></li><li><a href=https://lorenwe.eu.org/posts title="ğŸ“š æ–‡ç« "><span>ğŸ“š æ–‡ç« </span></a></li><li><a href=https://lorenwe.eu.org/tags title="ğŸ§© æ ‡ç­¾"><span>ğŸ§© æ ‡ç­¾</span></a></li><li><a href=https://lorenwe.eu.org/archives/ title="â±ï¸ æ—¶é—´è½´"><span>â±ï¸ æ—¶é—´è½´</span></a></li><li><a href=https://lorenwe.eu.org/about title="ğŸ™‹ğŸ»â€â™‚ï¸ å…³äº"><span>ğŸ™‹ğŸ»â€â™‚ï¸ å…³äº</span></a></li><li><a href=https://lorenwe.eu.org/links title="ğŸ¤ å‹é“¾"><span>ğŸ¤ å‹é“¾</span></a></li></ul></nav></header><main class="main page"><style>i[id*=post_meta_style]{display:flex;align-items:center;margin:0 0 10px}</style><article class=post-single><div id=single-content><header class=post-header><div class=breadcrumbs><a href=https://lorenwe.eu.org/>ğŸ  ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href=https://lorenwe.eu.org/posts/>ğŸ“šæ–‡ç« </a>&nbsp;Â»&nbsp;<a href=https://lorenwe.eu.org/posts/tech/>ğŸ‘¨ğŸ»â€ğŸ’» æŠ€æœ¯</a></div><h1 class=post-title>Rustå¦‚ä½•æ­£ç¡®è§£æyamlæ–‡ä»¶</h1><div class=post-meta><style>i[id*=post_meta_style]{display:flex;align-items:center;margin:0 0 10px}.parent-post-meta{display:flex;flex-wrap:wrap;opacity:.8}</style><span class=parent-post-meta><span id=post_meta_style_1><span class="fa fa-calendar-check-o"></span>
<span>2024-10-23
&nbsp;&nbsp;
</span></span><span id=post_meta_style_3><span class="fa fa-file-word-o"></span>
<span>3950å­—
&nbsp;&nbsp;
</span></span><span id=post_meta_style_4><span class="fa fa-clock-o"></span>
<span>8åˆ†é’Ÿ
&nbsp;&nbsp;
</span></span><span id=post_meta_style_5><span class="fa fa-user-o"></span>
<span>Lorenwe
&nbsp;&nbsp;
</span></span><span id=post_meta_style_6><span class="fa fa-tags" style=opacity:.8></span>
<span><span class=post-tags-meta></span></span></span></span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>ç›®å½•</span></summary><div class=inner><ul><li><a href=#%e4%b8%80%e7%ae%80%e4%bb%8b aria-label=ä¸€ã€ç®€ä»‹>ä¸€ã€ç®€ä»‹</a></li><li><a href=#%e4%ba%8c%e4%bd%bf%e7%94%a8%e5%9c%ba%e6%99%af aria-label=äºŒã€ä½¿ç”¨åœºæ™¯>äºŒã€ä½¿ç”¨åœºæ™¯</a></li><li><a href=#%e4%b8%89%e5%9f%ba%e6%9c%ac%e4%bd%bf%e7%94%a8 aria-label=ä¸‰ã€åŸºæœ¬ä½¿ç”¨>ä¸‰ã€åŸºæœ¬ä½¿ç”¨</a><ul><li><a href=#1%e8%af%bb%e5%8f%96%e5%92%8c%e8%a7%a3%e6%9e%90-yaml-%e6%96%87%e4%bb%b6 aria-label="1ã€è¯»å–å’Œè§£æ YAML æ–‡ä»¶">1ã€è¯»å–å’Œè§£æ YAML æ–‡ä»¶</a></li><li><a href=#2%e5%ba%8f%e5%88%97%e5%8c%96%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84%e4%b8%ba-yaml aria-label="2ã€åºåˆ—åŒ–æ•°æ®ç»“æ„ä¸º YAML">2ã€åºåˆ—åŒ–æ•°æ®ç»“æ„ä¸º YAML</a></li><li><a href=#3%e4%bd%bf%e7%94%a8%e8%87%aa%e5%ae%9a%e4%b9%89%e7%bb%93%e6%9e%84%e4%bd%93%e8%bf%9b%e8%a1%8c%e5%8f%8d%e5%ba%8f%e5%88%97%e5%8c%96 aria-label=3ã€ä½¿ç”¨è‡ªå®šä¹‰ç»“æ„ä½“è¿›è¡Œååºåˆ—åŒ–>3ã€ä½¿ç”¨è‡ªå®šä¹‰ç»“æ„ä½“è¿›è¡Œååºåˆ—åŒ–</a></li><li><a href=#4%e4%bb%8e%e6%96%87%e4%bb%b6%e6%b5%81%e4%b8%ad%e7%9b%b4%e6%8e%a5%e8%a7%a3%e6%9e%90 aria-label=4ã€ä»æ–‡ä»¶æµä¸­ç›´æ¥è§£æ>4ã€ä»æ–‡ä»¶æµä¸­ç›´æ¥è§£æ</a></li></ul></li><li><a href=#%e5%9b%9b%e5%a4%8d%e6%9d%82-yaml-%e6%96%87%e4%bb%b6%e8%a7%a3%e6%9e%90 aria-label="å››ã€å¤æ‚ YAML æ–‡ä»¶è§£æ">å››ã€å¤æ‚ YAML æ–‡ä»¶è§£æ</a><ul><li><a href=#1%e5%9b%ba%e5%ae%9a%e5%ad%97%e6%ae%b5%e8%a7%a3%e6%9e%90 aria-label=1.å›ºå®šå­—æ®µè§£æ>1.å›ºå®šå­—æ®µè§£æ</a></li><li><a href=#2%e5%8a%a8%e6%80%81%e5%ad%97%e6%ae%b5%e8%a7%a3%e6%9e%90 aria-label=2.åŠ¨æ€å­—æ®µè§£æ>2.åŠ¨æ€å­—æ®µè§£æ</a></li><li><a href=#3%e5%ba%8f%e5%88%97%e5%8c%96%e6%97%b6%e5%89%94%e9%99%a4%e9%bb%98%e8%ae%a4%e9%85%8d%e7%bd%ae aria-label=3.åºåˆ—åŒ–æ—¶å‰”é™¤é»˜è®¤é…ç½®>3.åºåˆ—åŒ–æ—¶å‰”é™¤é»˜è®¤é…ç½®</a></li></ul></li><li><a href=#%e4%ba%94%e6%80%bb%e7%bb%93 aria-label=äº”ã€æ€»ç»“>äº”ã€æ€»ç»“</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{elements&&(activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")}))},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h3 id=ä¸€ç®€ä»‹>ä¸€ã€ç®€ä»‹<a hidden class=anchor aria-hidden=true href=#ä¸€ç®€ä»‹>#</a></h3><p>serde_yaml æ˜¯ Rust è¯­è¨€ä¸­ä¸€ä¸ªç”¨äºåºåˆ—åŒ–å’Œååºåˆ—åŒ– YAML æ•°æ®çš„åº“ã€‚å®ƒä»¥å…¶é«˜æ€§èƒ½å’Œçµæ´»æ€§è€Œå¹¿å—æ¬¢è¿ï¼Œç‰¹åˆ«é€‚ç”¨äºéœ€è¦å¤„ç† YAML é…ç½®æ–‡ä»¶çš„é¡¹ç›®ã€‚åœ¨è¿™ç¯‡åšå®¢ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨ serde_yaml çš„åŸºæœ¬ç”¨æ³•ï¼Œå¹¶æä¾›ä¸€äº›å®ç”¨çš„ç¤ºä¾‹ä»£ç ã€‚</p><h3 id=äºŒä½¿ç”¨åœºæ™¯>äºŒã€ä½¿ç”¨åœºæ™¯<a hidden class=anchor aria-hidden=true href=#äºŒä½¿ç”¨åœºæ™¯>#</a></h3><p>serde_yaml å¸¸ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š</p><ul><li>é…ç½®ç®¡ç†ï¼šè®¸å¤šåº”ç”¨ç¨‹åºä½¿ç”¨ YAML æ–‡ä»¶æ¥å­˜å‚¨é…ç½®å‚æ•°ï¼Œserde_yaml å¯ä»¥è½»æ¾è§£æè¿™äº›æ–‡ä»¶ã€‚</li><li>æ•°æ®äº¤æ¢ï¼šåœ¨ç³»ç»Ÿä¹‹é—´ä¼ é€’æ•°æ®æ—¶ï¼ŒYAML æ ¼å¼å› å…¶å¯è¯»æ€§è€Œå¸¸è¢«é€‰ç”¨ã€‚</li><li>æ–‡æ¡£ç”Ÿæˆï¼šä¸€äº›å·¥å…·ä½¿ç”¨ YAML æ¥æè¿°æ–‡æ¡£ç»“æ„ï¼Œserde_yaml å¯ä»¥å¸®åŠ©ç”Ÿæˆå’Œè§£æè¿™äº›æ–‡æ¡£ã€‚</li></ul><h3 id=ä¸‰åŸºæœ¬ä½¿ç”¨>ä¸‰ã€åŸºæœ¬ä½¿ç”¨<a hidden class=anchor aria-hidden=true href=#ä¸‰åŸºæœ¬ä½¿ç”¨>#</a></h3><p>å¼€å§‹ä½¿ç”¨ serde_yaml ä¹‹å‰ï¼Œå…ˆåˆ›å»ºä¸€ä¸ª serde_yaml_test é¡¹ç›®æ–‡ä»¶å¤¹ï¼Œåœ¨æ–‡ä»¶å¤¹ä¸­ä½¿ç”¨ <code>cargo init</code> åˆå§‹åŒ– rust é¡¹ç›®ï¼Œç„¶ååœ¨é¡¹ç›®çš„ Cargo.toml æ–‡ä»¶ä¸­æ·»åŠ ä¾èµ–ï¼š</p><pre><code class=language-toml>serde = { version = &quot;1.0&quot;, features = [&quot;derive&quot;] }
serde_yaml = &quot;0.9.34&quot;
</code></pre><p>è¦ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ serde çš„è¯å¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œæ¥æ·»åŠ ä¾èµ–ï¼Œå¦‚ï¼š</p><pre><code class=language-bash> cargo add serde --features=&quot;derive&quot;
 cargo add serde_yaml
</code></pre><p>ä¾èµ–çš„åŒ…éƒ½å‡†å¤‡å®Œæˆåï¼Œå°±æ¥çœ‹çœ‹å‡ ä¸ªç¤ºä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½•è¯»å–ã€è§£æå’Œç”Ÿæˆ YAML æ–‡ä»¶ã€‚</p><h4 id=1è¯»å–å’Œè§£æ-yaml-æ–‡ä»¶>1ã€è¯»å–å’Œè§£æ YAML æ–‡ä»¶<a hidden class=anchor aria-hidden=true href=#1è¯»å–å’Œè§£æ-yaml-æ–‡ä»¶>#</a></h4><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªåŸºæœ¬ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ serde_yaml è¯»å–å’Œè§£æä¸€ä¸ªåä¸ºÂ ä»¥ä¸‹æ˜¯ä¸€ä¸ªåŸºæœ¬ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ serde_yaml è¯»å–å’Œè§£æä¸€ä¸ªåä¸ºÂ <code>hello.yml</code>Â çš„æ–‡ä»¶ï¼šÂ çš„æ–‡ä»¶ï¼š</p><pre><code class=language-bash># åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ª hello.yml æ–‡ä»¶
touch hello.yml
# æ­¤æ—¶ç›®å½•ç»“æ„ä¸º
#|-serde_yaml_test
#   |--src
#   |--target
#   |--.gitignore
#   |--Cargo.lock
#   |--Cargo.toml
#   |--hello.yml
</code></pre><pre><code class=language-rust>use std::collections::BTreeMap;
use std::fs::File;
use std::io::Read;
use serde_yaml;

fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
    let mut file = File::open(&quot;hello.yml&quot;)?; // æ‰“å¼€æ–‡ä»¶ hello.yml
    let mut contents = String::new(); // åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²
    file.read_to_string(&amp;mut contents)?; // è¯»å–æ–‡ä»¶å†…å®¹åˆ°å­—ç¬¦ä¸²ç¼“å†²åŒº
    println!(&quot;YAML file contents:\n{}&quot;, contents); // æ‰“å°åŸå§‹çš„YAMLå­—ç¬¦ä¸²
    // å°†YAMLå­—ç¬¦ä¸²ååºåˆ—åŒ–ä¸ºBTreeMap
    let deserialized_map: BTreeMap&lt;String, serde_yaml::Value&gt; = serde_yaml::from_str(&amp;contents)?;
    println!(&quot;Deserialized map: {:#?}&quot;, deserialized_map);  // æ‰“å°ååºåˆ—åŒ–åçš„æ•°æ®ç»“æ„
    if let Some(name) = deserialized_map.get(&quot;name&quot;).and_then(|v| v.as_str()) {
        println!(&quot;name: {}&quot;, name); // æ‰“å° name
    } else {
        println!(&quot;The key 'name' was not found or is not a string.&quot;);
    }
    Ok(())
}
// è¾“å‡ºç»“æœï¼š
//    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.03s
//     Running `target\debug\serde_yaml_test.exe`
// YAML file contents:
// name: data
// Deserialized map: {
//     &quot;name&quot;: String(&quot;data&quot;),
// }
// name: data

</code></pre><h4 id=2åºåˆ—åŒ–æ•°æ®ç»“æ„ä¸º-yaml>2ã€åºåˆ—åŒ–æ•°æ®ç»“æ„ä¸º YAML<a hidden class=anchor aria-hidden=true href=#2åºåˆ—åŒ–æ•°æ®ç»“æ„ä¸º-yaml>#</a></h4><p>ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•å°†ä¸€ä¸ª Rust æ•°æ®ç»“æ„åºåˆ—åŒ–ä¸º YAML æ ¼å¼çš„å­—ç¬¦ä¸²ï¼š</p><pre><code class=language-rust>use std::collections::BTreeMap;
use serde_yaml;
fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
    // åˆ›å»ºä¸€ä¸ª BTreeMap æ•°æ®ç»“æ„
    let mut data = BTreeMap::new();
    data.insert(&quot;name&quot;.to_string(), serde_yaml::Value::String(&quot;Alice&quot;.to_string()));
    data.insert(&quot;age&quot;.to_string(), serde_yaml::Value::Number(serde_yaml::Number::from(30)));
    // å°†æ•°æ®ç»“æ„åºåˆ—åŒ–ä¸º YAML å­—ç¬¦ä¸²
    let yaml_string = serde_yaml::to_string(&amp;data)?;
    // æ‰“å°åºåˆ—åŒ–åçš„ YAML å­—ç¬¦ä¸²
    println!(&quot;Serialized YAML:\n{}&quot;, yaml_string);
    Ok(())
}
</code></pre><h4 id=3ä½¿ç”¨è‡ªå®šä¹‰ç»“æ„ä½“è¿›è¡Œååºåˆ—åŒ–>3ã€ä½¿ç”¨è‡ªå®šä¹‰ç»“æ„ä½“è¿›è¡Œååºåˆ—åŒ–<a hidden class=anchor aria-hidden=true href=#3ä½¿ç”¨è‡ªå®šä¹‰ç»“æ„ä½“è¿›è¡Œååºåˆ—åŒ–>#</a></h4><p>ä½¿ç”¨è‡ªå®šä¹‰ç»“æ„ä½“æ¥è§£æ YAML æ•°æ®ä¼šæ›´åŠ æ–¹ä¾¿å’Œç›´è§‚ã€‚ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•å®šä¹‰ä¸€ä¸ªç»“æ„ä½“å¹¶è§£æ YAML æ•°æ®ï¼š</p><pre><code class=language-rust>use serde::{Deserialize, Serialize};
use serde_yaml;

#[derive(Debug, Serialize, Deserialize)]
struct Person {
    name: String,
    age: u8,
}

fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
    // å®šä¹‰ä¸€ä¸ª YAML å­—ç¬¦ä¸²
    let yaml_str = &quot;
name: Bob
age: 25
&quot;;
    // å°† YAML å­—ç¬¦ä¸²ååºåˆ—åŒ–ä¸º Person ç»“æ„ä½“
    let person: Person = serde_yaml::from_str(yaml_str)?;
    // æ‰“å°ååºåˆ—åŒ–åçš„ç»“æ„ä½“
    println!(&quot;Deserialized person: {:?}&quot;, person);
    Ok(())
}
</code></pre><h4 id=4ä»æ–‡ä»¶æµä¸­ç›´æ¥è§£æ>4ã€ä»æ–‡ä»¶æµä¸­ç›´æ¥è§£æ<a hidden class=anchor aria-hidden=true href=#4ä»æ–‡ä»¶æµä¸­ç›´æ¥è§£æ>#</a></h4><p>æœ‰æ—¶ï¼Œä¸ºäº†ä¼˜åŒ–å†…å­˜ä½¿ç”¨ï¼Œå¯ä»¥ç›´æ¥ä»æ–‡ä»¶æµä¸­è¿›è¡Œè§£æï¼š</p><pre><code class=language-rust>use serde::{Deserialize, Serialize};
use std::fs::File;

#[derive(Debug, Serialize, Deserialize)]
struct Config {
    database_url: String,
    port: u16,
}

fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
    // æ‰“å¼€é…ç½®æ–‡ä»¶
    let file = File::open(&quot;config.yml&quot;)?;
    // ä»æ–‡ä»¶æµä¸­ç›´æ¥ååºåˆ—åŒ–
    let config: Config = serde_yaml::from_reader(file)?;
    // æ‰“å°ååºåˆ—åŒ–åçš„é…ç½®
    println!(&quot;Config: {:?}&quot;, config);
    Ok(())
}
</code></pre><h3 id=å››å¤æ‚-yaml-æ–‡ä»¶è§£æ>å››ã€å¤æ‚ YAML æ–‡ä»¶è§£æ<a hidden class=anchor aria-hidden=true href=#å››å¤æ‚-yaml-æ–‡ä»¶è§£æ>#</a></h3><p>åŸºäºä»¥ä¸Šæ¡ˆä¾‹ï¼Œæ¥å°è¯•è§£æä¸€ä¸ªå¤æ‚çš„ yaml æ–‡ä»¶ï¼Œæ—¢ç„¶è¦å¤æ‚ï¼Œé‚£å°±å°è¯•è§£æä¸€ä¸‹ <code>docker-compose.yml</code>æ–‡ä»¶å§ï¼å…ˆæ¥å‡†å¤‡ä¸€ä¸ª yaml æ–‡ä»¶ï¼Œæ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œå¦‚ä¸‹ï¼š</p><pre><code class=language-yaml>version: &quot;3.9&quot;
services:
  redis:
    image: redis:latest
    restart: always
    privileged: true
    ports:
      - 6379:6379
    volumes:
      - ./data/redis/data:/data
      - ./redis/etc:/usr/local/etc/redis
    command: redis-server /usr/local/etc/redis/redis.conf
  nginx:
    image: nginx:latest
    restart: always
    privileged: true
    volumes:
      - ./nginx/etc/nginx:/etc/nginx
      - ./var/www:/var/www/html
    ports:
      - &quot;80:80&quot;
      - &quot;443:443&quot;
    depends_on:
      - redis
networks:
  mynet1:
    driver: overlay
    attachable: false
</code></pre><p>å†å†™ä»£ç ä¹‹å‰ï¼Œå…ˆæŠŠ rust å¼•å…¥çš„åŒ…å…ˆè´´å‡ºæ¥ï¼Œåé¢è´´ä»£ç æ—¶å¯ä»¥å°‘å†™ä¸€ç‚¹å•°å—¦ä»£ç ï¼Œåªå…³æ³¨æ ¸å¿ƒé€»è¾‘ï¼Œçœ‹èµ·æ¥æ›´æ¸…æ™°æ˜“æ‡‚ï¼Œè¿™æ˜¯æ•´ä¸ªé¡¹ç›®æ‰€ä¾èµ–çš„åŒ…ï¼Œä¹Ÿæ²¡æœ‰å¾ˆå¤š</p><pre><code class=language-rust>use std::collections::HashMap;
use std::fmt::{Debug, Display};
use std::fs::File;
use std::io::Read;
use serde::{Deserialize, Serialize};
</code></pre><h4 id=1å›ºå®šå­—æ®µè§£æ>1.å›ºå®šå­—æ®µè§£æ<a hidden class=anchor aria-hidden=true href=#1å›ºå®šå­—æ®µè§£æ>#</a></h4><p>æ•´ä¸ª yml æ–‡ä»¶çœ‹ä¸‹æ¥ï¼Œå¹¶æ²¡æœ‰å¾ˆå¤šï¼Œä½†ç®—æ˜¯ä¸€ä¸ªæ¯”è¾ƒå…¨é¢çš„ docker-compose é…ç½®æ–‡ä»¶äº†ï¼Œè™½ç„¶æ²¡æœ‰ç”¨åˆ°æ‰€æœ‰çš„é…ç½®å­—æ®µï¼Œè§¦ç±»æ—é€šï¼Œå†å¤šçš„é…ç½®å­—æ®µéƒ½èƒ½è½»è½¦ç†Ÿè·¯çš„è§£æå§ï¼Œå…ˆä¸€çº§ä¸€çº§çš„çœ‹ï¼Œä¸€çº§æœ‰ <code>version</code> <code>services</code> <code>networks</code>ï¼Œé€šè¿‡ä»¥ä¸Šï¼Œå°±å¯ä»¥å®šä¹‰å‡ºéœ€è¦çš„ç»“æ„ä½“äº†ï¼š</p><pre><code class=language-rust>#[derive(Debug, Serialize, Deserialize)]
struct DockerYaml {
    version: String,
    services: HashMap&lt;String, ServiceCfg&gt;,
}
</code></pre><p>è¿™é‡Œçš„ services çš„ç±»å‹ç”¨çš„æ˜¯ HashMapï¼Œå› ä¸º services åç§°æ˜¯ä¸€ä¸ªå˜é‡ï¼Œè€Œä¸”æ•°é‡ä¸å›ºå®šï¼Œæ¯”å¦‚è¿˜å¯ä»¥å¢åŠ  mysql æœåŠ¡ï¼Œæ‰€ä»¥ services æ˜¯ä¸€ä¸ªåŠ¨æ€ï¼Œservices é‡Œé¢åˆå¼•å…¥äº† ServiceCfg ç±»å‹ï¼Œç°åœ¨ç»§ç»­çœ‹ services ä¸‹ä¸€çº§çš„é…ç½®å­—æ®µï¼Œå…¶ä¸­ image æ˜¯å¿…é¡»è¦å­˜åœ¨çš„é…ç½®ï¼Œé‚£ ServiceCfg ç»“æ„ä½“å¯ä»¥å®šä¹‰æˆï¼š</p><pre><code class=language-rust>#[derive(Debug, Clone, Serialize, Deserialize)]
struct ServiceCfg {
    image: String,
}
</code></pre><p>å¥½äº†ï¼Œå°±è¿™ä¹ˆç®€å•ï¼Œå…ˆå†™ä¸ª main å‡½æ•°æŠŠä»£ç è·‘èµ·æ¥çœ‹çœ‹å§ï¼</p><pre><code class=language-rust>fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
    let mut file = File::open(&quot;docker-compose.yml&quot;)?; // æ‰“å¼€æ–‡ä»¶
    let mut contents = String::new(); // åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²
    file.read_to_string(&amp;mut contents)?; // è¯»å–æ–‡ä»¶å†…å®¹åˆ°å­—ç¬¦ä¸²ç¼“å†²åŒº
    // println!(&quot;è¯»å–åˆ°çš„ YAML å†…å®¹:\n{}&quot;, contents); // æ‰“å°åŸå§‹çš„YAMLå­—ç¬¦ä¸²
    // å°† YAML å­—ç¬¦ä¸²ååºåˆ—åŒ–ä¸º DockerYaml ç»“æ„ä½“
    let docker_yaml: DockerYaml = serde_yaml::from_str(&amp;contents)?;
    // æ‰“å°ååºåˆ—åŒ–åçš„ç»“æ„ä½“
    println!(&quot;ååºåˆ—åŒ–åçš„ç»“æ„ä½“: {:?}&quot;, docker_yaml);
    // è¯»å–å‡º services
    let services = &amp;docker_yaml.services;
    for (serve, config) in services {
        println!(&quot;services name: {}&quot;, serve);
        println!(&quot;services config: {:?}&quot;, config);
    }
    Ok(())
}
// æ‰“å°çš„å†…å®¹ï¼š
// ååºåˆ—åŒ–åçš„ç»“æ„ä½“: DockerYaml { version: &quot;3.9&quot;, services: {&quot;nginx&quot;: ServiceCfg { image: &quot;nginx:latest&quot; }, &quot;redis&quot;: ServiceCfg { image: &quot;redis:latest&quot; }} }
// services name: nginx
// services config: ServiceCfg { image: &quot;nginx:latest&quot; }
// services name: redis
// services config: ServiceCfg { image: &quot;redis:latest&quot; }
</code></pre><p>æ­£å¸¸æ‰“å°äº†ï¼Œç°åœ¨å¯ä»¥å®Œå–„ ServiceCfg è¿™ä¸ªç»“æ„ä½“äº†</p><h4 id=2åŠ¨æ€å­—æ®µè§£æ>2.åŠ¨æ€å­—æ®µè§£æ<a hidden class=anchor aria-hidden=true href=#2åŠ¨æ€å­—æ®µè§£æ>#</a></h4><p>docker-compose é…ç½®çš„ services ä¸­ï¼Œå¤§éƒ¨åˆ†é…ç½®éƒ½å¯é€‰çš„ï¼Œå¦‚æœä¸é…ç½®ï¼Œå°±ä¼šæœ‰ä¸ªé»˜è®¤å€¼ï¼Œå…ˆä¸å…³å¿ƒè¿™ä¸ªé»˜è®¤å€¼æ˜¯ä»€ä¹ˆï¼Œä½†èµ·ç è¦å®ç°ä¸€ä¸ªä¸é…ç½®ä¼šæœ‰é»˜è®¤å€¼çš„åŠŸèƒ½ï¼Œå¸¦ç€ç–‘é—®ï¼Œå…ˆå»å†™ä¸€ä¸‹ä»£ç ï¼Œ</p><p>æŠŠ ServiceCfg ç»“æ„ä½“ä¿®æ”¹æˆä»¥ä¸‹çš„æ ·å­ï¼š</p><pre><code class=language-rust>#[derive(Debug, Clone, Serialize, Deserialize)]
struct ServiceCfg {
    image: String,
    restart: String,
}
</code></pre><p>åªæ˜¯æ·»åŠ äº†ä¸€ä¸ª restart é…ç½®é¡¹ï¼Œmain å‡½æ•°ä¸å˜ï¼Œcargo run ä¸€ä¸‹å‘ç°æ­£å¸¸æ‰“å°äº†å¦‚ä¸‹ï¼š</p><pre><code class=language-bash>ååºåˆ—åŒ–åçš„ç»“æ„ä½“: DockerYaml { version: &quot;3.9&quot;, services: {&quot;nginx&quot;: ServiceCfg { image: &quot;nginx:latest&quot;, restart: &quot;always&quot; }, &quot;redis&quot;: ServiceCfg { image: &quot;redis:latest&quot;, restart: &quot;always&quot; }} }
services name: nginx
services config: ServiceCfg { image: &quot;nginx:latest&quot;, restart: &quot;always&quot; }
services name: redis
services config: ServiceCfg { image: &quot;redis:latest&quot;, restart: &quot;always&quot; }
</code></pre><p>restart é…ç½®é¡¹æ­£å¸¸è¯»å–åˆ°äº†ï¼Œå¥½åƒä¸€åˆ‡éƒ½å¾ˆå®Œç¾ï¼Œä½† restart é…ç½®æ˜¯ä¸ªå¯é€‰é…ç½®ï¼Œé‚£åœ¨ <code>docker-compose.yml</code>Â Â æ–‡ä»¶ä¸­éšä¾¿æŒ‘ä¸€ä¸ª restart é…ç½®æ³¨é‡Šæ‰çœ‹çœ‹</p><pre><code class=language-yml>version: &quot;3.9&quot;
services:
  redis:
    image: redis:latest
    # restart: always
    privileged: false
</code></pre><p>å†æ¬¡è¿è¡Œ cargo run å°±ä¼šå‘ç°æŠ¥é”™äº†ï¼ŒæŠ¥é”™å¾ˆæ˜æ˜¾ï¼Œç¼ºå°‘ restart è¿™ä¸ªé…ç½®</p><pre><code class=language-bash>Error: Error(&quot;services.redis: missing field `restart`&quot;, line: 4, column: 5)
error: process didn't exit successfully: `target\debug\serde_yaml_test.exe` (exit code: 1)
</code></pre><p>è¦è§£å†³è¿™ä¸ªé—®é¢˜å¾ˆç®€å•ï¼Œserde æä¾›äº†ä¸€ä¸ªå­—æ®µå±æ€§å¯ä»¥å¿«é€Ÿè®¾ç½®è¿™ä¸ªå­—æ®µçš„é»˜è®¤å€¼ï¼Œ</p><p><code>#[serde(default)]</code> å¦‚æœååºåˆ—åŒ–æ—¶è¯¥å€¼ä¸å­˜åœ¨ï¼Œä½¿ç”¨<code>Default::default()</code>ç”Ÿæˆé»˜è®¤å€¼</p><p>åœ¨ ServiceCfg.restart ä¸­åŠ ä¸Šå°±å¯ä»¥ï¼Œæ‰€ä»¥æŠŠ ServiceCfg ç»“æ„ä½“ä¿®æ”¹æˆä»¥ä¸‹çš„æ ·å­ï¼š</p><pre><code class=language-rust>#[derive(Debug, Clone, Serialize, Deserialize)]
struct ServiceCfg {
    image: String,
    #[serde(default)]
    restart: String,
}
// å†æ¬¡æ‰§è¡Œ cargo run åä¼šå¾—åˆ°ä»¥ä¸‹è¾“å‡º
// ååºåˆ—åŒ–åçš„ç»“æ„ä½“: DockerYaml { version: &quot;3.9&quot;, services: {&quot;nginx&quot;: ServiceCfg { image: &quot;nginx:latest&quot;, restart: &quot;always&quot; }, &quot;redis&quot;: ServiceCfg { image: &quot;redis:latest&quot;, restart: &quot;&quot; }} }
// services name: nginx
// services config: ServiceCfg { image: &quot;nginx:latest&quot;, restart: &quot;always&quot; }
// services name: redis
// services config: ServiceCfg { image: &quot;redis:latest&quot;, restart: &quot;&quot; }
</code></pre><p>è‡ªæ­¤ï¼Œå¯é€‰é…ç½®çš„é»˜è®¤å€¼é—®é¢˜å°±è§£å†³äº†ï¼Œä½†åˆæœ‰ä¸ªé—®é¢˜ï¼Œports å’Œ volumes è¯¥ä½¿ç”¨ä»€ä¹ˆæ•°æ®ç±»å‹æ¥æ‰¿è½½å‘¢ï¼Œå…¶å® yml æ–‡ä»¶ä¸­ï¼Œæ‰€æœ‰ä»¥ - å¼€å¤´çš„ï¼Œéƒ½è¡¨ç¤ºåŒä¸€çº§ä¸‹æœ‰å¤šä¸ªå€¼ï¼Œå°±é‚£ redis çš„ volumes æ¥è¯´ï¼Œä»–è¡¨ç¤ºè¦æ˜ å°„æœ¬åœ°å¤šä¸ªæ•°æ®å·åˆ°å®¹å™¨ä¸­ï¼Œå…·ä½“å¤šå°‘ä¸ªï¼Ÿä¸çŸ¥é“ï¼Œé‚£è¿™ç§ç»“æ„æ˜¯ä¸æ˜¯æœ‰ç‚¹åƒå¯å˜é•¿åº¦çš„æ•°ç»„ï¼Œåœ¨ rust ä¸­æœ€é€‚åˆè¿™ç§ç»“æ„çš„ç±»å‹æ˜¯ä¸æ˜¯å°±æ˜¯ Vec äº†ï¼ŒåŸºäºæ­¤æœ€ç»ˆå®Œå–„ ServiceCfg ç»“æ„ä½“çš„å†…å®¹å¦‚ä¸‹ï¼š</p><pre><code class=language-rust>#[derive(Debug, Clone, Serialize, Deserialize)]
struct ServiceCfg {
    image: String,
    #[serde(default)]
    restart: String,
    #[serde(default)]
    privileged: bool,
    #[serde(default)]
    ports: Vec&lt;String&gt;,
    #[serde(default)]
    volumes: Vec&lt;String&gt;,
    #[serde(default)]
    command: String,
    #[serde(default)]
    depends_on: Vec&lt;String&gt;,
}
</code></pre><p>ç°åœ¨å¯ä»¥éšæ„æ³¨é‡Šæ‰ services ä¸­çš„é™¤ image é…ç½®å¤–çš„æ‰€æœ‰é…ç½®äº†ï¼Œè€Œä¸”è§£æä¹Ÿä¸ä¼šæŠ¥é”™ï¼Œä¹Ÿæœ‰é»˜è®¤å€¼äº†ï¼ŒæŠŠ networks é…ç½®ä¹Ÿä¸€å¹¶å®ç°äº†å§</p><pre><code class=language-rust>#[derive(Debug, Serialize, Deserialize)]
struct DockerYaml {
    version: String,
    services: HashMap&lt;String, ServiceCfg&gt;,
    #[serde(default)]
    networks: HashMap&lt;String, NetworkCfg&gt;,
}

#[derive(Debug, Clone, Serialize, Deserialize)]
struct ServiceCfg {
    image: String,
    #[serde(default)]
    restart: String,
    #[serde(default)]
    privileged: bool,
    #[serde(default)]
    ports: Vec&lt;String&gt;,
    #[serde(default)]
    volumes: Vec&lt;String&gt;,
    #[serde(default)]
    command: String,
    #[serde(default)]
    depends_on: Vec&lt;String&gt;,
}

#[derive(Debug, Clone, Serialize, Deserialize)]
struct NetworkCfg {
    #[serde(default)]
    driver: Option&lt;String&gt;,
    #[serde(default)]
    attachable: Option&lt;bool&gt;,
}

fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
    let mut file = File::open(&quot;docker-compose.yml&quot;)?; // æ‰“å¼€æ–‡ä»¶
    let mut contents = String::new(); // åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²
    file.read_to_string(&amp;mut contents)?; // è¯»å–æ–‡ä»¶å†…å®¹åˆ°å­—ç¬¦ä¸²ç¼“å†²åŒº
    // println!(&quot;è¯»å–åˆ°çš„ YAML å†…å®¹:\n{}&quot;, contents); // æ‰“å°åŸå§‹çš„YAMLå­—ç¬¦ä¸²
    // å°† YAML å­—ç¬¦ä¸²ååºåˆ—åŒ–ä¸º DockerYaml ç»“æ„ä½“
    let docker_yaml: DockerYaml = serde_yaml::from_str(&amp;contents)?;
    // æ‰“å°ååºåˆ—åŒ–åçš„ç»“æ„ä½“
    println!(&quot;ååºåˆ—åŒ–åçš„ç»“æ„ä½“: {:?}&quot;, docker_yaml);
    // è¯»å–å‡º services
    let services = &amp;docker_yaml.services;
    for (serve, config) in services {
        println!(&quot;services name: {}&quot;, serve);
        println!(&quot;services config: {:?}&quot;, config);
    }
    // è¯»å–å‡º networks
    let networks = &amp;docker_yaml.networks;
    for (serve, config) in networks {
        println!(&quot;networks name: {}&quot;, serve);
        println!(&quot;networks config: {:?}&quot;, config);
    }
    // å°†æ•°æ®ç»“æ„åºåˆ—åŒ–ä¸º YAML å­—ç¬¦ä¸²
    let yaml_string = serde_yaml::to_string(&amp;docker_yaml)?;
    println!(&quot;åºåˆ—åŒ–ä¸º YAML å­—ç¬¦ä¸²:\n{}&quot;, yaml_string); // æ‰“å°åºåˆ—åŒ–åçš„ YAML å­—ç¬¦ä¸²
    Ok(())
}
</code></pre><p>å› ä¸º networks é…ç½®ä¹Ÿæ˜¯ä¸€ä¸ªå¯é€‰é…ç½®ï¼Œæ‰€ä»¥åœ¨ DockerYaml ç»“æ„ä½“ä¸­è¦åŠ ä¸Š <code>#[serde(default)]</code>å­—æ®µå±æ€§ï¼Œè‡³æ­¤ï¼Œè¯»å– yml æ–‡ä»¶ç®—æ˜¯å®Œæˆäº†ï¼Œä½†çœ‹ä¸Šé¢çš„ main å‡½æ•°ï¼ŒæŠŠååºåˆ—åŒ–çš„ç»“æ„ä½“å†è½¬æ¢ä¸º yml æ–‡ä»¶ï¼Œå°±ä¼šæœ‰ç‚¹ç‚¹å°é—®é¢˜ï¼Œå®é™…ä¸Šä¸Šé¢ä»£ç æ‰§è¡Œå®Œåä¼šç”Ÿæˆä¸€ä¸ªè·Ÿè¯»å–çš„ yml æ–‡ä»¶ä¸ä¸€æ ·å†…å®¹çš„ yml å­—ç¬¦ä¸²å‡ºæ¥ï¼Œå¦‚æœæœŸæœ›è¯»å–çš„ä»€ä¹ˆ yml ç”Ÿæˆçš„ yml ä¹Ÿä¸€æ¨¡ä¸€æ ·æ€ä¹ˆåŠï¼Ÿ</p><h4 id=3åºåˆ—åŒ–æ—¶å‰”é™¤é»˜è®¤é…ç½®>3.åºåˆ—åŒ–æ—¶å‰”é™¤é»˜è®¤é…ç½®<a hidden class=anchor aria-hidden=true href=#3åºåˆ—åŒ–æ—¶å‰”é™¤é»˜è®¤é…ç½®>#</a></h4><p>éœ€è¦å¯é€‰å­—æ®µåœ¨æœªè®¾ç½®æ—¶åœ¨ååºåˆ—æ—¶æœ‰ç”Ÿæˆé»˜è®¤å€¼ï¼Œä½†åœ¨åºåˆ—åŒ–æ—¶æŠŠé»˜è®¤å€¼å»é™¤ï¼Œå¯ä»¥ä½¿ç”¨ serde çš„ <code>#[serde(skip_serializing_if = "path")]</code> è°ƒç”¨ä¸€ä¸ªå‡½æ•°æ¥ç¡®å®šæ˜¯å¦è·³è¿‡åºåˆ—åŒ–è¯¥å­—æ®µã€‚ç»™å®šçš„å‡½æ•°å¿…é¡»å¯ä»¥ä½œä¸º<code>fn(&amp;T)->bool</code>è°ƒç”¨ï¼Œå°½ç®¡å®ƒå¯èƒ½æ˜¯<code>T</code>ä¸Šçš„æ³›å‹ã€‚ä¾‹å¦‚<code>skip_serializing_if="Option::is_none"</code>å¦‚æœå€¼æ˜¯ Noneï¼Œé‚£ä¹ˆå°±ä¼šè·³è¿‡ã€‚</p><p>ç°åœ¨æ¥æ”¹é€ ä¸€ä¸‹ä¸Šé¢çš„ ServiceCfg ï¼š</p><pre><code class=language-rust>#[derive(Debug, Clone, Serialize, Deserialize)]
struct ServiceCfg {
    image: String,
    #[serde(skip_serializing_if = &quot;String::is_empty&quot;, default)]
    restart: String,
    #[serde(skip_serializing_if = &quot;Option::is_none&quot;, default)]
    privileged: Option&lt;bool&gt;,
    #[serde(skip_serializing_if = &quot;Vec::is_empty&quot;, default)]
    ports: Vec&lt;String&gt;,
    #[serde(skip_serializing_if = &quot;Vec::is_empty&quot;, default)]
    volumes: Vec&lt;String&gt;,
    #[serde(skip_serializing_if = &quot;String::is_empty&quot;, default)]
    command: String,
    #[serde(skip_serializing_if = &quot;Vec::is_empty&quot;, default)]
    depends_on: Vec&lt;String&gt;,
}
</code></pre><p>è¿™é‡Œæœ‰ä¸ªç»†èŠ‚æ˜¯ privileged å±æ€§ç”±åŸæ¥çš„ <code>bool</code> ç±»å‹æ¢æˆäº† <code>Option&lt;bool></code>ï¼Œ å…¶ä¸­ç¼˜ç”±å°±æ˜¯ bool ç±»å‹ä¸å¥½åšç±»å‹é»˜è®¤å€¼åˆ¤æ–­ï¼Œ åƒå…¶ä»–çš„ Stringï¼ŒVecï¼ŒOption éƒ½æœ‰å¯¹åº”çš„å‡½æ•°ç»™ <code>skip_serializing_if</code> åšé»˜è®¤å€¼åˆ¤æ–­ï¼Œæ¢æˆ Option åï¼Œè§£ææ—¶å¦‚æœé‡åˆ°æœªé…ç½®æ—¶å°±ä¼šä½¿ç”¨ None ä»£æ›¿åŸæ¥çš„ bool é»˜è®¤å€¼ï¼Œå› ä¸º Option ç±»å‹çš„é»˜è®¤å€¼å°±æ˜¯ None ï¼Œåé¢ä½¿ç”¨èµ·æ¥ä¹Ÿæ˜¯å¾ˆæ–¹ä¾¿çš„ï¼Œå®é™…ä¸Šæ‰€æœ‰çš„å¯é€‰å­—æ®µé…ç½®éƒ½å¯ä»¥ä½¿ç”¨ Option ç±»å‹åŒ…èµ·æ¥ï¼Œæ¯”å¦‚: <code>depends_on : Option&lt;Vec&lt;String>></code>ï¼Œåªä¸è¿‡è¿™æ ·å†™åé»˜è®¤å€¼å°±ä¸æ˜¯ç©ºçš„ Vec äº†ï¼Œè€Œæ˜¯ Noneï¼Œè€Œå€¼å­˜åœ¨æ—¶å°±æ˜¯ Some(Vec[]) äº†ã€‚</p><p>ç°åœ¨è¿˜å‰©ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ networks å¦‚æœæ²¡æœ‰é…ç½®ï¼Œä½†ç”Ÿæˆçš„ yml ä¹Ÿä¼šé»˜è®¤å¸¦ä¸Š networks: {}ï¼Œè¿™ä¸ªå¯ä»¥ä½¿ç”¨ HashMap::is_empty æ¥åˆ¤æ–­ï¼Œ</p><pre><code class=language-rust>#[derive(Debug, Serialize, Deserialize)]
struct DockerYaml {
    version: String,
    services: HashMap&lt;String, ServiceCfg&gt;,
    #[serde(skip_serializing_if = &quot;HashMap::is_empty&quot;, default)]
    networks: HashMap&lt;String, NetworkCfg&gt;,
}
</code></pre><p>é‚£å¦‚æœæ˜¯è‡ªå·±å®šä¹‰çš„ç±»å‹å‘¢ï¼Œéš¾é“è¦ç»™è‡ªå®šä¹‰ç±»å‹å¢åŠ ä¸€ä¸ªåˆ¤æ–­æ˜¯å¦ä¸ºç©ºçš„æ–¹æ³•å—ï¼Ÿå¯ä»¥ï¼Œä½†æ²¡å¿…è¦ï¼Œé™¤éå…¶ä»–é€»è¾‘æœ‰ç”¨åˆ°ï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ªå‡½æ•°æ¥åˆ¤æ–­ç±»å‹æ˜¯å¦ä¸ºç©ºï¼Œæ¯”å¦‚ï¼š</p><pre><code class=language-rust>#[derive(Debug, Serialize, Deserialize)]
struct DockerYaml {
    version: String,
    services: HashMap&lt;String, ServiceCfg&gt;,
    #[serde(skip_serializing_if = &quot;is_default&quot;, default)]
    networks: HashMap&lt;String, NetworkCfg&gt;,
}
// è°ƒç”¨è¿™ä¸ªå‡½æ•°æ¥ç¡®å®šæ˜¯å¦è·³è¿‡åºåˆ—åŒ–è¯¥å­—æ®µ
fn is_default&lt;T: Default + PartialEq&gt;(v: &amp;T) -&gt; bool {
    v == &amp;T::default()
}
// å› ä¸ºæ³›å‹ T åœ¨å‡½æ•°ä¸­ç”¨åˆ°æ¯”è¾ƒè¿ç®—ï¼Œæ‰€ä»¥è¦ç»™æ³›å‹æ·»åŠ  PartialEq çº¦æŸï¼Œ
// ç”¨äºåˆ¤æ–­æ˜¯å¦æ˜¯é»˜è®¤å€¼ï¼Œæ‰€ä»¥ T è¦æœ‰ default æ–¹æ³•ï¼Œæ•…ä¹Ÿè¦åŠ ä¸Š Default çº¦æŸ
// å…¶ä¸­ T è¡¨ç¤º HashMapï¼Œå¦‚æœ HashMap çš„æ³›å‹çº¦æŸæœ‰ PartialEqï¼Œ é‚£å°±è¡¨ç¤º HashMap é‡Œé¢
// çš„ç±»å‹ä¹ŸåŒæ ·å…·æœ‰ç›¸åº”çš„çº¦æŸï¼Œæ‰€ä»¥ NetworkCfg ä¹Ÿè¦å®ç° PartialEq trait,
// è€Œ Default trait æ˜¯é»˜è®¤å®ç°çš„ï¼Œå› ä¸º NetworkCfg  é‡Œæ‰€æœ‰çš„æˆå‘˜éƒ½å®ç°äº† Default trait
#[derive(Debug, Clone, Serialize, Deserialize, PartialEq)] // è¿™è¡Œå¯ä»¥çœç•¥ Default
struct NetworkCfg {
    #[serde(default)]
    driver: Option&lt;String&gt;,
    #[serde(default)]
    attachable: Option&lt;bool&gt;,
}
</code></pre><h3 id=äº”æ€»ç»“>äº”ã€æ€»ç»“<a hidden class=anchor aria-hidden=true href=#äº”æ€»ç»“>#</a></h3><p>è‡³æ­¤ï¼Œè§£æ yml æ–‡ä»¶ç®—æ˜¯å¤§åŠŸå‘Šæˆäº†ï¼Œå½“ç„¶è¿™é‡Œåªæ˜¯ä»‹ç»ä¸€å°éƒ¨åˆ† serde å­—æ®µå±æ€§ï¼Œä½†ä¹Ÿå¯ä»¥åº”ä»˜å¤§éƒ¨åˆ†åœºæ™¯äº†ï¼Œå…¶ä»–çš„æ¯”å¦‚å­—æ®µåˆ«åï¼Œåºåˆ—åŒ–æ—¶å¤„ç†é€»è¾‘ï¼Œååºåˆ—åŒ–æ—¶å¤„ç†é€»è¾‘ï¼Œå°±ç•™åœ¨ä»¥åå»æ¢ç´¢å§ã€‚</p></div><div class=post-reward><div style=padding:0;margin:0;width:100%;font-size:16px;text-align:center><div id=QR style=opacity:0><div id=wechat style=display:inline-block><a class=fancybox rel=group><img id=wechat_qr src=https://lorenwe.eu.org/img/wechat_pay.png alt=wechat_pay></a><p>å¾®ä¿¡</p></div><div id=alipay style=display:inline-block><a class=fancybox rel=group><img id=alipay_qr src=https://lorenwe.eu.org/img/alipay.png alt=alipay></a><p>æ”¯ä»˜å®</p></div></div><button id=rewardButton onclick='var qr=document.getElementById("QR");qr.style.opacity==="0"?qr.style.opacity="1":qr.style.opacity="0"'>
<span>ğŸ§§ é¼“åŠ±</span></button></div></div><footer class=post-footer><nav class=paginav><a class=next href=https://lorenwe.eu.org/posts/tech/rust%E4%B8%AD%E7%9A%84sized/><span class=title>ä¸‹ä¸€é¡µ Â»</span><br><span>Rust ä¸­çš„ Sized</span></a></nav></footer></div><div id=giscus-comment></div><script>function sendMessage(e){const t=document.querySelector("iframe.giscus-frame");if(!t||!t.contentWindow)return;t.contentWindow.postMessage({giscus:e},"https://giscus.app")}function createGusicScript(){const t=document.querySelector("#giscus-comment"),n=localStorage.getItem("pref-theme");let e=document.createElement("script");e.src="https://giscus.app/client.js",e.setAttribute("data-repo","lorenwe/lorenwe.github.io"),e.setAttribute("data-repo-id","MDEwOlJlcG9zaXRvcnk3NDY0NzM4MQ=="),e.setAttribute("data-category","Announcements"),e.setAttribute("data-category-id","DIC_kwDOBHMHVc4CizTN"),e.setAttribute("data-mapping","title"),e.setAttribute("data-strict","0"),e.setAttribute("data-reactions-enabled","1"),e.setAttribute("data-emit-metadata","0"),e.setAttribute("data-input-position","bottom"),e.setAttribute("data-theme",n),e.setAttribute("data-lang","zh-CN"),e.setAttribute("data-loading","lazy"),e.setAttribute("crossorigin","anonymous"),e.async=!0,t&&t.appendChild(e)}createGusicScript()</script></article></main><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><span class=topInner><svg class="topSvg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
<span id=read_progress></span>
</span></a><script>document.addEventListener("scroll",function(){const t=document.getElementById("read_progress"),n=document.documentElement.scrollHeight,s=document.documentElement.clientHeight,o=document.documentElement.scrollTop||document.body.scrollTop;t.innerText=((o/(n-s)).toFixed(2)*100).toFixed(0)})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>let mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>200||document.documentElement.scrollTop>200?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{(function(){document.cookie="change-themes="+escape("false")})(),document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light"),sendMessage({setConfig:{theme:"light"}})):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"),sendMessage({setConfig:{theme:"dark"}}))})</script><script>document.body.addEventListener("copy",function(e){if(window.getSelection().toString()&&window.getSelection().toString().length>50){let t=e.clipboardData||window.clipboardData;if(t){e.preventDefault();let n=window.getSelection().toString()+`\r

â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r
ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€ŒLorenwe Blogã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚\r
åŸæ–‡é“¾æ¥ï¼š`+location.href,s=window.getSelection().toString()+`\r

â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r
ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€ŒLorenwe Blogã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚\r
åŸæ–‡é“¾æ¥ï¼š`+location.href;t.setData("text/html",n),t.setData("text/plain",s)}}})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="å¤åˆ¶";function i(){t.innerText="å·²å¤åˆ¶ï¼",setTimeout(()=>{t.innerText="å¤åˆ¶"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){let t=e.textContent+`\r
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r
ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€ŒLorenwe Blogã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚\r
åŸæ–‡é“¾æ¥ï¼š`+location.href;navigator.clipboard.writeText(t),i();return}const n=document.createRange();n.selectNodeContents(e);const s=window.getSelection();s.removeAllRanges(),s.addRange(n);try{document.execCommand("copy"),i()}catch{}s.removeRange(n)});let l=e.className.replaceAll("language-",""),n=document.createElement("div"),a=document.createElement("div"),r=document.createElement("div"),c=document.createElement("div"),o=document.createElement("div");o.innerText=l,n.setAttribute("class","mac-tool"),a.setAttribute("class","mac bb1"),r.setAttribute("class","mac bb2"),c.setAttribute("class","mac bb3"),o.setAttribute("class","language-type"),n.appendChild(a),n.appendChild(r),n.appendChild(c),n.appendChild(o),s.classList.contains("highlight")?(s.appendChild(t),s.appendChild(n)):s.parentNode.firstChild==s||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?(e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t),s.appendChild(n)):(e.parentNode.appendChild(t),s.appendChild(n)))})</script></body></html>