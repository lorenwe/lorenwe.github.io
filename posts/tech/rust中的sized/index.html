<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Rust ä¸­çš„ Sized | Lorenwe Blog</title><meta name=keywords content><meta name=description content="åŸæ–‡ï¼š Sizedness in Rust
æ¦‚è¿°
Sized å…¶å®æ˜¯ Rust ä¸­æœ€é‡è¦çš„æ¦‚å¿µä¹‹ä¸€ï¼Œå¯è°“åŠŸæˆä¸å±…ã€‚å®ƒå¾€å¾€ä»¥å¾®å¦™çš„å½¢å¼ä¸å…¶ä»–è¯­è¨€ç‰¹æ€§äº¤ç»‡åœ¨ä¸€èµ·ï¼Œåªæœ‰åœ¨å½¢å¦‚ &ldquo;x doesn&rsquo;t have size known at compile time&rdquo; çš„é”™è¯¯ä¿¡æ¯ä¸­æ‰ä¼šæ˜¾éœ²ï¼Œè¿™äº›é”™è¯¯ä¿¡æ¯å¯¹äºæ¯ä¸ª Rustacean æ¥è¯´éƒ½å¤ªè¿‡ç†Ÿæ‚‰äº†ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨ Sized çš„å„ç§å½¢å¼ï¼ŒåŒ…æ‹¬å›ºå®šå¤§å°ç±»å‹ã€æœªå®šå¤§å°ç±»å‹ä»¥åŠé›¶å¤§å°ç±»å‹ï¼ŒåŒæ—¶è¿˜å°†è€ƒå¯Ÿå®ƒä»¬çš„ç”¨ä¾‹ã€ä¼˜åŠ¿ã€ç—›ç‚¹åŠç›¸åº”è§£å†³æ–¹æ¡ˆã€‚"><meta name=author content="Lorenwe"><link rel=canonical href=https://lorenwe.eu.org/posts/tech/rust%E4%B8%AD%E7%9A%84sized/><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.js onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://lorenwe.eu.org/img/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://lorenwe.eu.org/img/favicon.ico><link rel=icon type=image/png sizes=32x32 href=https://lorenwe.eu.org/img/favicon.ico><link rel=apple-touch-icon href=https://lorenwe.eu.org/img/favicon.ico><link rel=mask-icon href=https://lorenwe.eu.org/img/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://lorenwe.eu.org/posts/tech/rust%E4%B8%AD%E7%9A%84sized/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script defer src=https://unpkg.com/mermaid@8.8.1/dist/mermaid.min.js></script><link rel=stylesheet href=https://lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/4.7.0/css/font-awesome.min.css><script src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><script src=https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/jquery/3.6.0/jquery.min.js></script><meta property="og:title" content="Rust ä¸­çš„ Sized"><meta property="og:description" content="åŸæ–‡ï¼š Sizedness in Rust
æ¦‚è¿°
Sized å…¶å®æ˜¯ Rust ä¸­æœ€é‡è¦çš„æ¦‚å¿µä¹‹ä¸€ï¼Œå¯è°“åŠŸæˆä¸å±…ã€‚å®ƒå¾€å¾€ä»¥å¾®å¦™çš„å½¢å¼ä¸å…¶ä»–è¯­è¨€ç‰¹æ€§äº¤ç»‡åœ¨ä¸€èµ·ï¼Œåªæœ‰åœ¨å½¢å¦‚ &ldquo;x doesn&rsquo;t have size known at compile time&rdquo; çš„é”™è¯¯ä¿¡æ¯ä¸­æ‰ä¼šæ˜¾éœ²ï¼Œè¿™äº›é”™è¯¯ä¿¡æ¯å¯¹äºæ¯ä¸ª Rustacean æ¥è¯´éƒ½å¤ªè¿‡ç†Ÿæ‚‰äº†ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨ Sized çš„å„ç§å½¢å¼ï¼ŒåŒ…æ‹¬å›ºå®šå¤§å°ç±»å‹ã€æœªå®šå¤§å°ç±»å‹ä»¥åŠé›¶å¤§å°ç±»å‹ï¼ŒåŒæ—¶è¿˜å°†è€ƒå¯Ÿå®ƒä»¬çš„ç”¨ä¾‹ã€ä¼˜åŠ¿ã€ç—›ç‚¹åŠç›¸åº”è§£å†³æ–¹æ¡ˆã€‚"><meta property="og:type" content="article"><meta property="og:url" content="https://lorenwe.eu.org/posts/tech/rust%E4%B8%AD%E7%9A%84sized/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-10-16T09:55:37+08:00"><meta property="article:modified_time" content="2024-10-16T09:55:37+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Rust ä¸­çš„ Sized"><meta name=twitter:description content="åŸæ–‡ï¼š Sizedness in Rust
æ¦‚è¿°
Sized å…¶å®æ˜¯ Rust ä¸­æœ€é‡è¦çš„æ¦‚å¿µä¹‹ä¸€ï¼Œå¯è°“åŠŸæˆä¸å±…ã€‚å®ƒå¾€å¾€ä»¥å¾®å¦™çš„å½¢å¼ä¸å…¶ä»–è¯­è¨€ç‰¹æ€§äº¤ç»‡åœ¨ä¸€èµ·ï¼Œåªæœ‰åœ¨å½¢å¦‚ &ldquo;x doesn&rsquo;t have size known at compile time&rdquo; çš„é”™è¯¯ä¿¡æ¯ä¸­æ‰ä¼šæ˜¾éœ²ï¼Œè¿™äº›é”™è¯¯ä¿¡æ¯å¯¹äºæ¯ä¸ª Rustacean æ¥è¯´éƒ½å¤ªè¿‡ç†Ÿæ‚‰äº†ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨ Sized çš„å„ç§å½¢å¼ï¼ŒåŒ…æ‹¬å›ºå®šå¤§å°ç±»å‹ã€æœªå®šå¤§å°ç±»å‹ä»¥åŠé›¶å¤§å°ç±»å‹ï¼ŒåŒæ—¶è¿˜å°†è€ƒå¯Ÿå®ƒä»¬çš„ç”¨ä¾‹ã€ä¼˜åŠ¿ã€ç—›ç‚¹åŠç›¸åº”è§£å†³æ–¹æ¡ˆã€‚"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"ğŸ“šæ–‡ç« ","item":"https://lorenwe.eu.org/posts/"},{"@type":"ListItem","position":2,"name":"ğŸ‘¨ğŸ»â€ğŸ’» æŠ€æœ¯","item":"https://lorenwe.eu.org/posts/tech/"},{"@type":"ListItem","position":3,"name":"Rust ä¸­çš„ Sized","item":"https://lorenwe.eu.org/posts/tech/rust%E4%B8%AD%E7%9A%84sized/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Rust ä¸­çš„ Sized","name":"Rust ä¸­çš„ Sized","description":"åŸæ–‡ï¼š Sizedness in Rust\næ¦‚è¿° Sized å…¶å®æ˜¯ Rust ä¸­æœ€é‡è¦çš„æ¦‚å¿µä¹‹ä¸€ï¼Œå¯è°“åŠŸæˆä¸å±…ã€‚å®ƒå¾€å¾€ä»¥å¾®å¦™çš„å½¢å¼ä¸å…¶ä»–è¯­è¨€ç‰¹æ€§äº¤ç»‡åœ¨ä¸€èµ·ï¼Œåªæœ‰åœ¨å½¢å¦‚ \u0026ldquo;x doesn\u0026rsquo;t have size known at compile time\u0026rdquo; çš„é”™è¯¯ä¿¡æ¯ä¸­æ‰ä¼šæ˜¾éœ²ï¼Œè¿™äº›é”™è¯¯ä¿¡æ¯å¯¹äºæ¯ä¸ª Rustacean æ¥è¯´éƒ½å¤ªè¿‡ç†Ÿæ‚‰äº†ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨ Sized çš„å„ç§å½¢å¼ï¼ŒåŒ…æ‹¬å›ºå®šå¤§å°ç±»å‹ã€æœªå®šå¤§å°ç±»å‹ä»¥åŠé›¶å¤§å°ç±»å‹ï¼ŒåŒæ—¶è¿˜å°†è€ƒå¯Ÿå®ƒä»¬çš„ç”¨ä¾‹ã€ä¼˜åŠ¿ã€ç—›ç‚¹åŠç›¸åº”è§£å†³æ–¹æ¡ˆã€‚\n","keywords":[""],"articleBody":"åŸæ–‡ï¼š Sizedness in Rust\næ¦‚è¿° Sized å…¶å®æ˜¯ Rust ä¸­æœ€é‡è¦çš„æ¦‚å¿µä¹‹ä¸€ï¼Œå¯è°“åŠŸæˆä¸å±…ã€‚å®ƒå¾€å¾€ä»¥å¾®å¦™çš„å½¢å¼ä¸å…¶ä»–è¯­è¨€ç‰¹æ€§äº¤ç»‡åœ¨ä¸€èµ·ï¼Œåªæœ‰åœ¨å½¢å¦‚ â€œx doesnâ€™t have size known at compile timeâ€ çš„é”™è¯¯ä¿¡æ¯ä¸­æ‰ä¼šæ˜¾éœ²ï¼Œè¿™äº›é”™è¯¯ä¿¡æ¯å¯¹äºæ¯ä¸ª Rustacean æ¥è¯´éƒ½å¤ªè¿‡ç†Ÿæ‚‰äº†ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨ Sized çš„å„ç§å½¢å¼ï¼ŒåŒ…æ‹¬å›ºå®šå¤§å°ç±»å‹ã€æœªå®šå¤§å°ç±»å‹ä»¥åŠé›¶å¤§å°ç±»å‹ï¼ŒåŒæ—¶è¿˜å°†è€ƒå¯Ÿå®ƒä»¬çš„ç”¨ä¾‹ã€ä¼˜åŠ¿ã€ç—›ç‚¹åŠç›¸åº”è§£å†³æ–¹æ¡ˆã€‚\n[æ³¨ï¼šæœ¬æ–‡çš„â€œå®½åº¦â€é€šå¸¸æŒ‡æŒ‡é’ˆå®½åº¦ï¼Œä¹Ÿå°±æ˜¯æœºå™¨å­—é•¿ã€‚åœ¨ 32 ä½ç³»ç»Ÿä¸­ï¼Œ1 ä¸ªå®½åº¦çš„å¤§å°æ˜¯ 32 ä½ï¼Œä¹Ÿå°±æ˜¯ 4 ä¸ªå­—èŠ‚ï¼›åœ¨ 64 ä½ç³»ç»Ÿä¸­åˆ™æ˜¯ 8 ä¸ªå­—èŠ‚ã€‚2 ä¸ªå®½åº¦ä¹Ÿå«â€œèƒ–æŒ‡é’ˆâ€æˆ–â€œå®½æŒ‡é’ˆâ€ã€‚]\nSized åœ¨ Rust ä¸­ï¼Œå¦‚æœä¸€ä¸ªç±»å‹çš„å­—èŠ‚å¤§å°å¯ä»¥åœ¨ç¼–è¯‘æœŸç¡®å®šï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ å›ºå®šå¤§å°ç±»å‹ï¼ˆsized typeï¼‰ã€‚ç¡®å®šæŸç±»å‹çš„å¤§å°éå¸¸é‡è¦ï¼Œåªæœ‰è¿™æ ·æ‰èƒ½åœ¨æ ˆä¸Šä¸ºè¯¥ç±»å‹çš„å®ä¾‹åˆ†é…è¶³å¤Ÿçš„ç©ºé—´ã€‚å›ºå®šå¤§å°ç±»å‹å¯ä»¥é€šè¿‡å€¼æˆ–å¼•ç”¨è¿›è¡Œä¼ é€’ã€‚å¦‚æœä¸€ä¸ªç±»å‹çš„å¤§å°æ— æ³•åœ¨ç¼–è¯‘æœŸç¡®å®šï¼Œé‚£ä¹ˆå®ƒè¢«ç§°ä¸º æœªå®šå¤§å°ç±»å‹ï¼ˆunsized typeï¼‰ æˆ– åŠ¨æ€å¤§å°ç±»å‹ï¼ˆDST, Dynamically-Sized Typeï¼‰ã€‚ç”±äºæœªå®šå¤§å°ç±»å‹æ— æ³•æ”¾ç½®åœ¨æ ˆä¸Šï¼Œå› æ­¤å®ƒä»¬åªèƒ½é€šè¿‡å¼•ç”¨è¿›è¡Œä¼ é€’ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å›ºå®šå¤§å°å’Œæœªå®šå¤§å°ç±»å‹çš„ç¤ºä¾‹ï¼š\nuse std::mem::size_of; fn main() { // åŸç”Ÿç±»å‹ assert_eq!(4, size_of::()); assert_eq!(8, size_of::()); // å…ƒç»„ assert_eq!(8, size_of::\u003c(i32, i32)\u003e()); // æ•°ç»„ assert_eq!(0, size_of::\u003c[i32; 0]\u003e()); assert_eq!(12, size_of::\u003c[i32; 3]\u003e()); struct Point { x: i32, y: i32, } // ç»“æ„ä½“ assert_eq!(8, size_of::()); // æšä¸¾ assert_eq!(8, size_of::","wordCount":"10417","inLanguage":"zh","datePublished":"2024-10-16T09:55:37+08:00","dateModified":"2024-10-16T09:55:37+08:00","author":[{"@type":"Person","name":"Lorenwe"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://lorenwe.eu.org/posts/tech/rust%E4%B8%AD%E7%9A%84sized/"},"publisher":{"@type":"Organization","name":"Lorenwe Blog","logo":{"@type":"ImageObject","url":"https://lorenwe.eu.org/img/favicon.ico"}}}</script></head><body id=top><script>(function(){let e,t=new RegExp("(^| )change-themes=([^;]*)(;|$)");(e=document.cookie.match(t))||((new Date).getHours()>=19||(new Date).getHours()<6?(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark")):(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")))})(),localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://lorenwe.eu.org/ accesskey=h title="Lorenwe Blog (Alt + H)"><img src=https://lorenwe.eu.org/img/kaola.png alt=logo aria-label=logo height=35>Lorenwe Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)">
<svg id="moon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://lorenwe.eu.org/search title="ğŸ” æœç´¢ (Alt + /)" accesskey=/><span>ğŸ” æœç´¢</span></a></li><li><a href=https://lorenwe.eu.org/ title="ğŸ  ä¸»é¡µ"><span>ğŸ  ä¸»é¡µ</span></a></li><li><a href=https://lorenwe.eu.org/posts title="ğŸ“š æ–‡ç« "><span>ğŸ“š æ–‡ç« </span></a></li><li><a href=https://lorenwe.eu.org/tags title="ğŸ§© æ ‡ç­¾"><span>ğŸ§© æ ‡ç­¾</span></a></li><li><a href=https://lorenwe.eu.org/archives/ title="â±ï¸ æ—¶é—´è½´"><span>â±ï¸ æ—¶é—´è½´</span></a></li><li><a href=https://lorenwe.eu.org/about title="ğŸ™‹ğŸ»â€â™‚ï¸ å…³äº"><span>ğŸ™‹ğŸ»â€â™‚ï¸ å…³äº</span></a></li><li><a href=https://lorenwe.eu.org/links title="ğŸ¤ å‹é“¾"><span>ğŸ¤ å‹é“¾</span></a></li></ul></nav></header><main class="main page"><style>i[id*=post_meta_style]{display:flex;align-items:center;margin:0 0 10px}</style><article class=post-single><div id=single-content><header class=post-header><div class=breadcrumbs><a href=https://lorenwe.eu.org/>ğŸ  ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href=https://lorenwe.eu.org/posts/>ğŸ“šæ–‡ç« </a>&nbsp;Â»&nbsp;<a href=https://lorenwe.eu.org/posts/tech/>ğŸ‘¨ğŸ»â€ğŸ’» æŠ€æœ¯</a></div><h1 class=post-title>Rust ä¸­çš„ Sized</h1><div class=post-meta><style>i[id*=post_meta_style]{display:flex;align-items:center;margin:0 0 10px}.parent-post-meta{display:flex;flex-wrap:wrap;opacity:.8}</style><span class=parent-post-meta><span id=post_meta_style_1><span class="fa fa-calendar-check-o"></span>
<span>2024-10-16
&nbsp;&nbsp;
</span></span><span id=post_meta_style_3><span class="fa fa-file-word-o"></span>
<span>10417å­—
&nbsp;&nbsp;
</span></span><span id=post_meta_style_4><span class="fa fa-clock-o"></span>
<span>21åˆ†é’Ÿ
&nbsp;&nbsp;
</span></span><span id=post_meta_style_5><span class="fa fa-user-o"></span>
<span>Lorenwe
&nbsp;&nbsp;
</span></span><span id=post_meta_style_6><span class="fa fa-tags" style=opacity:.8></span>
<span><span class=post-tags-meta></span></span></span></span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>ç›®å½•</span></summary><div class=inner><ul><li><a href=#%e6%a6%82%e8%bf%b0 aria-label=æ¦‚è¿°>æ¦‚è¿°</a></li><li><a href=#sized aria-label=Sized>Sized</a></li><li><a href=#sized-trait aria-label="Sized Trait">Sized Trait</a></li><li><a href=#%e6%b3%9b%e5%9e%8b%e4%b8%ad%e7%9a%84-sized aria-label="æ³›å‹ä¸­çš„ Sized">æ³›å‹ä¸­çš„ Sized</a></li><li><a href=#%e6%9c%aa%e5%ae%9a%e5%a4%a7%e5%b0%8f%e7%b1%bb%e5%9e%8b aria-label=æœªå®šå¤§å°ç±»å‹>æœªå®šå¤§å°ç±»å‹</a><ul><li><a href=#%e5%88%87%e7%89%87 aria-label=åˆ‡ç‰‡>åˆ‡ç‰‡</a></li><li><a href=#trait-%e5%af%b9%e8%b1%a1 aria-label="Trait å¯¹è±¡">Trait å¯¹è±¡</a></li><li><a href=#trait-%e5%af%b9%e8%b1%a1%e7%9a%84%e9%99%90%e5%88%b6 aria-label="Trait å¯¹è±¡çš„é™åˆ¶">Trait å¯¹è±¡çš„é™åˆ¶</a></li><li><a href=#%e7%94%a8%e6%88%b7%e8%87%aa%e5%ae%9a%e4%b9%89%e7%9a%84%e6%9c%aa%e5%ae%9a%e5%a4%a7%e5%b0%8f%e7%b1%bb%e5%9e%8b aria-label=ç”¨æˆ·è‡ªå®šä¹‰çš„æœªå®šå¤§å°ç±»å‹>ç”¨æˆ·è‡ªå®šä¹‰çš„æœªå®šå¤§å°ç±»å‹</a></li></ul></li><li><a href=#%e9%9b%b6%e5%a4%a7%e5%b0%8f%e7%b1%bb%e5%9e%8b aria-label=é›¶å¤§å°ç±»å‹>é›¶å¤§å°ç±»å‹</a><ul><li><a href=#%e5%8d%95%e5%85%83%e7%b1%bb%e5%9e%8bunit-type aria-label="å•å…ƒç±»å‹ï¼ˆunit typeï¼‰">å•å…ƒç±»å‹ï¼ˆunit typeï¼‰</a></li><li><a href=#%e5%8d%95%e5%85%83%e7%bb%93%e6%9e%84%e4%bd%93unit-struct aria-label="å•å…ƒç»“æ„ä½“ï¼ˆunit structï¼‰">å•å…ƒç»“æ„ä½“ï¼ˆunit structï¼‰</a></li><li><a href=#never-%e7%b1%bb%e5%9e%8b aria-label="Never ç±»å‹">Never ç±»å‹</a></li><li><a href=#%e7%94%a8%e6%88%b7%e8%87%aa%e5%ae%9a%e4%b9%89%e7%9a%84%e4%bc%aa-never-%e7%b1%bb%e5%9e%8b aria-label="ç”¨æˆ·è‡ªå®šä¹‰çš„ä¼ª Never ç±»å‹">ç”¨æˆ·è‡ªå®šä¹‰çš„ä¼ª Never ç±»å‹</a></li><li><a href=#phantomdata aria-label=PhantomData>PhantomData</a></li></ul></li><li><a href=#%e7%bb%93%e8%ae%ba aria-label=ç»“è®º>ç»“è®º</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{elements&&(activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")}))},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><p>åŸæ–‡ï¼š <a href=https://github.com/pretzelhammer/rust-blog/blob/master/posts/sizedness-in-rust.md>Sizedness in Rust</a></p><h3 id=æ¦‚è¿°>æ¦‚è¿°<a hidden class=anchor aria-hidden=true href=#æ¦‚è¿°>#</a></h3><p>Sized å…¶å®æ˜¯ Rust ä¸­æœ€é‡è¦çš„æ¦‚å¿µä¹‹ä¸€ï¼Œå¯è°“åŠŸæˆä¸å±…ã€‚å®ƒå¾€å¾€ä»¥å¾®å¦™çš„å½¢å¼ä¸å…¶ä»–è¯­è¨€ç‰¹æ€§äº¤ç»‡åœ¨ä¸€èµ·ï¼Œåªæœ‰åœ¨å½¢å¦‚ &ldquo;x doesn&rsquo;t have size known at compile time&rdquo; çš„é”™è¯¯ä¿¡æ¯ä¸­æ‰ä¼šæ˜¾éœ²ï¼Œè¿™äº›é”™è¯¯ä¿¡æ¯å¯¹äºæ¯ä¸ª Rustacean æ¥è¯´éƒ½å¤ªè¿‡ç†Ÿæ‚‰äº†ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨ Sized çš„å„ç§å½¢å¼ï¼ŒåŒ…æ‹¬å›ºå®šå¤§å°ç±»å‹ã€æœªå®šå¤§å°ç±»å‹ä»¥åŠé›¶å¤§å°ç±»å‹ï¼ŒåŒæ—¶è¿˜å°†è€ƒå¯Ÿå®ƒä»¬çš„ç”¨ä¾‹ã€ä¼˜åŠ¿ã€ç—›ç‚¹åŠç›¸åº”è§£å†³æ–¹æ¡ˆã€‚</p><p>[æ³¨ï¼šæœ¬æ–‡çš„â€œå®½åº¦â€é€šå¸¸æŒ‡æŒ‡é’ˆå®½åº¦ï¼Œä¹Ÿå°±æ˜¯æœºå™¨å­—é•¿ã€‚åœ¨ 32 ä½ç³»ç»Ÿä¸­ï¼Œ1 ä¸ªå®½åº¦çš„å¤§å°æ˜¯ 32 ä½ï¼Œä¹Ÿå°±æ˜¯ 4 ä¸ªå­—èŠ‚ï¼›åœ¨ 64 ä½ç³»ç»Ÿä¸­åˆ™æ˜¯ 8 ä¸ªå­—èŠ‚ã€‚2 ä¸ªå®½åº¦ä¹Ÿå«â€œèƒ–æŒ‡é’ˆâ€æˆ–â€œå®½æŒ‡é’ˆâ€ã€‚]</p><h3 id=sized>Sized<a hidden class=anchor aria-hidden=true href=#sized>#</a></h3><p>åœ¨ Rust ä¸­ï¼Œå¦‚æœä¸€ä¸ªç±»å‹çš„å­—èŠ‚å¤§å°å¯ä»¥åœ¨ç¼–è¯‘æœŸç¡®å®šï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ å›ºå®šå¤§å°ç±»å‹ï¼ˆsized typeï¼‰ã€‚ç¡®å®šæŸç±»å‹çš„å¤§å°éå¸¸é‡è¦ï¼Œåªæœ‰è¿™æ ·æ‰èƒ½åœ¨æ ˆä¸Šä¸ºè¯¥ç±»å‹çš„å®ä¾‹åˆ†é…è¶³å¤Ÿçš„ç©ºé—´ã€‚å›ºå®šå¤§å°ç±»å‹å¯ä»¥é€šè¿‡å€¼æˆ–å¼•ç”¨è¿›è¡Œä¼ é€’ã€‚å¦‚æœä¸€ä¸ªç±»å‹çš„å¤§å°æ— æ³•åœ¨ç¼–è¯‘æœŸç¡®å®šï¼Œé‚£ä¹ˆå®ƒè¢«ç§°ä¸º æœªå®šå¤§å°ç±»å‹ï¼ˆunsized typeï¼‰ æˆ– åŠ¨æ€å¤§å°ç±»å‹ï¼ˆDST, Dynamically-Sized Typeï¼‰ã€‚ç”±äºæœªå®šå¤§å°ç±»å‹æ— æ³•æ”¾ç½®åœ¨æ ˆä¸Šï¼Œå› æ­¤å®ƒä»¬åªèƒ½é€šè¿‡å¼•ç”¨è¿›è¡Œä¼ é€’ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å›ºå®šå¤§å°å’Œæœªå®šå¤§å°ç±»å‹çš„ç¤ºä¾‹ï¼š</p><pre><code class=language-rust>use std::mem::size_of;
fn main() {
    // åŸç”Ÿç±»å‹
    assert_eq!(4, size_of::&lt;i32&gt;());
    assert_eq!(8, size_of::&lt;f64&gt;());
    // å…ƒç»„
    assert_eq!(8, size_of::&lt;(i32, i32)&gt;());
    // æ•°ç»„
    assert_eq!(0, size_of::&lt;[i32; 0]&gt;());
    assert_eq!(12, size_of::&lt;[i32; 3]&gt;());
    struct Point {
        x: i32,
        y: i32,
    }
    // ç»“æ„ä½“
    assert_eq!(8, size_of::&lt;Point&gt;());
    // æšä¸¾
    assert_eq!(8, size_of::&lt;Option&lt;i32&gt;&gt;());
    // è·å–æŒ‡é’ˆå®½åº¦(å³æœºå™¨å­—é•¿)ï¼Œ
    // åœ¨ 32 ä½ç³»ç»Ÿä¸Šæ˜¯ 4 ä¸ªå­—èŠ‚
    // åœ¨ 64 ä½ç³»ç»Ÿä¸Šæ˜¯ 8 ä¸ªå­—èŠ‚
    const WIDTH: usize = size_of::&lt;&amp;()&gt;();
    // æŒ‡å‘å›ºå®šå¤§å°ç±»å‹çš„æŒ‡é’ˆå ç”¨ 1 ä¸ªå®½åº¦
    assert_eq!(WIDTH, size_of::&lt;&amp;i32&gt;());
    assert_eq!(WIDTH, size_of::&lt;&amp;mut i32&gt;());
    assert_eq!(WIDTH, size_of::&lt;Box&lt;i32&gt;&gt;());
    assert_eq!(WIDTH, size_of::&lt;fn(i32) -&gt; i32&gt;());
    const DOUBLE_WIDTH: usize = 2 * WIDTH;
    // æœªå®šå¤§å°çš„ç»“æ„ä½“
    struct Unsized {
        unsized_field: [i32],
    }
    // æŒ‡å‘æœªå®šå¤§å°ç±»å‹çš„æŒ‡é’ˆå ç”¨ 2 ä¸ªå®½åº¦
    assert_eq!(DOUBLE_WIDTH, size_of::&lt;&amp;str&gt;()); // åˆ‡ç‰‡
    assert_eq!(DOUBLE_WIDTH, size_of::&lt;&amp;[i32]&gt;()); // åˆ‡ç‰‡
    assert_eq!(DOUBLE_WIDTH, size_of::&lt;&amp;dyn ToString&gt;()); // trait å¯¹è±¡
    assert_eq!(DOUBLE_WIDTH, size_of::&lt;Box&lt;dyn ToString&gt;&gt;()); // trait å¯¹è±¡
    assert_eq!(DOUBLE_WIDTH, size_of::&lt;&amp;Unsized&gt;()); // è‡ªå®šä¹‰çš„æœªå®šå¤§å°ç±»å‹
    // æœªå®šå¤§å°ç±»å‹
    size_of::&lt;str&gt;(); // ç¼–è¯‘é”™è¯¯
    size_of::&lt;[i32]&gt;(); // ç¼–è¯‘é”™è¯¯
    size_of::&lt;dyn ToString&gt;(); // ç¼–è¯‘é”™è¯¯
    size_of::&lt;Unsized&gt;(); // ç¼–è¯‘é”™è¯¯
}
</code></pre><p>å›ºå®šå¤§å°ç±»å‹çš„å¤§å°æ˜¾è€Œæ˜“è§ï¼šæ‰€æœ‰åŸç”Ÿç±»å‹å’ŒæŒ‡é’ˆéƒ½å…·æœ‰å·²çŸ¥å¤§å°ï¼Œè€Œæ‰€æœ‰çš„ç»“æ„ä½“ã€å…ƒç»„ã€æšä¸¾å’Œæ•°ç»„éƒ½æ˜¯ç”±åŸç”Ÿç±»å‹ã€æŒ‡é’ˆæˆ–å…¶ä»–åµŒå¥—çš„ç»“æ„ä½“ã€å…ƒç»„ã€æšä¸¾å’Œæ•°ç»„ç»„æˆçš„ï¼Œå› æ­¤å¯ä»¥é€’å½’åœ°è®¡ç®—å…¶å­—èŠ‚æ€»æ•°ï¼Œä»¥åŠå†…å­˜å¡«å……å’Œå¯¹é½æ‰€éœ€çš„é¢å¤–å­—èŠ‚ã€‚åŒæ ·æ˜¾è€Œæ˜“è§çš„æ˜¯ï¼Œæœªå®šå¤§å°ç±»å‹çš„å¤§å°æ— æ³•ç¡®å®šï¼šåˆ‡ç‰‡å¯ä»¥åŒ…å«ä»»æ„æ•°é‡çš„å…ƒç´ ï¼Œå› æ­¤å®ƒåœ¨è¿è¡ŒæœŸå…·æœ‰ä»»æ„å¤§å°ï¼›è€Œ trait å¯¹è±¡åˆ™å¯ä»¥ç”±ä»»æ„æ•°é‡çš„ç»“æ„ä½“æˆ–æšä¸¾å®ç°ï¼Œå› æ­¤åœ¨è¿è¡ŒæœŸä¹Ÿå¯ä»¥å…·æœ‰ä»»æ„å¤§å°ã€‚</p><p>ä¸“ä¸šæç¤º</p><ul><li>åœ¨ Rust ä¸­ï¼ŒæŒ‡å‘åŠ¨æ€å¤§å°æ•°ç»„è§†å›¾çš„æŒ‡é’ˆè¢«ç§°ä¸ºåˆ‡ç‰‡ï¼ˆsliceï¼‰ã€‚ä¾‹å¦‚ï¼Œ&amp;str è¢«ç§°ä¸º &ldquo;å­—ç¬¦ä¸²åˆ‡ç‰‡&rdquo;ï¼Œ&[i32] è¢«ç§°ä¸º &ldquo;i32 åˆ‡ç‰‡&rdquo;</li><li>åˆ‡ç‰‡å ç”¨ 2 ä¸ªå®½åº¦ï¼Œåˆ†åˆ«å­˜å‚¨æŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆå’Œæ•°ç»„ä¸­å…ƒç´ çš„æ•°é‡</li><li>trait å¯¹è±¡æŒ‡é’ˆå ç”¨ 2 ä¸ªå®½åº¦ï¼Œåˆ†åˆ«å­˜å‚¨æŒ‡å‘æ•°æ®çš„æŒ‡é’ˆå’ŒæŒ‡å‘è™šè¡¨ï¼ˆvtableï¼‰çš„æŒ‡é’ˆ</li><li>æœªå®šå¤§å°çš„ç»“æ„ä½“æŒ‡é’ˆå ç”¨ 2 ä¸ªå®½åº¦ï¼Œåˆ†åˆ«å­˜å‚¨æŒ‡å‘ç»“æ„ä½“æ•°æ®çš„æŒ‡é’ˆå’Œç»“æ„ä½“çš„å¤§å°</li><li>æœªå®šå¤§å°çš„ç»“æ„ä½“åªèƒ½æœ‰ä¸€ä¸ªæœªå®šå¤§å°çš„å­—æ®µï¼Œå¹¶ä¸”å®ƒå¿…é¡»æ˜¯ç»“æ„ä½“ä¸­æœ€åä¸€ä¸ªå­—æ®µ</li></ul><p>ä¸ºäº†å¼ºåŒ–â€œæœªå®šå¤§å°ç±»å‹å ç”¨ 2 ä¸ªå®½åº¦â€çš„è§‚ç‚¹ï¼Œæ­¤å¤„é€šè¿‡å¸¦æ³¨é‡Šçš„ä»£ç ç¤ºä¾‹ï¼Œå°†æ•°ç»„ä¸åˆ‡ç‰‡è¿›è¡Œäº†æ¯”è¾ƒã€‚</p><pre><code class=language-rust>use std::mem::size_of;

const WIDTH: usize = size_of::&lt;&amp;()&gt;();
const DOUBLE_WIDTH: usize = 2 * WIDTH;

fn main() {
    // ç±»å‹ä¸­å­˜å‚¨çš„æ•°æ®é•¿åº¦
    // [i32; 3] è¡¨ç¤ºå­˜æ”¾ä¸‰ä¸ª i32 çš„æ•°ç»„
    let nums: &amp;[i32; 3] = &amp;[1, 2, 3];

    // 1 ä¸ªæŒ‡é’ˆå®½åº¦
    assert_eq!(WIDTH, size_of::&lt;&amp;[i32; 3]&gt;());

    let mut sum = 0;

    // å¯ä»¥å®‰å…¨åœ°è¿­ä»£ nums
    // Rust çŸ¥é“å…¶ç¡®åˆ‡æœ‰ 3 ä¸ªå…ƒç´ 
    for num in nums {
        sum += num;
    }

    assert_eq!(6, sum);

    // æœªå®šå¤§å°å¼ºåˆ¶è½¬æ¢ï¼Œä» [i32; 3] è½¬ä¸º [i32]
    // æ•°æ®é•¿åº¦ç°åœ¨å­˜å‚¨åœ¨æŒ‡é’ˆä¸­
    let nums: &amp;[i32] = &amp;[1, 2, 3];
    
    // éœ€è¦ 2 ä¸ªæŒ‡é’ˆå®½åº¦æ¥åŒæ—¶å­˜å‚¨æ•°æ®é•¿åº¦
    assert_eq!(DOUBLE_WIDTH, size_of::&lt;&amp;[i32]&gt;());

    let mut sum = 0;

    // å¯ä»¥å®‰å…¨åœ°è¿­ä»£ nums
    // Rust çŸ¥é“å…¶ç¡®åˆ‡æœ‰ 3 ä¸ªå…ƒç´ 
    for num in nums {
        sum += num;
    }
    assert_eq!(6, sum);
}
</code></pre><p>ä»¥ä¸‹æ˜¯å¦ä¸€ä¸ªæœ‰æ³¨é‡Šçš„ä»£ç ç¤ºä¾‹ï¼Œæ¯”è¾ƒäº†ç»“æ„ä½“å’Œ trait å¯¹è±¡çš„åŒºåˆ«ï¼š</p><pre><code class=language-rust>use std::mem::size_of;

const WIDTH: usize = size_of::&lt;&amp;()&gt;();
const DOUBLE_WIDTH: usize = 2 * WIDTH;

trait Trait {
    fn print(&amp;self);
}

struct Struct;
struct Struct2;

impl Trait for Struct {
    fn print(&amp;self) {
        println!(&quot;struct&quot;);
    }
}

impl Trait for Struct2 {
    fn print(&amp;self) {
        println!(&quot;struct2&quot;);
    }
}

fn print_struct(s: &amp;Struct) {
    // æ€»æ˜¯æ‰“å° &quot;struct&quot;ï¼Œç¼–è¯‘æœŸå³å¯çŸ¥
    s.print();
    // å•å®½åº¦æŒ‡é’ˆ
    assert_eq!(WIDTH, size_of::&lt;&amp;Struct&gt;());
}

fn print_struct2(s2: &amp;Struct2) {
    // æ€»æ˜¯æ‰“å° &quot;struct2&quot;ï¼Œç¼–è¯‘æœŸå³å¯çŸ¥
    s2.print();
    // å•å®½åº¦æŒ‡é’ˆ
    assert_eq!(WIDTH, size_of::&lt;&amp;Struct2&gt;());
}

fn print_trait(t: &amp;dyn Trait) {
    // æ‰“å° &quot;struct&quot; è¿˜æ˜¯ &quot;struct2&quot; ? ç¼–è¯‘æœŸä¸å¯çŸ¥
    t.print();
    // Rust éœ€è¦åœ¨è¿è¡ŒæœŸæ£€æŸ¥æŒ‡é’ˆä»¥ç¡®å®šæ˜¯ä½¿ç”¨
    // Struct è¿˜æ˜¯ Struct2 çš„ &quot;print&quot; å®ç°ï¼Œ
    // æ‰€ä»¥æŒ‡é’ˆå¿…é¡»æ˜¯åŒå®½åº¦çš„
    assert_eq!(DOUBLE_WIDTH, size_of::&lt;&amp;dyn Trait&gt;());
}

fn main() {
    // å•å®½åº¦æŒ‡é’ˆï¼ŒæŒ‡å‘æ•°æ®
    let s = &amp;Struct; 
    print_struct(s); // æ‰“å° &quot;struct&quot;
    
    // å•å®½åº¦æŒ‡é’ˆï¼ŒæŒ‡å‘æ•°æ®
    let s2 = &amp;Struct2;
    print_struct2(s2); // æ‰“å° &quot;struct2&quot;
    
    // æœªå®šå¤§å°å¼ºåˆ¶è½¬æ¢ï¼Œä» Struct åˆ° dyn Trait
    // åŒå®½åº¦æŒ‡é’ˆï¼ŒæŒ‡å‘æ•°æ®å’Œ Struct çš„è™šè¡¨
    let t: &amp;dyn Trait = &amp;Struct;
    print_trait(t); // æ‰“å° &quot;struct&quot;
    
    // æœªå®šå¤§å°å¼ºåˆ¶è½¬æ¢ï¼Œä» Struct2 åˆ° dyn Trait
    // åŒå®½åº¦æŒ‡é’ˆï¼ŒæŒ‡å‘æ•°æ®å’Œ Struct2 çš„è™šè¡¨
    let t: &amp;dyn Trait = &amp;Struct2;
    print_trait(t); // æ‰“å° &quot;struct2&quot;
}
</code></pre><p>ä¸»è¦æ”¶è·</p><ul><li>åªæœ‰å›ºå®šå¤§å°ç±»å‹çš„å®ä¾‹å¯ä»¥æ”¾åœ¨æ ˆä¸Šï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥æŒ‰å€¼ä¼ é€’</li><li>æœªå®šå¤§å°ç±»å‹çš„å®ä¾‹æ— æ³•æ”¾åœ¨æ ˆä¸Šï¼Œå¿…é¡»é€šè¿‡å¼•ç”¨è¿›è¡Œä¼ é€’</li><li>æŒ‡å‘æœªå®šå¤§å°ç±»å‹çš„æŒ‡é’ˆæ˜¯åŒå®½åº¦çš„ï¼Œå› ä¸ºé™¤äº†æŒ‡å‘æ•°æ®ä¹‹å¤–ï¼Œå®ƒä»¬è¿˜æœ‰é¢å¤–çš„ä¿¡æ¯è¦ç®¡ç†ï¼Œç”¨ä»¥è·Ÿè¸ªæ•°æ®çš„é•¿åº¦æˆ–è€…æŒ‡å‘è™šè¡¨</li></ul><h3 id=sized-trait>Sized Trait<a hidden class=anchor aria-hidden=true href=#sized-trait>#</a></h3><p>åœ¨ Rust ä¸­ï¼ŒSized trait å±äºè‡ªåŠ¨ traitï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªæ ‡è®° traitã€‚</p><p>è‡ªåŠ¨ trait æ˜¯æŒ‡åœ¨ç‰¹å®šæ¡ä»¶ä¸‹è‡ªåŠ¨ä¸ºç±»å‹å®ç°çš„ trait ã€‚æ ‡è®° trait åˆ™ç”¨äºè¡¨æ˜ç±»å‹å…·æœ‰æŸç§ç‰¹å®šå±æ€§ï¼Œæ ‡è®° trait ä¸åŒ…å«ä»»ä½• trait é¡¹â€”â€”åƒæ˜¯æ–¹æ³•ã€å…³è”å‡½æ•°ã€å…³è”å¸¸é‡æˆ–å…³è”ç±»å‹ã€‚æ‰€æœ‰è‡ªåŠ¨ trait éƒ½æ˜¯æ ‡è®° trait ï¼Œä½†ä¸æ˜¯æ‰€æœ‰æ ‡è®° trait éƒ½æ˜¯è‡ªåŠ¨ trait ã€‚è‡ªåŠ¨ trait å¿…é¡»æ˜¯æ ‡è®° trait ï¼Œå› ä¸ºåªæœ‰è¿™æ ·ç¼–è¯‘å™¨æ‰èƒ½ä¸ºå®ƒä»¬æä¾›è‡ªåŠ¨é»˜è®¤å®ç°ï¼Œå¦‚æœæŸ trait å…·æœ‰ä»»ä½• trait é¡¹ï¼Œå°±æ— æ³•å†æä¾›è‡ªåŠ¨é»˜è®¤å®ç°äº†ã€‚</p><p>å¦‚æœä¸€ä¸ªç±»å‹çš„æ‰€æœ‰æˆå‘˜éƒ½æ˜¯ Sized ç±»å‹ï¼Œé‚£ä¹ˆè¯¥ç±»å‹å°†è‡ªåŠ¨è·å¾— Sized å®ç°ã€‚â€œæˆå‘˜â€çš„å…·ä½“å«ä¹‰å–å†³äºå®¹å™¨ç±»å‹ï¼Œä¾‹å¦‚ï¼šç»“æ„ä½“çš„å­—æ®µï¼Œæšä¸¾çš„å˜ä½“ï¼Œæ•°ç»„çš„å…ƒç´ ï¼Œå…ƒç»„çš„é¡¹ç­‰ç­‰ã€‚ä¸€æ—¦æŸç±»å‹è¢«æ ‡è®°ä¸ºå…·æœ‰ Sized å®ç°ï¼Œæ„å‘³ç€å®ƒçš„å­—èŠ‚å¤§å°åœ¨ç¼–è¯‘æœŸä¾¿å·²çŸ¥ã€‚</p><p>å…¶ä»–è‡ªåŠ¨æ ‡è®° trait çš„ä¾‹å­è¿˜æœ‰ Send å’Œ Syncã€‚å¦‚æœä¸€ä¸ªç±»å‹å®ç°äº† Sendï¼Œåˆ™æ„å‘³ç€è¯¥ç±»å‹çš„å€¼å¯ä»¥ä»ä¸€ä¸ªçº¿ç¨‹ä¼ é€’åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ã€‚å¦‚æœä¸€ä¸ªç±»å‹å®ç°äº† Syncï¼Œåˆ™æ„å‘³ç€å¯ä»¥åœ¨å¤šçº¿ç¨‹é—´ä½¿ç”¨å…±äº«å¼•ç”¨å…±äº«å…¶å€¼ã€‚å¦‚æœä¸€ä¸ªç±»å‹çš„æ‰€æœ‰æˆå‘˜éƒ½æ˜¯ Send å’Œ Sync ç±»å‹ï¼Œé‚£ä¹ˆå®ƒå°†è‡ªåŠ¨è·å¾— Send å’Œ Sync å®ç°ã€‚Sized æœ‰äº›ç‰¹æ®Šä¹‹å¤„ï¼Œä¸å…¶ä»–è‡ªåŠ¨æ ‡è®° trait ä¸åŒçš„æ˜¯ï¼Œå®ƒä¸å¯è¢«å–æ¶ˆã€‚</p><pre><code class=language-rust>#![feature(negative_impls)]

// è¯¥ç±»å‹æ˜¯ Sized, Send åŠ Sync
struct Struct;

// å–æ¶ˆ Send trait
impl !Send for Struct {} // âœ…

// å–æ¶ˆ Sync trait
impl !Sync for Struct {} // âœ…

// ä¸èƒ½å–æ¶ˆ Sized
impl !Sized for Struct {} // âŒ
</code></pre><p>è¿™å€’ä¹Ÿåˆä¹æƒ…ç†ï¼Œæ¯•ç«Ÿæˆ‘ä»¬å¯èƒ½å‡ºäºä¸€äº›åŸå› ä¸å¸Œæœ›æŸç±»å‹è¢«åœ¨çº¿ç¨‹ä¹‹é—´ä¼ é€’æˆ–å…±äº«ï¼Œç„¶è€Œå¾ˆéš¾æƒ³è±¡å‡ºè¿™ç§æƒ…æ™¯ï¼šå¸Œæœ›ç¼–è¯‘å™¨â€œå¿˜è®°â€æŸç±»å‹çš„å¤§å°ï¼Œå¹¶å°†å…¶è§†ä¸ºä¸€ä¸ªæœªå®šå¤§å°çš„ç±»å‹ã€‚è¿™æ ·åšæ²¡æœ‰ä»»ä½•å¥½å¤„ï¼Œåªä¼šä½¿è¯¥ç±»å‹å˜å¾—æ›´åŠ éš¾ä»¥å¤„ç†ã€‚</p><p>æ­¤å¤–ï¼Œéå¸¸è°¨æ…åœ°è¯´ï¼ŒSized åœ¨æŠ€æœ¯ä¸Šå…¶å®å¹¶ä¸æ˜¯ä¸€ä¸ªè‡ªåŠ¨ traitï¼Œå› ä¸ºå®ƒå¹¶æ²¡æœ‰ä½¿ç”¨ auto å…³é”®å­—è¿›è¡Œå®šä¹‰ï¼Œç„¶è€Œç¼–è¯‘å™¨å¯¹å®ƒçš„ç‰¹æ®Šå¤„ç†æ–¹å¼ä½¿å…¶è¡Œä¸ºéå¸¸ç±»ä¼¼äºè‡ªåŠ¨ traitï¼Œå› æ­¤åœ¨å®è·µä¸­å°†å…¶è§†ä¸ºè‡ªåŠ¨ trait æ˜¯å¯è¡Œçš„ã€‚</p><p>ä¸»è¦æ”¶è·</p><ul><li>Sized æ˜¯ â€œè‡ªåŠ¨â€ æ ‡è®° trait</li></ul><h3 id=æ³›å‹ä¸­çš„-sized>æ³›å‹ä¸­çš„ Sized<a hidden class=anchor aria-hidden=true href=#æ³›å‹ä¸­çš„-sized>#</a></h3><p>å¯èƒ½ä¸æ˜“å¯Ÿè§‰ï¼šå½“ç¼–å†™æ³›å‹ä»£ç æ—¶ï¼Œæ¯ä¸ªæ³›å‹ç±»å‹å‚æ•°é»˜è®¤éƒ½ä¼šè‡ªåŠ¨ç»‘å®šåˆ° Sized trait ä¸Šã€‚</p><pre><code class=language-rust>// è¯¥æ³›å‹å‡½æ•°...
fn func&lt;T&gt;(t: T) {}

// ...å»æ‰è¯­æ³•ç³–å...
fn func&lt;T: Sized&gt;(t: T) {}

// ...å¯ä»¥é€šè¿‡æ˜ç¡®è®¾ç½®ä¸º ?Sized æ¥å–æ¶ˆå®ƒ...
fn func&lt;T: ?Sized&gt;(t: T) {} // âŒ

// ...ç„¶è€Œè¿™å°†æ— æ³•ç¼–è¯‘ï¼Œæ¯•ç«Ÿå®ƒæ²¡æœ‰å·²çŸ¥çš„å¤§å°ã€‚
// å› æ­¤æˆ‘ä»¬å¿…é¡»å°†å…¶æ”¾åœ¨æŒ‡é’ˆåé¢...
fn func&lt;T: ?Sized&gt;(t: &amp;T) {} // âœ…
fn func&lt;T: ?Sized&gt;(t: Box&lt;T&gt;) {} // âœ…
</code></pre><p>ä¸“ä¸šæç¤º</p><ul><li>?Sized å¯è¯»ä½œâ€œå¯é€‰å¤§å°çš„â€æˆ–â€œå¯èƒ½å…·æœ‰å¤§å°çš„â€ï¼Œå…¶è¢«æ·»åŠ åˆ°ç±»å‹å‚æ•°çš„çº¦æŸä¸­ï¼Œè¡¨ç¤ºè¯¥ç±»å‹æ—¢å¯ä»¥æ˜¯å›ºå®šå¤§å°ï¼Œä¹Ÿå¯ä»¥æ˜¯æœªå®šå¤§å°çš„</li><li>?Sized é€šå¸¸è¢«ç§°ä¸ºâ€œæ”¾å®½çº¦æŸâ€æˆ–â€œå®½æ¾çº¦æŸâ€ï¼Œå› ä¸ºå®ƒæ”¾å®½äº†å¯¹ç±»å‹å‚æ•°çš„é™åˆ¶</li><li>?Sized æ˜¯ Rust ä¸­å”¯ä¸€çš„å®½æ¾çº¦æŸ</li></ul><p>è¿™ä¸ªçŸ¥è¯†ç‚¹å¾ˆé‡è¦ï¼Œä¸ºä»€ä¹ˆï¼Ÿè¿™æ ·è¯´å§ï¼Œæ¯å½“ä½¿ç”¨æ³›å‹ç±»å‹å¹¶å°†å…¶ç½®äºæŒ‡é’ˆåé¢æ—¶ï¼Œæˆ‘ä»¬å‡ ä¹æ€»æ˜¯å¸Œæœ›å–æ¶ˆæ‰é»˜è®¤çš„ Sized çº¦æŸï¼Œä»¥ä½¿å‡½æ•°åœ¨æ¥å—å‚æ•°ç±»å‹æ—¶æ›´åŠ çµæ´»ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœä¸å–æ¶ˆæ‰é»˜è®¤çš„ Sized çº¦æŸï¼Œæœ€ç»ˆå°†ä¼šå¾—åˆ°äº›ä»¤äººå›°æƒ‘çš„ç¼–è¯‘é”™è¯¯ä¿¡æ¯ã€‚</p><p>æ¥ä¸‹æ¥å‚è§‚ä¸€ä¸‹æˆ‘åœ¨ Rust ä¸­ç¼–å†™çš„ç¬¬ä¸€ä¸ªæ³›å‹å‡½æ•°ã€‚æˆ‘åœ¨ dbg! å®ç¨³å®šå‘å¸ƒå‰ä¾¿å¼€å§‹å­¦ä¹  Rustï¼Œé‚£æ—¶æ‰“å°è°ƒè¯•å€¼çš„å”¯ä¸€æ–¹æ³•æ˜¯æ¯æ¬¡éƒ½æ‰‹åŠ¨è¾“å…¥ println!("{:?}", some_value);ï¼Œç›¸å½“ç¹çã€‚å› æ­¤ï¼Œæˆ‘å†³å®šç¼–å†™è¿™æ ·ä¸€ä¸ª debug è¾…åŠ©å‡½æ•°ï¼š</p><pre><code class=language-rust>use std::fmt::Debug;

fn debug&lt;T: Debug&gt;(t: T) { // T: Debug + Sized
    println!(&quot;{:?}&quot;, t);
}

fn main() {
    debug(&quot;my str&quot;); // T = &amp;str, &amp;str: Debug + Sized âœ…
}
</code></pre><p>ç›®å‰ä¸ºæ­¢ä¸€åˆ‡é¡ºåˆ©ï¼Œä½†æ˜¯è¯¥å‡½æ•°ä¼šè·å–ä»»ä½•ä¼ é€’ç»™å®ƒçš„å€¼çš„æ‰€æœ‰æƒï¼Œè¿™æœ‰ç‚¹è®©äººé—¹å¿ƒï¼Œæ‰€ä»¥æˆ‘å°†å‡½æ•°æ”¹ä¸ºåªæ¥å—å¼•ç”¨ä½œä¸ºå‚æ•°ï¼š</p><pre><code class=language-rust>use std::fmt::Debug;

fn dbg&lt;T: Debug&gt;(t: &amp;T) { // T: Debug + Sized
    println!(&quot;{:?}&quot;, t);
}

fn main() {
    dbg(&quot;my str&quot;); // &amp;T = &amp;str, T = str, str: Debug + !Sized âŒ
}
</code></pre><p>è¿™ä¸‹æŠ¥é”™äº†ï¼š</p><pre><code class=language-rust>error[E0277]: the size for values of type `str` cannot be known at compilation time
 --&gt; src/main.rs:8:9
  |
3 | fn dbg&lt;T: Debug&gt;(t: &amp;T) {
  |        - required by this bound in `dbg`
...
8 |     dbg(&quot;my str&quot;);
  |         ^^^^^^^^ doesn't have a size known at compile-time
  |
  = help: the trait `std::marker::Sized` is not implemented for `str`
  = note: to learn more, visit &lt;https://doc.rust-lang.org/book/ch19-04-advanced-types.html#dynamically-sized-types-and-the-sized-trait&gt;
help: consider relaxing the implicit `Sized` restriction
  |
3 | fn dbg&lt;T: Debug + ?Sized&gt;(t: &amp;T) {
  |   
</code></pre><p>å½“æˆ‘å¤´ä¸€æ¬¡çœ‹åˆ°è¿™äº›é”™è¯¯ä¿¡æ¯æ—¶ä¹Ÿæ˜¯ä¸€è„¸æ‡µé€¼ã€‚å°½ç®¡å‡½æ•°æ¥æ”¶çš„å‚æ•°æ¯”ä¹‹å‰æ›´åŠ ä¸¥æ ¼äº†ï¼Œä½†å´å‡ºç°äº†ç¼–è¯‘é”™è¯¯ï¼åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</p><p>ä¸Šé¢çš„ä»£ç æ³¨é‡Šä¸­æˆ‘å·²ç•¥å¾®é€éœ²äº†ç­”æ¡ˆï¼Œä½†æ€»çš„æ¥è¯´ï¼šåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼ŒRust è§£æ T ä¸ºå…·ä½“ç±»å‹æ—¶ä¼šæ‰§è¡Œæ¨¡å¼åŒ¹é…ã€‚ä¸‹é¢çš„è¡¨æ ¼å¯ä»¥å¸®åŠ©å˜æ¸…è¯¥é—®é¢˜ï¼š</p><table><thead><tr><th>ç±»å‹</th><th><code>T</code></th><th><code>&amp;T</code></th></tr></thead><tbody><tr><td><code>&amp;str</code></td><td><code>T</code> = <code>&amp;str</code></td><td><code>T</code> = <code>str</code></td></tr></tbody></table><table><thead><tr><th>ç±»å‹</th><th><code>Sized</code></th></tr></thead><tbody><tr><td><code>str</code></td><td>âŒ</td></tr><tr><td><code>&amp;str</code></td><td>âœ…</td></tr><tr><td><code>&&amp;str</code></td><td>âœ…</td></tr></tbody></table><p>è¿™ä¾¿æ˜¯ä¸ºä»€ä¹ˆåœ¨å°†å‡½æ•°æ”¹ä¸ºæ¥æ”¶å¼•ç”¨åï¼Œæˆ‘ä¸å¾—ä¸æ·»åŠ  ?Sized çº¦æŸä»¥ä½¿å‡½æ•°æŒ‰é¢„æœŸå·¥ä½œã€‚ä¸‹é¢æ˜¯å¯ä»¥æ­£å¸¸å·¥ä½œçš„å‡½æ•°ï¼š</p><pre><code class=language-rust>use std::fmt::Debug;

fn debug&lt;T: Debug + ?Sized&gt;(t: &amp;T) { // T: Debug + ?Sized
    println!(&quot;{:?}&quot;, t);
}

fn main() {
    debug(&quot;my str&quot;); // &amp;T = &amp;str, T = str, str: Debug + !Sized âœ…
}
</code></pre><p>ä¸»è¦æ”¶è·</p><ul><li>æ‰€æœ‰çš„æ³›å‹ç±»å‹å‚æ•°é»˜è®¤æƒ…å†µä¸‹éƒ½ä¼šè‡ªåŠ¨ç»‘å®šä¸º Sizedã€‚</li><li>è‹¥æœ‰æ³›å‹å‡½æ•°ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªæŒ‡é’ˆåé¢çš„å‚æ•° Tï¼Œè¯¸å¦‚ &amp;Tã€Box<t>ã€Rc<t> ç­‰ç­‰ï¼Œæ­¤æ—¶å‡ ä¹æ€»æ˜¯å¸Œæœ›ä½¿ç”¨ T: ?Sized å–æ¶ˆæ‰é»˜è®¤çš„ Sized çº¦æŸ</li></ul><h3 id=æœªå®šå¤§å°ç±»å‹>æœªå®šå¤§å°ç±»å‹<a hidden class=anchor aria-hidden=true href=#æœªå®šå¤§å°ç±»å‹>#</a></h3><h4 id=åˆ‡ç‰‡>åˆ‡ç‰‡<a hidden class=anchor aria-hidden=true href=#åˆ‡ç‰‡>#</a></h4><p>æœ€å¸¸è§çš„åˆ‡ç‰‡ç±»å‹æ˜¯å­—ç¬¦ä¸²åˆ‡ç‰‡ &amp;str å’Œæ•°ç»„åˆ‡ç‰‡ &[T]ã€‚åˆ‡ç‰‡ä¹‹å¥½å¤„åœ¨äºè®¸å¤šå…¶ä»–ç±»å‹å¯ä»¥è‡ªåŠ¨è½¬æ¢ä¸ºåˆ‡ç‰‡ï¼Œåˆ©ç”¨åˆ‡ç‰‡å’Œ Rust çš„è‡ªåŠ¨ç±»å‹è½¬æ¢æœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™å‡ºçµæ´»çš„ APIã€‚</p><p>å¼ºåˆ¶ç±»å‹è½¬æ¢å¯ä»¥å‘ç”Ÿåœ¨å¾ˆå¤šåœºæ™¯ï¼Œä½†æœ€æ˜¾è‘—çš„æ˜¯åœ¨å‡½æ•°å‚æ•°ä¸­ä»¥åŠæ–¹æ³•è°ƒç”¨æ—¶ã€‚å€¼å¾—å…³æ³¨çš„ç±»å‹è½¬æ¢æœ‰ä¸¤ç§ï¼Œå³ è§£å¼•ç”¨å¼ºè½¬ï¼ˆDeref Coercionï¼‰ å’Œ æœªå®šå¤§å°ç±»å‹å¼ºè½¬ï¼ˆUnsized Coercionï¼‰ã€‚è§£å¼•ç”¨å¼ºè½¬æ˜¯æŒ‡ä½¿ç”¨è§£å¼•ç”¨æ“ä½œå°† T å¼ºåˆ¶è½¬æ¢ä¸º Uï¼Œå³ <code>T: Deref&lt;Target = U></code>ï¼Œä¾‹å¦‚ <code>String.deref() -> str</code>ã€‚æœªå®šå¤§å°ç±»å‹å¼ºè½¬æ˜¯æŒ‡å°† T å¼ºåˆ¶è½¬æ¢ä¸º Uï¼Œå…¶ä¸­ T æ˜¯ä¸€ä¸ªå›ºå®šå¤§å°çš„ç±»å‹ï¼Œè€Œ U æ˜¯ä¸€ä¸ªæœªå®šå¤§å°çš„ç±»å‹ï¼Œå³ <code>T: Unsize&lt;U></code>ï¼Œä¾‹å¦‚ <code>[i32; 3] -> [i32]</code>ã€‚</p><pre><code class=language-rust>trait Trait {
    fn method(&amp;self) {}
}

impl Trait for str {
    // ç°åœ¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ç±»å‹è°ƒç”¨ &quot;method&quot; æ–¹æ³•
    // 1) str æˆ–
    // 2) Stringï¼Œ å› ä¸º String: Deref&lt;Target = str&gt;
}
impl&lt;T&gt; Trait for [T] {
    // ç°åœ¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ç±»å‹è°ƒç”¨ &quot;method&quot; æ–¹æ³•
    // 1) ä»»æ„ &amp;[T]
    // 2) ä»»æ„ U ä¸” U: Deref&lt;Target = [T]&gt;ï¼Œ æ¯”å¦‚ Vec&lt;T&gt;
    // 3) [T; N] ï¼ŒN ä¸ºä»»æ„å€¼, å› ä¸º [T; N]: Unsize&lt;[T]&gt;
}

fn str_fun(s: &amp;str) {}
fn slice_fun&lt;T&gt;(s: &amp;[T]) {}

fn main() {
    let str_slice: &amp;str = &quot;str slice&quot;;
    let string: String = &quot;string&quot;.to_owned();

    // å‡½æ•°å‚æ•°
    str_fun(str_slice);
    str_fun(&amp;string); // è§£å¼•ç”¨å¼ºè½¬

    // æ–¹æ³•è°ƒç”¨
    str_slice.method();
    string.method(); // è§£å¼•ç”¨å¼ºè½¬

    let slice: &amp;[i32] = &amp;[1];
    let three_array: [i32; 3] = [1, 2, 3];
    let five_array: [i32; 5] = [1, 2, 3, 4, 5];
    let vec: Vec&lt;i32&gt; = vec![1];

    // å‡½æ•°å‚æ•°
    slice_fun(slice);
    slice_fun(&amp;vec); // è§£å¼•ç”¨å¼ºè½¬
    slice_fun(&amp;three_array); // æœªå®šå¤§å°ç±»å‹å¼ºè½¬
    slice_fun(&amp;five_array); // æœªå®šå¤§å°ç±»å‹å¼ºè½¬

    // æ–¹æ³•è°ƒç”¨
    slice.method();
    vec.method(); // è§£å¼•ç”¨å¼ºè½¬
    three_array.method(); // æœªå®šå¤§å°ç±»å‹å¼ºè½¬
    five_array.method(); // æœªå®šå¤§å°ç±»å‹å¼ºè½¬
}
</code></pre><p>ä¸»è¦æ”¶è·</p><ul><li>åˆ©ç”¨åˆ‡ç‰‡å’Œ Rust çš„è‡ªåŠ¨ç±»å‹è½¬æ¢å¯ä»¥ç¼–å†™çµæ´»çš„ API</li></ul><h4 id=trait-å¯¹è±¡>Trait å¯¹è±¡<a hidden class=anchor aria-hidden=true href=#trait-å¯¹è±¡>#</a></h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œtrait æ˜¯ ?Sized çš„ã€‚ä»£ç ï¼š</p><pre><code class=language-rust>trait Trait: ?Sized {}
</code></pre><p>å°†ä¼šæŠ›å‡ºï¼š</p><pre><code class=language-cmd>error: `?Trait` is not permitted in supertraits
 --&gt; src/main.rs:1:14
  |
1 | trait Trait: ?Sized {}
  |              ^^^^^^
  |
  = note: traits are `?Sized` by default
</code></pre><p>æˆ‘ä»¬å¾ˆå¿«å°±ä¼šè®¨è®ºä¸ºä»€ä¹ˆ trait é»˜è®¤æ˜¯ ?Sized çš„ï¼Œä½†é¦–å…ˆéœ€è¦æ€è€ƒä¸€ä¸‹ trait æ˜¯ ?Sized çš„æ„ä¹‰ä½•åœ¨ï¼Ÿå°†ä¸Šé¢çš„ç¤ºä¾‹å±•å¼€ï¼š</p><pre><code class=language-rust>trait Trait where Self: ?Sized {}
</code></pre><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œtrait å…è®¸ self å¯èƒ½ä¸ºä¸€ä¸ªæœªå®šå¤§å°ç±»å‹ã€‚ä¹‹å‰è®²è¿‡ï¼Œä¸èƒ½é€šè¿‡å€¼ä¼ é€’æœªå®šå¤§å°ç±»å‹ï¼Œå› è€Œé™åˆ¶äº† trait ä¸­å¯å®šä¹‰çš„æ–¹æ³•çš„ç±»å‹ã€‚ç†è®ºä¸Šè®²ï¼Œä¸å¯èƒ½ç¼–å†™ä¸€ä¸ªä»¥å€¼ä¼ é€’ self æˆ–è¿”å› self çš„æ–¹æ³•ï¼Œä½†ä»¤äººæƒŠè®¶çš„æ˜¯ï¼Œä»¥ä¸‹ä»£ç ç«Ÿç„¶å¯ä»¥ç¼–è¯‘é€šè¿‡ï¼š</p><pre><code class=language-rust>trait Trait {
    fn method(self); // âœ…
}
</code></pre><p>ç„¶è€Œä¸€æ—¦å¼€å§‹å°è¯•å®ç°è¯¥æ–¹æ³•ï¼Œæ— è®ºæ˜¯é€šè¿‡æä¾›é»˜è®¤å®ç°ï¼Œè¿˜æ˜¯é€šè¿‡ä¸ºæœªå®šå¤§å°ç±»å‹å®ç°è¯¥ traitï¼Œéƒ½å°†å¯¼è‡´ç¼–è¯‘é”™è¯¯ï¼š</p><pre><code class=language-rust>trait Trait {
    fn method(self) {} // âŒ
}

impl Trait for str {
    fn method(self) {} // âŒ
}
</code></pre><p>æŠ›å‡ºï¼š</p><pre><code class=language-rust>error[E0277]: the size for values of type `Self` cannot be known at compilation time
 --&gt; src/lib.rs:2:15
  |
2 |     fn method(self) {}
  |               ^^^^ doesn't have a size known at compile-time
  |
  = help: the trait `std::marker::Sized` is not implemented for `Self`
  = note: to learn more, visit &lt;https://doc.rust-lang.org/book/ch19-04-advanced-types.html#dynamically-sized-types-and-the-sized-trait&gt;
  = note: all local variables must have a statically known size
  = help: unsized locals are gated as an unstable feature
help: consider further restricting `Self`
  |
2 |     fn method(self) where Self: std::marker::Sized {}
  |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

error[E0277]: the size for values of type `str` cannot be known at compilation time
 --&gt; src/lib.rs:6:15
  |
6 |     fn method(self) {}
  |               ^^^^ doesn't have a size known at compile-time
  |
  = help: the trait `std::marker::Sized` is not implemented for `str`
  = note: to learn more, visit &lt;https://doc.rust-lang.org/book/ch19-04-advanced-types.html#dynamically-sized-types-and-the-sized-trait&gt;
  = note: all local variables must have a statically known size
  = help: unsized locals are gated as an unstable feature
</code></pre><p>è‹¥æ˜¯æƒ³é€šè¿‡å€¼ä¼ é€’ selfï¼Œå¯ä»¥é€šè¿‡æ˜¾å¼åœ°å°† trait çº¦æŸä¸º Sized æ¥ä¿®å¤ç¬¬ä¸€ä¸ªé”™è¯¯ï¼š</p><pre><code class=language-rust>trait Trait: Sized {
    fn method(self) {} // âœ…
}

impl Trait for str { // âŒ
    fn method(self) {}
}
</code></pre><p>ç°åœ¨æŠ›å‡ºï¼š</p><pre><code class=language-rust>error[E0277]: the size for values of type `str` cannot be known at compilation time
 --&gt; src/lib.rs:7:6
  |
1 | trait Trait: Sized {
  |              ----- required by this bound in `Trait`
...
7 | impl Trait for str {
  |      ^^^^^ doesn't have a size known at compile-time
  |
  = help: the trait `std::marker::Sized` is not implemented for `str`
  = note: to learn more, visit &lt;https://doc.rust-lang.org/book/ch19-04-advanced-types.html#dynamically-sized-types-and-the-sized-trait&gt;
</code></pre><p>è¿™å€’å¯ä»¥ç†è§£ï¼Œæ¯•ç«Ÿå½“æˆ‘ä»¬å°† trait çº¦æŸä¸º Sized æ—¶ï¼Œå°±æ„å‘³ç€æ— æ³•å†ä¸º str ç­‰æœªå®šå¤§å°ç±»å‹å®ç°å®ƒã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœçœŸæƒ³ä¸º str å®ç°è¯¥ trait å‘¢ï¼Ÿè§£å†³æ–¹æ¡ˆæ˜¯ä¿æŒ trait ä¸º ?Sizedï¼Œå¹¶é€šè¿‡å¼•ç”¨æ¥ä¼ é€’ selfï¼š</p><pre><code class=language-rust>trait Trait {
    fn method(&amp;self) {} // âœ…
}

impl Trait for str {
    fn method(&amp;self) {} // âœ…
}
</code></pre><p>ä¸å…¶å°†æ•´ä¸ª trait æ ‡è®°ä¸º ?Sized æˆ– Sizedï¼Œæ›´ç²¾å¾®å‡†ç¡®çš„åšæ³•æ˜¯å°†å•ä¸ªæ–¹æ³•æ ‡è®°ä¸º Sizedï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code class=language-rust>trait Trait {
    fn method(self) where Self: Sized {}
}

impl Trait for str {} // âœ…!?

fn main() {
    &quot;str&quot;.method(); // âŒ
}
</code></pre><p>ä¸å¯æ€è®®ï¼ŒRust ç¼–è¯‘äº† impl Trait for str {}ï¼Œæ²¡æœ‰å‘å‡ºä»»ä½•è­¦å‘Šï¼å¥½åœ¨åœ¨æœªå®šå¤§å°ç±»å‹ä¸Šè°ƒç”¨ method æ—¶ï¼Œå®ƒæœ€ç»ˆèƒ½æ•è·åˆ°è¯¥é”™è¯¯ï¼Œä¸€åˆ‡æ­£å¸¸ã€‚è¿™ä¸€è¡¨ç°ç•¥æ˜¾å¤æ€ªï¼Œä½†å®ƒå´ä¸ºå®ç° trait æ—¶æä¾›äº†äº›çµæ´»æ€§â€”â€”å¯ä»¥ä¸ºæœªå®šå¤§å°ç±»å‹å®ç°å…·æœ‰ Sized çš„æ–¹æ³•ï¼Œåªè¦ä½ åˆ«å»è°ƒç”¨è¿™äº› Sized æ–¹æ³•å³å¯ã€‚</p><pre><code class=language-rust>trait Trait {
    fn method(self) where Self: Sized {}
    fn method2(&amp;self) {}
}

impl Trait for str {} // âœ…

fn main() {
    // åˆ«å»è°ƒç”¨ &quot;method&quot; å°±æ²¡äº‹å„¿
    &quot;str&quot;.method2(); // âœ…
}
</code></pre><p>ç°åœ¨å›åˆ°æœ€åˆçš„é—®é¢˜ï¼Œä¸ºä»€ä¹ˆ trait é»˜è®¤æ˜¯ ?Sized çš„ï¼Ÿç­”æ¡ˆåœ¨äº trait å¯¹è±¡ã€‚trait å¯¹è±¡æœ¬è´¨ä¸Šæ˜¯æœªå®šå¤§å°çš„ï¼Œæ¯•ç«Ÿä»»ä½•å¤§å°çš„ç±»å‹éƒ½å¯ä»¥å®ç°æŸä¸ª trait ã€‚å› æ­¤ï¼Œè‹¥ Trait: ?Sizedï¼Œåˆ™åªèƒ½ä¸º dyn Trait å®ç° Traitã€‚ç”¨ä»£ç è¡¨ç¤ºå¦‚ä¸‹ï¼š</p><pre><code class=language-rust>trait Trait: ?Sized {}

// ä¸Šé¢æ˜¯ **å¿…é¡»** çš„

impl Trait for dyn Trait {
    // æ­¤å¤„å·²è¢«ç¼–è¯‘å™¨æ–½æ³•
}

// ç”±äº `dyn Trait` æ˜¯æœªå®šå¤§å°çš„
// ç°åœ¨æˆ‘ä»¬å¯ä»¥åœ¨ç¨‹åºä¸­ä½¿ç”¨ `dyn Trait` äº†

fn function(t: &amp;dyn Trait) {} // âœ…
</code></pre><p>å¦‚æœå°è¯•ç¼–è¯‘ä¸Šé¢çš„ç¨‹åºï¼Œä¼šå¾—åˆ°ä»¥ä¸‹é”™è¯¯ï¼š</p><pre><code class=language-rust>error[E0371]: the object type `(dyn Trait + 'static)` automatically implements the trait `Trait`
 --&gt; src/lib.rs:5:1
  |
5 | impl Trait for dyn Trait {
  | ^^^^^^^^^^^^^^^^^^^^^^^^ `(dyn Trait + 'static)` automatically implements trait `Trait`
</code></pre><p>ç¼–è¯‘å™¨å‘Šè¯«æˆ‘ä»¬å†·é™ä¸‹æ¥ï¼Œå› ä¸ºå®ƒä¼šè‡ªåŠ¨ä¸º dyn Trait æä¾› Trait çš„å®ç°ã€‚å†æ¬¡å¼ºè°ƒï¼Œç”±äº dyn Trait æ˜¯æœªå®šå¤§å°çš„ï¼Œç¼–è¯‘å™¨åªèƒ½åœ¨ Trait: ?Sized çš„æƒ…å†µä¸‹æä¾›è¿™ä¸ªå®ç°ã€‚å¦‚æœæˆ‘ä»¬å°† Trait çº¦æŸä¸º Sizedï¼Œå®ƒå°±å˜æˆäº† â€œå¯¹è±¡ä¸å®‰å…¨â€ï¼ˆobject unsafeï¼‰ï¼Œè¿™æ„å‘³ç€æ— æ³•å°†å®ç°äº† Trait çš„ç±»å‹è½¬æ¢ä¸º dyn Trait çš„ trait å¯¹è±¡ã€‚ä¸‹é¢çš„ç¨‹åºå¦‚é¢„æœŸä¸€æ ·ç¼–è¯‘å¤±è´¥ï¼š</p><pre><code class=language-rust>trait Trait: Sized {}

fn function(t: &amp;dyn Trait) {} // âŒ
</code></pre><p>æŠ›å‡ºï¼š</p><pre><code class=language-rust>error[E0038]: the trait `Trait` cannot be made into an object
 --&gt; src/lib.rs:3:18
  |
1 | trait Trait: Sized {}
  |       -----  ----- ...because it requires `Self: Sized`
  |       |
  |       this trait cannot be made into an object...
2 | 
3 | fn function(t: &amp;dyn Trait) {}
  |                ^^^^^^^^^^ the trait `Trait` cannot be made into an object
</code></pre><p>æ¥ä¸‹æ¥å°è¯•åˆ›å»ºä¸€ä¸ªå…·æœ‰ Sized æ–¹æ³•çš„ ?Sized traitï¼Œå¹¶çœ‹çœ‹æ˜¯å¦å¯ä»¥å°†å…¶è½¬æ¢ä¸º trait å¯¹è±¡ï¼š</p><pre><code class=language-rust>trait Trait {
    fn method(self) where Self: Sized {}
    fn method2(&amp;self) {}
}

fn function(arg: &amp;dyn Trait) { // âœ…
    arg.method(); // âŒ
    arg.method2(); // âœ…
}
</code></pre><p>æ­£å¦‚ä¹‹å‰çœ‹åˆ°çš„ï¼Œåªè¦æˆ‘ä»¬ä¸åœ¨ trait å¯¹è±¡ä¸Šè°ƒç”¨ Sized æ–¹æ³•ï¼Œä¸€åˆ‡éƒ½æ²¡é—®é¢˜ã€‚</p><p>ä¸»è¦æ”¶è·</p><ul><li>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ trait éƒ½æ˜¯ ?Sized çš„</li><li>è‹¥ impl Trait for dyn Trait ï¼Œå¿…é¡»æœ‰ Trait: ?Sized</li><li>å¯ä»¥åœ¨å„ä¸ªæ–¹æ³•ä¸Šå•ç‹¬é‡‡ç”¨ Self: Sized</li><li>é€šè¿‡ Sized çº¦æŸçš„ trait æ— æ³•è½¬æ¢ä¸º trait å¯¹è±¡</li></ul><h4 id=trait-å¯¹è±¡çš„é™åˆ¶>Trait å¯¹è±¡çš„é™åˆ¶<a hidden class=anchor aria-hidden=true href=#trait-å¯¹è±¡çš„é™åˆ¶>#</a></h4><p>å³ä½¿æŸ trait æ˜¯å¯¹è±¡å®‰å…¨ï¼ˆobject-safeï¼‰çš„ï¼Œä»ä¼šå­˜åœ¨ä¸€äº›å’Œå¤§å°ç›¸å…³çš„è¾¹ç•Œæƒ…å†µï¼Œå®ƒä»¬é™åˆ¶äº†å¯ä»¥è½¬æ¢ä¸º trait å¯¹è±¡çš„ç±»å‹ä»¥åŠ trait å¯¹è±¡å¯ä»¥è¡¨ç¤ºçš„ trait æ•°é‡ã€ç±»å‹ã€‚</p><p>æ— æ³•å°†æœªå®šå¤§å°ç±»å‹è½¬æ¢ä¸º trait å¯¹è±¡</p><pre><code class=language-rust>fn generic&lt;T: ToString&gt;(t: T) {}
fn trait_object(t: &amp;dyn ToString) {}

fn main() {
    generic(String::from(&quot;String&quot;)); // âœ…
    generic(&quot;str&quot;); // âœ…
    trait_object(&amp;String::from(&quot;String&quot;)); // âœ… - æœªå®šå¤§å°ç±»å‹å¼ºè½¬
    trait_object(&quot;str&quot;); // âŒ - æ— æ³•è¿›è¡Œæœªå®šå¤§å°ç±»å‹å¼ºè½¬
}
</code></pre><p>æŠ›å‡º:</p><pre><code class=language-rust>error[E0277]: the size for values of type `str` cannot be known at compilation time
 --&gt; src/main.rs:8:18
  |
8 |     trait_object(&quot;str&quot;);
  |                  ^^^^^ doesn't have a size known at compile-time
  |
  = help: the trait `std::marker::Sized` is not implemented for `str`
  = note: to learn more, visit &lt;https://doc.rust-lang.org/book/ch19-04-advanced-types.html#dynamically-sized-types-and-the-sized-trait&gt;
  = note: required for the cast to the object type `dyn std::string::ToString`
</code></pre><p>å°† &amp;String ä¼ é€’ç»™æ¥æ”¶ &amp;dyn ToString çš„å‡½æ•°èƒ½å¤Ÿæ­£å¸¸å·¥ä½œï¼Œè¿™æ˜¯å› ä¸ºå¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚String å®ç°äº† ToStringï¼Œè€Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æœªå®šå¤§å°å¼ºè½¬å°†å›ºå®šå¤§å°ç±»å‹ï¼ˆå¦‚ Stringï¼‰è½¬æ¢ä¸ºæœªå®šå¤§å°ç±»å‹ï¼ˆå¦‚ dyn ToStringï¼‰ã€‚str ä¹Ÿå®ç°äº† ToStringï¼Œå°† str è½¬æ¢ä¸º dyn ToString ä¹Ÿéœ€è¦æœªå®šå¤§å°å¼ºè½¬ï¼Œä½† str å·²ç»æ˜¯æœªå®šå¤§å°çš„äº†ï¼é‚£åˆæ€èƒ½å°†ä¸€ä¸ªå·²æ˜¯æœªå®šå¤§å°çš„ç±»å‹è½¬æ¢ä¸ºå¦ä¸€ä¸ªæœªå®šå¤§å°çš„ç±»å‹å‘¢ï¼Ÿ</p><p>&amp;str æŒ‡é’ˆæ˜¯åŒå®½çš„ï¼Œåˆ†åˆ«å­˜å‚¨äº†æŒ‡å‘æ•°æ®çš„æŒ‡é’ˆå’Œæ•°æ®çš„é•¿åº¦ã€‚&amp;dyn ToString æŒ‡é’ˆä¹Ÿæ˜¯åŒå®½çš„ï¼Œå­˜å‚¨äº†æŒ‡å‘æ•°æ®å’ŒæŒ‡å‘è™šè¡¨çš„æŒ‡é’ˆã€‚è€Œå°† &amp;str å¼ºåˆ¶è½¬æ¢ä¸º &amp;dyn ToString éœ€è¦ä¸‰ä¸ªå®½å¸­çš„æŒ‡é’ˆï¼Œç”¨äºå­˜å‚¨æŒ‡å‘æ•°æ®çš„æŒ‡é’ˆã€æ•°æ®çš„é•¿åº¦å’ŒæŒ‡å‘è™šè¡¨çš„æŒ‡é’ˆã€‚Rust ä¸æ”¯æŒä¸‰ä¸ªå®½åº¦çš„æŒ‡é’ˆï¼Œå› æ­¤æ— æ³•å°†æœªå®šå¤§å°ç±»å‹è½¬æ¢ä¸º trait å¯¹è±¡ã€‚</p><p>ä¸Šé¢ä¸¤æ®µä»¥è¡¨æ ¼å½¢å¼æ€»ç»“å¦‚ä¸‹ï¼š</p><table><thead><tr><th>ç±»å‹</th><th>æŒ‡å‘æ•°æ®çš„æŒ‡é’ˆ</th><th>æ•°æ®çš„é•¿åº¦</th><th>æŒ‡å‘è™šè¡¨çš„æŒ‡é’ˆ</th><th>æ€»å®½åº¦</th></tr></thead><tbody><tr><td>&amp;String</td><td>âœ…</td><td>âŒ</td><td>âŒ</td><td>1 âœ…</td></tr><tr><td>&amp;str</td><td>âœ…</td><td>âœ…</td><td>âŒ</td><td>2 âœ…</td></tr><tr><td>&amp;String as &amp;dyn ToString</td><td>âœ…</td><td>âŒ</td><td>âœ…</td><td>2 âœ…</td></tr><tr><td>&amp;str as &amp;dyn ToString</td><td>âœ…</td><td>âœ…</td><td>âœ…</td><td>3 âŒ</td></tr></tbody></table><p>æ— æ³•åˆ›å»ºå¤š trait å¯¹è±¡</p><pre><code class=language-rust>trait Trait {}
trait Trait2 {}

fn function(t: &amp;(dyn Trait + Trait2)) {}
</code></pre><p>æŠ›å‡º:</p><pre><code class=language-rust>error[E0225]: only auto traits can be used as additional traits in a trait object
 --&gt; src/lib.rs:4:30
  |
4 | fn function(t: &amp;(dyn Trait + Trait2)) {}
  |                      -----   ^^^^^^
  |                      |       |
  |                      |       additional non-auto trait
  |                      |       trait alias used in trait object type (additional use)
  |                      first non-auto trait
  |                      trait alias used in trait object type (first use)
</code></pre><p>è®°ä½ï¼Œtrait å¯¹è±¡çš„æŒ‡é’ˆæ˜¯åŒå®½çš„ï¼šå®ƒå­˜å‚¨ç€ä¸€ä¸ªæŒ‡å‘æ•°æ®çš„æŒ‡é’ˆå’Œå¦ä¸€ä¸ªæŒ‡å‘è™šè¡¨çš„æŒ‡é’ˆï¼Œä½†æ­¤å¤„æœ‰ä¸¤ä¸ª traitï¼Œä¹Ÿå°±æœ‰ä¸¤ä¸ªè™šè¡¨ï¼Œè¿™å°±éœ€è¦å°† &(dyn Trait + Trait2) æŒ‡é’ˆæ‰©å±•ä¸º 3 ä¸ªå®½åº¦ï¼ˆæ‰€ä»¥ä¸Šè¿°ä»£ç ä¼šæŠ¥é”™ï¼‰ã€‚è€Œè‡ªåŠ¨ traitï¼ˆå¦‚ Sync å’Œ Sendï¼‰æ˜¯è¢«å…è®¸çš„ï¼Œæ¯•ç«Ÿå®ƒä»¬æ²¡æœ‰æ–¹æ³•ï¼Œä¹Ÿå°±æ²¡æœ‰è™šè¡¨ã€‚</p><p>è§£å†³æ­¤é—®é¢˜çš„æ–¹æ³•æ˜¯ä½¿ç”¨å¦ä¸€ä¸ª trait å°†è™šè¡¨åˆå¹¶èµ·æ¥ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code class=language-rust>trait Trait {
    fn method(&amp;self) {}
}

trait Trait2 {
    fn method2(&amp;self) {}
}

trait Trait3: Trait + Trait2 {}

// ä¸ºåŒæ—¶å®ç°äº† Trait å’Œ Trait2 çš„ç±»å‹ Trait3 è‡ªåŠ¨æä¾›é»˜è®¤å®ç°
impl&lt;T: Trait + Trait2&gt; Trait3 for T {}

// å°† `dyn Trait + Trait2` æ”¹ä¸º `dyn Trait3` 
fn function(t: &amp;dyn Trait3) {
    t.method(); // âœ…
    t.method2(); // âœ…
}
</code></pre><p>è¯¥å˜é€šæ–¹æ³•çš„ä¸€ä¸ªç¼ºç‚¹æ˜¯ï¼šRust ä¸æ”¯æŒå‘ä¸Šè½¬æ¢å› supertrait ç±»å‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äº dyn Trait3ï¼Œå¹¶ä¸èƒ½å°†å…¶ç”¨åœ¨éœ€è¦ dyn Trait æˆ– dyn Trait2 çš„åœ°æ–¹ã€‚ä»¥ä¸‹ç¨‹åºæ— æ³•ç¼–è¯‘ï¼š</p><pre><code class=language-rust>trait Trait {
    fn method(&amp;self) {}
}

trait Trait2 {
    fn method2(&amp;self) {}
}

trait Trait3: Trait + Trait2 {}

impl&lt;T: Trait + Trait2&gt; Trait3 for T {}

struct Struct;
impl Trait for Struct {}
impl Trait2 for Struct {}

fn takes_trait(t: &amp;dyn Trait) {}
fn takes_trait2(t: &amp;dyn Trait2) {}

fn main() {
    let t: &amp;dyn Trait3 = &amp;Struct;
    takes_trait(t); // âŒ
    takes_trait2(t); // âŒ
}
</code></pre><p>æŠ›å‡º:</p><pre><code class=language-rust>error[E0308]: mismatched types
  --&gt; src/main.rs:22:17
   |
22 |     takes_trait(t);
   |                 ^ expected trait `Trait`, found trait `Trait3`
   |
   = note: expected reference `&amp;dyn Trait`
              found reference `&amp;dyn Trait3`

error[E0308]: mismatched types
  --&gt; src/main.rs:23:18
   |
23 |     takes_trait2(t);
   |                  ^ expected trait `Trait2`, found trait `Trait3`
   |
   = note: expected reference `&amp;dyn Trait2`
              found reference `&amp;dyn Trait3`
</code></pre><p>åŸå› æ˜¯åœ¨äºå°½ç®¡ dyn Trait3 åŒ…å«äº† dyn Trait å’Œ dyn Trait2 çš„æ‰€æœ‰æ–¹æ³•ï¼Œä½†å®ƒåœ¨æŸç§æ„ä¹‰ä¸Šç®—ä½œä¸€ä¸ªä¸åŒçš„ç±»å‹ï¼Œå®ƒä¸ dyn Trait å’Œ dyn Trait2 æœ‰ç€ä¸åŒçš„è™šè¡¨ã€‚å†æ¬¡å˜é€šçš„åŠæ³•æ˜¯æ·»åŠ æ˜¾å¼çš„ç±»å‹è½¬æ¢æ–¹æ³•ï¼š</p><pre><code class=language-rust>trait Trait {}
trait Trait2 {}

trait Trait3: Trait + Trait2 {
    fn as_trait(&amp;self) -&gt; &amp;dyn Trait;
    fn as_trait2(&amp;self) -&gt; &amp;dyn Trait2;
}

impl&lt;T: Trait + Trait2&gt; Trait3 for T {
    fn as_trait(&amp;self) -&gt; &amp;dyn Trait {
        self
    }
    fn as_trait2(&amp;self) -&gt; &amp;dyn Trait2 {
        self
    }
}

struct Struct;
impl Trait for Struct {}
impl Trait2 for Struct {}

fn takes_trait(t: &amp;dyn Trait) {}
fn takes_trait2(t: &amp;dyn Trait2) {}

fn main() {
    let t: &amp;dyn Trait3 = &amp;Struct;
    takes_trait(t.as_trait()); // âœ…
    takes_trait2(t.as_trait2()); // âœ…
}
</code></pre><p>è¿™ä¸€è§£å†³åŠæ³•ç®€å•åˆç›´æ¥ï¼Œè€Œä¸”çœ‹èµ·æ¥åƒæ˜¯ Rust ç¼–è¯‘å™¨å¯ä»¥è‡ªåŠ¨æå®šçš„äº‹æƒ…ã€‚Rust åœ¨æ‰§è¡Œè§£å¼•ç”¨å’Œæœªå®šå¤§å°å¼ºè½¬æ—¶è¡¨ç°å¾—æ¯«ä¸çŠ¹è±«ï¼Œä½†åˆä¸ºä»€ä¹ˆæ²¡æœ‰å‘ä¸Šæ¸¸ trait çš„å¼ºåˆ¶è½¬æ¢å‘¢ï¼Ÿè¿™ä¸ªé—®é¢˜å¾ˆå¥½ï¼Œç­”æ¡ˆä¹Ÿå¾ˆç†Ÿæ‚‰ï¼šRust æ ¸å¿ƒå›¢é˜Ÿæ­£åœ¨è‡´åŠ›äºå…¶ä»–ä¼˜å…ˆçº§æ›´é«˜ã€å½±å“æ›´å¤§çš„åŠŸèƒ½ã€‚è¡Œå§ã€‚</p><p>ä¸»è¦æ”¶è·</p><ul><li>Rust ä¸æ”¯æŒè¶…è¿‡ 2 ä¸ªå®½åº¦çš„æŒ‡é’ˆï¼Œå› æ­¤ï¼š<ul><li>æ— æ³•å°†æœªå®šå¤§å°ç±»å‹è½¬æ¢ä¸º trait å¯¹è±¡</li><li>æ— æ³•åˆ›å»ºå¤š trait å¯¹è±¡ï¼Œä½†å¯ä»¥é€šè¿‡å°†å¤šä¸ª trait åˆå¹¶ä¸ºä¸€ä¸ªæ¥è§£å†³è¯¥é—®é¢˜</li></ul></li></ul><h4 id=ç”¨æˆ·è‡ªå®šä¹‰çš„æœªå®šå¤§å°ç±»å‹>ç”¨æˆ·è‡ªå®šä¹‰çš„æœªå®šå¤§å°ç±»å‹<a hidden class=anchor aria-hidden=true href=#ç”¨æˆ·è‡ªå®šä¹‰çš„æœªå®šå¤§å°ç±»å‹>#</a></h4><pre><code class=language-rust>struct Unsized {
    unsized_field: [i32],
}
</code></pre><p>å¯ä»¥é€šè¿‡ç»™ç»“æ„ä½“æ·»åŠ ä¸€ä¸ªæœªå®šå¤§å°çš„å­—æ®µæ¥å®šä¹‰ä¸€ä¸ªæœªå®šå¤§å°çš„ç»“æ„ä½“ã€‚æœªå®šå¤§å°çš„ç»“æ„ä½“åªèƒ½æœ‰ä¸€ä¸ªæœªå®šå¤§å°çš„å­—æ®µï¼Œè€Œä¸”è¯¥å­—æ®µå¿…é¡»æ˜¯ç»“æ„ä½“çš„æœ€åä¸€ä¸ªå­—æ®µã€‚è¿™æ ·åšæ˜¯ä¸ºäº†è®©ç¼–è¯‘å™¨èƒ½å¤Ÿåœ¨ç¼–è¯‘æ—¶ç¡®å®šç»“æ„ä½“ä¸­å„ä¸ªå­—æ®µçš„èµ·å§‹åç§»é‡ï¼Œä»¥ä¾¿é«˜æ•ˆã€å¿«é€Ÿåœ°è®¿é—®å®ƒä»¬ã€‚æ­¤å¤–ï¼Œä½¿ç”¨åŒå®½åº¦æŒ‡é’ˆæœ€å¤šåªèƒ½è¿½è¸ªä¸€ä¸ªæœªå®šå¤§å°çš„å­—æ®µï¼Œæ¯•ç«Ÿæ›´å¤šçš„æœªå®šå¤§å°å­—æ®µå°†éœ€è¦æ›´å¤šçš„å®½åº¦ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬è¯¥å¦‚ä½•å®ä¾‹åŒ–è¿™ä¸ªç»“æ„ä½“å‘¢ï¼Ÿå’Œå…¶å®ƒæœªå®šå¤§å°ç±»å‹ä¸€æ ·ï¼Œé¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªå›ºå®šå¤§å°çš„ç‰ˆæœ¬ï¼Œç„¶åå°†å…¶è½¬æ¢ä¸ºæœªå®šå¤§å°çš„ç‰ˆæœ¬ã€‚ç„¶è€Œï¼Œæ ¹æ®å®šä¹‰ï¼ŒUnsized æ€»æ˜¯æœªå®šå¤§å°çš„ï¼Œæ— æ³•åˆ›å»ºä¸€ä¸ªå›ºå®šå¤§å°çš„ç‰ˆæœ¬ï¼å”¯ä¸€çš„è§£å†³æ–¹æ³•æ˜¯å°†è¯¥ç»“æ„ä½“å®šä¹‰ä¸ºæ³›å‹ï¼Œè¿™æ ·å®ƒå°±å¯ä»¥åŒæ—¶å­˜åœ¨å›ºå®šå¤§å°å’Œæœªå®šå¤§å°çš„ç‰ˆæœ¬ï¼š</p><pre><code class=language-rust>struct MaybeSized&lt;T: ?Sized&gt; {
    maybe_sized: T,
}

fn main() {
    // æœªå®šå¤§å°å¼ºè½¬ï¼Œä» MaybeSized&lt;[i32; 3]&gt; è‡³ MaybeSized&lt;[i32]&gt;
    let ms: &amp;MaybeSized&lt;[i32]&gt; = &amp;MaybeSized { maybe_sized: [1, 2, 3] };
}
</code></pre><p>å®ƒæœ‰ä½•ä½¿ç”¨åœºæ™¯å‘¢ï¼Ÿå®é™…ä¸Šï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«å¼•äººæ³¨ç›®çš„ä½¿ç”¨åœºæ™¯:) ç”¨æˆ·è‡ªå®šä¹‰çš„æœªå®šå¤§å°ç±»å‹ç›®å‰è¿˜æ˜¯ä¸ªä¸æˆç†Ÿçš„ç‰¹æ€§ï¼Œå…¶é™åˆ¶è¶…è¿‡äº†å…¶å¥½å¤„ã€‚æ­¤å¤„æåŠåªæ˜¯ä¸ºäº†æœ¬æ–‡å®Œæ•´æ€§çš„è€ƒè™‘ã€‚</p><p>å°çŸ¥è¯†ï¼š std::ffi::OsStrå’Œstd::path::Path æ˜¯æ ‡å‡†åº“ä¸­çš„ä¸¤ä¸ªæœªå®šå¤§å°ç±»å‹çš„ç»“æ„ä½“ï¼Œä¹‹å‰ä½ å¯èƒ½ä½¿ç”¨è¿‡å®ƒä»¬å´æ²¡æœ‰æ„è¯†åˆ°ï¼</p><p>ä¸»è¦æ”¶è·</p><ul><li>ç”¨æˆ·è‡ªå®šä¹‰çš„æœªå®šå¤§å°ç±»å‹ç›®å‰è¿˜æ˜¯ä¸ªä¸æˆç†Ÿçš„ç‰¹æ€§ï¼Œå…¶é™åˆ¶è¶…è¿‡äº†å…¶å¥½å¤„ã€‚</li></ul><h3 id=é›¶å¤§å°ç±»å‹>é›¶å¤§å°ç±»å‹<a hidden class=anchor aria-hidden=true href=#é›¶å¤§å°ç±»å‹>#</a></h3><p>é›¶å¤§å°ç±»å‹ï¼ˆZSTï¼‰ä¸€å¼€å§‹å¬èµ·æ¥å¾ˆå¥‡ç‰¹ï¼Œä½†å…¶å®å®ƒä»¬åœ¨å„ç§åœºæ™¯éƒ½è¢«ä½¿ç”¨ã€‚</p><h4 id=å•å…ƒç±»å‹unit-type>å•å…ƒç±»å‹ï¼ˆunit typeï¼‰<a hidden class=anchor aria-hidden=true href=#å•å…ƒç±»å‹unit-type>#</a></h4><p>æœ€å¸¸è§çš„é›¶å¤§å°ç±»å‹æ˜¯å•å…ƒç±»å‹ï¼š()ã€‚æ‰€æœ‰ç©ºä»£ç å— {} çš„æ±‚å€¼ç»“æœå‡æ˜¯ ()ã€‚è‹¥ä»£ç å—éç©ºä½†å…¶æœ€åä¸€ä¸ªè¡¨è¾¾å¼ä½¿ç”¨åˆ†å· ; èˆå¼ƒæ—¶ï¼Œå…¶æ±‚å€¼ç»“æœä¹Ÿæ˜¯ ()ã€‚ä¾‹å¦‚ï¼š</p><pre><code class=language-rust>fn main() {
    let a: () = {};
    let b: i32 = {
        5
    };
    let c: () = {
        5;
    };
}
</code></pre><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ²¡æœ‰æ˜¾å¼æŒ‡å®šè¿”å›ç±»å‹çš„å‡½æ•°å‡è¿”å› ()ã€‚</p><pre><code class=language-rust>// å¸¦è¯­æ³•ç³–
fn function() {}

// å»ç³–å
fn function() -&gt; () {}
</code></pre><p>ç”±äº () å ç”¨é›¶å­—èŠ‚ï¼Œæ‰€æœ‰ () çš„å®ä¾‹éƒ½ç›¸åŒï¼Œè¿™ä½¿å¾—å®ç°å…¶ Defaultã€PartialEq åŠ Ord éå¸¸ç®€å•ï¼š</p><pre><code class=language-rust>use std::cmp::Ordering;

impl Default for () {
    fn default() {}
}

impl PartialEq for () {
    fn eq(&amp;self, _other: &amp;()) -&gt; bool {
        true
    }
    fn ne(&amp;self, _other: &amp;()) -&gt; bool {
        false
    }
}

impl Ord for () {
    fn cmp(&amp;self, _other: &amp;()) -&gt; Ordering {
        Ordering::Equal
    }
}
</code></pre><p>ç¼–è¯‘å™¨èƒ½å¤Ÿç†è§£ () ä¸ºé›¶å¤§å°ï¼Œå¹¶ä¼˜åŒ–ä¸ () å®ä¾‹ç›¸å…³çš„äº¤äº’æ“ä½œã€‚ä¾‹å¦‚ï¼ŒVec&lt;()> ä¸ä¼šè¿›è¡Œä»»ä½•å †åˆ†é…ï¼Œä» Vec ä¸­ push æˆ– pop () åªä¼šé€’å¢æˆ–é€’å‡å…¶ len å­—æ®µï¼š</p><pre><code class=language-rust>fn main() {
    // â€œå­˜å‚¨â€æ— é™å¤šä¸ª () æ‰€éœ€çš„å…¨éƒ¨å®¹é‡æ˜¯ï¼šé›¶å®¹é‡
    let mut vec: Vec&lt;()&gt; = Vec::with_capacity(0);
    // ä¸ä¼šå¯¼è‡´å †åˆ†é…æˆ– vec å®¹é‡çš„å˜åŒ–
    vec.push(()); // len++
    vec.push(()); // len++
    vec.push(()); // len++
    vec.pop(); // len--
    assert_eq!(2, vec.len());
}
</code></pre><p>ä¸Šé¢çš„ä¾‹å­å¹¶æ²¡ä»€ä¹ˆå®é™…ç”¨å¤„ï¼Œä½†æ˜¯ï¼Œæ˜¯å¦å¯ä»¥åœ¨æŸç§æƒ…å†µä¸‹ä»¥ä¸€ç§æœ‰æ„ä¹‰çš„æ–¹å¼åˆ©ç”¨ä¸Šè¿°ç†å¿µå‘¢ï¼Ÿå¿…ç„¶å¯ä»¥ï¼Œæ¯”å¦‚å¯ä»¥å°† Value è®¾ç½®ä¸º ()ï¼Œä» HashMap&lt;Key, Value> ä¸­è·å¾—é«˜æ•ˆçš„ HashSet<key> å®ç°ï¼Œè€Œè¿™æ­£æ˜¯ Rust æ ‡å‡†åº“ä¸­ HashSet çš„å·¥ä½œæ–¹å¼ï¼š</p><pre><code class=language-rust>// std::collections::HashSet
pub struct HashSet&lt;T&gt; {
    map: HashMap&lt;T, ()&gt;,
}
</code></pre><p>ä¸»è¦æ”¶è·</p><ul><li>æ‰€æœ‰ ZST å®ä¾‹äº’ç›¸éƒ½æ˜¯ç­‰ä»·çš„</li><li>Rust ç¼–è¯‘å™¨æ¸…æ¥šå¦‚ä½•ä¼˜åŒ–ä¸ ZST çš„äº¤äº’</li></ul><h4 id=å•å…ƒç»“æ„ä½“unit-struct>å•å…ƒç»“æ„ä½“ï¼ˆunit structï¼‰<a hidden class=anchor aria-hidden=true href=#å•å…ƒç»“æ„ä½“unit-struct>#</a></h4><p>å•å…ƒç»“æ„ä½“æ˜¯æŒ‡æ²¡æœ‰ä»»ä½•å­—æ®µï¼ˆæˆå‘˜å˜é‡ï¼‰çš„ç»“æ„ä½“ï¼Œä¾‹å¦‚ï¼š</p><pre><code class=language-rust>struct Struct;
</code></pre><p>æœ‰ä¸€äº›ç‰¹æ€§ä½¿å¾—å•å…ƒç»“æ„ä½“æ¯” () æ›´å…·ä»·å€¼ï¼š</p><ul><li>å¯ä»¥åœ¨è‡ªå®šä¹‰çš„å•å…ƒç»“æ„ä½“ä¸Šå®ç°ä»»æ„æƒ³è¦çš„ traitï¼ŒRust trait æ‰€éµä»çš„å­¤å„¿åŸåˆ™ä¼šé˜»æ­¢æˆ‘ä»¬ä¸º () å®ç° traitï¼Œè¿™æ˜¯ç”±äºå…¶åœ¨æ ‡å‡†åº“ä¸­å·²ç»å®šä¹‰</li><li>å¯ä»¥æ ¹æ®ç¨‹åºä¸Šä¸‹æ–‡ï¼Œä¸ºå•å…ƒç»“æ„ä½“èµ‹äºˆæœ‰æ„ä¹‰çš„åç§°</li><li>å•å…ƒç»“æ„ä½“å’Œæ‰€æœ‰ç»“æ„ä½“ä¸€æ ·ï¼Œé»˜è®¤æƒ…å†µä¸‹éƒ½æ˜¯ä¸å¯å¤åˆ¶çš„ï¼Œè¿™åœ¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­å¯èƒ½å¾ˆé‡è¦ã€‚</li></ul><h4 id=never-ç±»å‹>Never ç±»å‹<a hidden class=anchor aria-hidden=true href=#never-ç±»å‹>#</a></h4><p>Never ç±»å‹å¯ç®—ä½œç¬¬äºŒå¸¸è§çš„é›¶å¤§å°ç±»å‹ï¼ˆZSTï¼‰ï¼š!ã€‚å®ƒä¹‹æ‰€ä»¥è¢«ç§°ä¸º never ç±»å‹ï¼Œæ˜¯å› ä¸ºå…¶ä»£è¡¨çš„è®¡ç®—æ°¸è¿œä¸ä¼šè§£ææˆä»»ä½•å€¼ã€‚</p><p>! ä¸ () ä¸åŒï¼Œå®ƒæœ‰ä¸€äº›æœ‰è¶£çš„ç‰¹æ€§ï¼š</p><ul><li>! å¯ä»¥å¼ºåˆ¶è½¬æ¢ä¸ºä»»æ„å…¶ä»–ç±»å‹</li><li>ä¸å¯èƒ½åˆ›å»º ! çš„å®ä¾‹</li></ul><p>ç¬¬ä¸€ä¸ªç‰¹æ€§éå¸¸æœ‰ç”¨ï¼Œä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿè¿™æ ·ä¾¿æ·åœ°ä½¿ç”¨å®ï¼š</p><pre><code class=language-rust>// ä¾¿äºå¿«é€Ÿå½¢æˆåŸå‹
fn example&lt;T&gt;(t: &amp;[T]) -&gt; Vec&lt;T&gt; {
    unimplemented!() // ! å¼ºè½¬ä¸º Vec&lt;T&gt;
}

fn example2() -&gt; i32 {
    // å¯ä»¥çœ‹å‡ºæ­¤æ¬¡è°ƒç”¨ parse æ°¸è¿œä¸ä¼šå¤±è´¥
    match &quot;123&quot;.parse::&lt;i32&gt;() {
        Ok(num) =&gt; num,
        Err(_) =&gt; unreachable!(), // ! å¼ºè½¬ä¸º i32
    }
}

fn example3(some_condition: bool) -&gt; &amp;'static str {
    if !some_condition {
        panic!() // ! å¼ºè½¬ä¸º &amp;str
    } else {
        &quot;str&quot;
    }
}
</code></pre><p>breakã€ continue åŠ return è¡¨è¾¾å¼ä¹Ÿæ˜¯ ! ç±»å‹:</p><pre><code class=language-rust>fn example() -&gt; i32 {
    // æ­¤å¤„ x å¯ä»¥è®¾ä¸ºä»»æ„ç±»å‹ï¼Œ
    // å› ä¸ºè¯¥ä»£ç å—ä¸è¿”å›ä»»ä½•å€¼ã€‚
    let x: String = {
        return 123 // ! å¼ºè½¬ä¸º String
    };
}

fn example2(nums: &amp;[i32]) -&gt; Vec&lt;i32&gt; {
    let mut filtered = Vec::new();
    for num in nums {
        filtered.push(
            if *num &lt; 0 {
                break // ! å¼ºè½¬ä¸º i32
            } else if *num % 2 == 0 {
                *num
            } else {
                continue // ! å¼ºè½¬ä¸º i32
            }
        );
    }
    filtered
}
</code></pre><p>ç¬¬äºŒä¸ªæœ‰è¶£çš„ç‰¹æ€§æ˜¯ï¼š! å…è®¸åœ¨ç±»å‹å±‚é¢ä¸Šå°†æŸäº›çŠ¶æ€æ ‡è®°ä¸ºâ€œä¸å¯èƒ½çš„â€ã€‚ä»¥ä¸‹é¢è¿™ä¸ªå‡½æ•°ç­¾åä¸ºä¾‹ï¼š</p><pre><code class=language-rust>fn function() -&gt; Result&lt;Success, Error&gt;;
</code></pre><p>æˆ‘ä»¬çŸ¥é“ï¼Œå¦‚æœå‡½æ•°æˆåŠŸè¿”å›ï¼ŒResult å°†åŒ…å«æŸä¸ªç±»å‹ä¸º Success çš„å®ä¾‹ï¼Œå¦‚æœå‡ºç°é”™è¯¯ï¼ŒResult å°†åŒ…å«æŸä¸ªç±»å‹ä¸º Error çš„å®ä¾‹ã€‚æ¥ä¸‹æ¥å°†å…¶ä¸è¯¥å‡½æ•°ç­¾åè¿›è¡Œæ¯”è¾ƒï¼š</p><pre><code class=language-rust>fn function() -&gt; Result&lt;Success, !&gt;;
</code></pre><p>æˆ‘ä»¬çŸ¥é“ï¼Œå¦‚æœå‡½æ•°æˆåŠŸè¿”å›ï¼ŒResult å°†åŒ…å«æŸä¸ªç±»å‹ä¸º Success çš„å®ä¾‹ï¼Œå¦‚æœå‡ºç°é”™è¯¯&mldr;ç­‰ç­‰ï¼Œå®ƒæ°¸è¿œä¸ä¼šå‡ºé”™ï¼Œå› ä¸ºæ— æ³•åˆ›å»º ! çš„å®ä¾‹ã€‚æ ¹æ®ä¸Šè¿°å‡½æ•°ç­¾åå¯çŸ¥è¯¥å‡½æ•°æ°¸è¿œä¸ä¼šå‡ºé”™ã€‚é‚£ä¹ˆä¸‹é¢è¿™ä¸ªå‡½æ•°ç­¾åå‘¢ï¼š</p><pre><code class=language-rust>fn function() -&gt; Result&lt;!, Error&gt;;
</code></pre><p>ä¸ä¹‹å‰ç›¸åï¼Œå¦‚æœè¯¥å‡½æ•°è¿”å›ï¼Œæˆ‘ä»¬çŸ¥é“å®ƒä¸€å®šæ˜¯å‡ºé”™äº†ï¼Œæ¯•ç«Ÿå®ƒä¸å¯èƒ½æˆåŠŸã€‚</p><p>å‰ä¸€ä¸ªä¾‹å­çš„å®é™…åº”ç”¨æ˜¯ä¸º String å®ç° FromStrï¼Œå°† &amp;str è½¬æ¢ä¸º String ä¸å¯èƒ½å¤±è´¥ï¼š</p><pre><code class=language-rust>#![feature(never_type)]

use std::str::FromStr;

impl FromStr for String {
    type Err = !;
    fn from_str(s: &amp;str) -&gt; Result&lt;String, Self::Err&gt; {
        Ok(String::from(s))
    }
}
</code></pre><p>åä¸€ä¸ªä¾‹å­çš„å®é™…åº”ç”¨æ˜¯ï¼šè¿è¡Œæ— é™å¾ªç¯çš„å‡½æ•°ï¼Œæ¯”å¦‚ä¸€ä¸ªå“åº”å®¢æˆ·ç«¯è¯·æ±‚çš„æœåŠ¡å™¨ï¼Œé™¤éå‘ç”Ÿé”™è¯¯å¦åˆ™æ°¸è¿œä¸ä¼šè¿”å›ï¼š</p><pre><code class=language-rust>#![feature(never_type)]

fn run_server() -&gt; Result&lt;!, ConnectionError&gt; {
    loop {
        let (request, response) = get_request()?;
        let result = request.process();
        response.send(result);
    }
}
</code></pre><p>åœ¨ Rust å†…éƒ¨ä½¿ç”¨ never ç±»å‹æ˜¯å¯è¡Œçš„ï¼Œä½†åœ¨ç”¨æˆ·ä»£ç å±‚é¢ä½¿ç”¨å®ƒä»è¢«è§†ä¸ºå®éªŒæ€§è´¨çš„ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨ never_type ç‰¹æ€§æ ‡è¯†ã€‚</p><p>ä¸»è¦æ”¶è·</p><ul><li>! å¯ä»¥å¼ºåˆ¶è½¬æ¢ä¸ºå…¶ä»–ä»»ä½•ç±»å‹</li><li>ä¸èƒ½åˆ›å»º!çš„å®ä¾‹ï¼Œä½†å¯ä»¥ä½¿ç”¨å®ƒåœ¨ç±»å‹å±‚é¢ä¸Šæ ‡è®°æŸäº›ä¸å¯èƒ½çš„çŠ¶æ€</li></ul><h4 id=ç”¨æˆ·è‡ªå®šä¹‰çš„ä¼ª-never-ç±»å‹>ç”¨æˆ·è‡ªå®šä¹‰çš„ä¼ª Never ç±»å‹<a hidden class=anchor aria-hidden=true href=#ç”¨æˆ·è‡ªå®šä¹‰çš„ä¼ª-never-ç±»å‹>#</a></h4><p>å°½ç®¡ä¸èƒ½å®šä¹‰ä¸€ä¸ªå¯ä»¥å¼ºåˆ¶è½¬æ¢ä¸ºä»»æ„å…¶ä»–ç±»å‹çš„ç±»å‹ï¼Œä½†å´å¯ä»¥å®šä¹‰ä¸€ä¸ªæ— æ³•åˆ›å»ºå®ä¾‹çš„ç±»å‹ã€‚ä¾‹å¦‚ï¼Œæ²¡æœ‰ä»»ä½•å˜ä½“çš„æšä¸¾ç±»å‹ï¼š</p><pre><code class=language-rust>enum Void {}
</code></pre><p>è¿™æ ·ä¸€æ¥å°±å¯ä»¥ä»ä¸Šä¸€èŠ‚çš„ä¸¤ä¸ªä¾‹å­ä¸­ç§»é™¤ feature æ ‡è¯†ï¼Œå¹¶ä½¿ç”¨ç¨³å®šç‰ˆçš„ Rust æ¥å®ç°å®ƒä»¬ï¼š</p><pre><code class=language-rust>enum Void {}

// ç¤ºä¾‹ 1
impl FromStr for String {
    type Err = Void;
    fn from_str(s: &amp;str) -&gt; Result&lt;String, Self::Err&gt; {
        Ok(String::from(s))
    }
}

// ç¤ºä¾‹ 2
fn run_server() -&gt; Result&lt;Void, ConnectionError&gt; {
    loop {
        let (request, response) = get_request()?;
        let result = request.process();
        response.send(result);
    }
}
</code></pre><p>å…¶å® Rust æ ‡å‡†åº“æ­£æ˜¯è¿™ä¹ˆæçš„ï¼ŒString åœ¨å®ç° FromStr æ—¶çš„ Err ç±»å‹ç”¨çš„æ˜¯ std::convert::Infallibleï¼Œå…¶å®šä¹‰ä¸ºï¼š</p><pre><code class=language-rust>pub enum Infallible {}
</code></pre><h4 id=phantomdata>PhantomData<a hidden class=anchor aria-hidden=true href=#phantomdata>#</a></h4><p>ç¬¬ä¸‰ä¸ªæœ€å¸¸ç”¨çš„é›¶å¤§å°ç±»å‹ï¼ˆZSTï¼‰å¯èƒ½ä¾¿æ˜¯ PhantomDataã€‚PhantomData æ˜¯ä¸ªé›¶å¤§å°çš„æ ‡è®°ç»“æ„ä½“ï¼ŒåŒ…å«å®ƒçš„ç»“æ„ä½“å¯ä»¥ç”¨å®ƒæ¥â€œæ ‡è®°â€å…¶å…·æœ‰ç‰¹å®šå±æ€§ã€‚å®ƒå°±åƒæ˜¯ è‡ªåŠ¨æ ‡è®° trait ï¼ˆä¾‹å¦‚Sizedã€Sendå’ŒSyncï¼‰çš„è¡¨äº²ï¼Œä½†ç”±äºå®ƒæ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œä½¿ç”¨æ–¹å¼ä¼šç•¥æœ‰ä¸åŒã€‚è¯¦ç»†è§£é‡Š PhantomData å¹¶æ¢è®¨å…¶æ‰€æœ‰ç”¨æ³•å·²è¶…å‡ºæœ¬æ–‡çš„èŒƒå›´ï¼Œè¿™é‡Œåªç®€è¦ä»‹ç»ä¸€ä¸ªç®€å•çš„ä¾‹å­ã€‚å›æƒ³ä¸€ä¸‹ä¹‹å‰æåˆ°è¿‡çš„ä»£ç ç‰‡æ®µï¼š</p><pre><code class=language-rust>#![feature(negative_impls)]

// è¯¥ç±»å‹æ˜¯ Send åŠ Sync
struct Struct;

// å–æ¶ˆ Send trait
impl !Send for Struct {}

// å–æ¶ˆ Sync trait
impl !Sync for Struct {}
</code></pre><p>å¾ˆé—æ†¾æ­¤å¤„ä¸å¾—ä¸ä½¿ç”¨ feature æ ‡è¯†ï¼Œä½†èƒ½å¦åªä½¿ç”¨ç¨³å®šç‰ˆçš„ Rust æ¥å®ç°ç›¸åŒçš„æ•ˆæœå‘¢ï¼Ÿæˆ‘ä»¬å·²çŸ¥ï¼Œåªæœ‰å½“ä¸€ä¸ªç±»å‹çš„æ‰€æœ‰æˆå‘˜éƒ½æ˜¯ Send ä¸” Sync æ—¶ï¼Œè¯¥ç±»å‹æ‰æ˜¯ Send ä¸” Sync çš„ã€‚å› æ­¤å¯ä»¥å‘ Struct æ·»åŠ ä¸€ä¸ª !Send ä¸” !Sync çš„æˆå‘˜ï¼Œä¾‹å¦‚ Rc&lt;()>ï¼š</p><pre><code class=language-rust>use std::rc::Rc;

// è¯¥ç±»å‹ä¸æ˜¯ Send æˆ– Sync
struct Struct {
    // ä¸ºæ¯ä¸ªå®ä¾‹å¢åŠ  8 ä¸ªå­—èŠ‚
    _not_send_or_sync: Rc&lt;()&gt;,
}
</code></pre><p>ä»¥ä¸Šæ–¹å¼å¹¶ä¸ç†æƒ³ï¼Œå› ä¸ºå®ƒä¼šå¢åŠ å„ Struct å®ä¾‹çš„å¤§å°ï¼Œè€Œä¸”æ¯æ¬¡æƒ³è¦åˆ›å»º Struct æ—¶ï¼Œè¿˜éœ€è¦æ— ä¸­ç”Ÿæœ‰ä¸ª Rc&lt;()> å‡ºæ¥ã€‚ç”±äº PhantomData æ˜¯é›¶å¤§å°ç±»å‹ï¼ˆZSTï¼‰ï¼Œå®ƒè§£å†³äº†è¿™ä¿©é—®é¢˜ï¼š</p><pre><code class=language-rust>use std::rc::Rc;
use std::marker::PhantomData;

type NotSendOrSyncPhantom = PhantomData&lt;Rc&lt;()&gt;&gt;;

// è¯¥ç±»å‹ä¸æ˜¯ Send æˆ– Sync
struct Struct {
    // æ²¡æœ‰å¢åŠ å…¶å®ä¾‹çš„å¤§å°
    _not_send_or_sync: NotSendOrSyncPhantom,
}
</code></pre><p>ä¸»è¦æ”¶è·</p><ul><li>PhantomData æ˜¯ä¸ªé›¶å¤§å°çš„æ ‡è®°ç»“æ„ä½“ï¼ŒåŒ…å«å®ƒçš„ç»“æ„ä½“å¯ä»¥ç”¨å®ƒæ¥â€œæ ‡è®°â€å…¶å…·æœ‰ç‰¹å®šå±æ€§</li></ul><h3 id=ç»“è®º>ç»“è®º<a hidden class=anchor aria-hidden=true href=#ç»“è®º>#</a></h3><ul><li>åªæœ‰å›ºå®šå¤§å°ç±»å‹çš„å®ä¾‹å¯ä»¥æ”¾åœ¨æ ˆä¸Šï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥æŒ‰å€¼ä¼ é€’</li><li>æœªå®šå¤§å°ç±»å‹çš„å®ä¾‹æ— æ³•æ”¾åœ¨æ ˆä¸Šï¼Œå¿…é¡»é€šè¿‡å¼•ç”¨è¿›è¡Œä¼ é€’</li><li>æŒ‡å‘æœªå®šå¤§å°ç±»å‹çš„æŒ‡é’ˆæ˜¯åŒå®½åº¦çš„ï¼Œå› ä¸ºé™¤äº†æŒ‡å‘æ•°æ®ä¹‹å¤–ï¼Œå®ƒä»¬è¿˜æœ‰é¢å¤–çš„ä¿¡æ¯è¦ç®¡ç†ï¼Œç”¨ä»¥è·Ÿè¸ªæ•°æ®çš„é•¿åº¦æˆ–è€…æŒ‡å‘è™šè¡¨</li><li>Sized æ˜¯ â€œè‡ªåŠ¨â€ æ ‡è®° trait</li><li>æ‰€æœ‰çš„æ³›å‹ç±»å‹å‚æ•°é»˜è®¤æƒ…å†µä¸‹éƒ½ä¼šè‡ªåŠ¨ç»‘å®šä¸º Sized</li><li>è‹¥æœ‰æ³›å‹å‡½æ•°ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªæŒ‡é’ˆåé¢çš„å‚æ•° Tï¼Œè¯¸å¦‚ &amp;Tã€Box<t>ã€Rc<t> ç­‰ç­‰ï¼Œæ­¤æ—¶å‡ ä¹æ€»æ˜¯å¸Œæœ›ä½¿ç”¨ T: ?Sized å–æ¶ˆæ‰é»˜è®¤çš„ Sized çº¦æŸ</li><li>åˆ©ç”¨åˆ‡ç‰‡å’Œ Rust çš„è‡ªåŠ¨ç±»å‹è½¬æ¢å¯ä»¥ç¼–å†™çµæ´»çš„ API</li><li>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ trait éƒ½æ˜¯ ?Sized çš„</li><li>è‹¥ impl Trait for dyn Trait ï¼Œå¿…é¡»æœ‰ Trait: ?Sized</li><li>å¯ä»¥åœ¨å„ä¸ªæ–¹æ³•ä¸Šå•ç‹¬é‡‡ç”¨ Self: Sized</li><li>é€šè¿‡ Sized çº¦æŸçš„ trait æ— æ³•è½¬æ¢ä¸º trait å¯¹è±¡</li><li>Rust ä¸æ”¯æŒè¶…è¿‡ 2 ä¸ªå®½åº¦çš„æŒ‡é’ˆï¼Œå› æ­¤ï¼š<ul><li>æ— æ³•å°†æœªå®šå¤§å°ç±»å‹è½¬æ¢ä¸º trait å¯¹è±¡</li><li>æ— æ³•åˆ›å»ºå¤š trait å¯¹è±¡ï¼Œä½†å¯ä»¥é€šè¿‡å°†å¤šä¸ª trait åˆå¹¶ä¸ºä¸€ä¸ªæ¥è§£å†³è¯¥é—®é¢˜</li></ul></li><li>ç”¨æˆ·è‡ªå®šä¹‰çš„æœªå®šå¤§å°ç±»å‹ç›®å‰è¿˜æ˜¯ä¸ªä¸æˆç†Ÿçš„ç‰¹æ€§ï¼Œå…¶é™åˆ¶è¶…è¿‡äº†å…¶å¥½å¤„ã€‚</li><li>æ‰€æœ‰ ZST å®ä¾‹äº’ç›¸éƒ½æ˜¯ç­‰ä»·çš„</li><li>Rust ç¼–è¯‘å™¨æ¸…æ¥šå¦‚ä½•ä¼˜åŒ–ä¸ ZST çš„äº¤äº’</li><li>! å¯ä»¥å¼ºåˆ¶è½¬æ¢ä¸ºå…¶ä»–ä»»ä½•ç±»å‹</li><li>ä¸èƒ½åˆ›å»º!çš„å®ä¾‹ï¼Œä½†å¯ä»¥ä½¿ç”¨å®ƒåœ¨ç±»å‹å±‚é¢ä¸Šæ ‡è®°æŸäº›ä¸å¯èƒ½çš„çŠ¶æ€</li><li>PhantomData æ˜¯ä¸ªé›¶å¤§å°çš„æ ‡è®°ç»“æ„ä½“ï¼ŒåŒ…å«å®ƒçš„ç»“æ„ä½“å¯ä»¥ç”¨å®ƒæ¥â€œæ ‡è®°â€å…¶å…·æœ‰ç‰¹å®šå±æ€§</li></ul></div><div class=post-reward><div style=padding:0;margin:0;width:100%;font-size:16px;text-align:center><div id=QR style=opacity:0><div id=wechat style=display:inline-block><a class=fancybox rel=group><img id=wechat_qr src=https://lorenwe.eu.org/img/wechat_pay.png alt=wechat_pay></a><p>å¾®ä¿¡</p></div><div id=alipay style=display:inline-block><a class=fancybox rel=group><img id=alipay_qr src=https://lorenwe.eu.org/img/alipay.png alt=alipay></a><p>æ”¯ä»˜å®</p></div></div><button id=rewardButton onclick='var qr=document.getElementById("QR");qr.style.opacity==="0"?qr.style.opacity="1":qr.style.opacity="0"'>
<span>ğŸ§§ é¼“åŠ±</span></button></div></div><footer class=post-footer><nav class=paginav><a class=prev href=https://lorenwe.eu.org/posts/tech/rust%E5%A6%82%E4%BD%95%E6%AD%A3%E7%A1%AE%E8%A7%A3%E6%9E%90yaml%E6%96%87%E4%BB%B6/><span class=title>Â« ä¸Šä¸€é¡µ</span><br><span>Rustå¦‚ä½•æ­£ç¡®è§£æyamlæ–‡ä»¶</span>
</a><a class=next href=https://lorenwe.eu.org/posts/tech/%E7%90%86%E8%A7%A3rust%E4%B8%AD%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84strstr%E4%B8%8Estring%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%8C%BA%E5%88%AB/><span class=title>ä¸‹ä¸€é¡µ Â»</span><br><span>ç†è§£ Rust ä¸­å­—ç¬¦ä¸²çš„ str, &amp;str ä¸ String ç±»å‹çš„åŒºåˆ«</span></a></nav></footer></div><div id=giscus-comment></div><script>function sendMessage(e){const t=document.querySelector("iframe.giscus-frame");if(!t||!t.contentWindow)return;t.contentWindow.postMessage({giscus:e},"https://giscus.app")}function createGusicScript(){const t=document.querySelector("#giscus-comment"),n=localStorage.getItem("pref-theme");let e=document.createElement("script");e.src="https://giscus.app/client.js",e.setAttribute("data-repo","lorenwe/lorenwe.github.io"),e.setAttribute("data-repo-id","MDEwOlJlcG9zaXRvcnk3NDY0NzM4MQ=="),e.setAttribute("data-category","Announcements"),e.setAttribute("data-category-id","DIC_kwDOBHMHVc4CizTN"),e.setAttribute("data-mapping","title"),e.setAttribute("data-strict","0"),e.setAttribute("data-reactions-enabled","1"),e.setAttribute("data-emit-metadata","0"),e.setAttribute("data-input-position","bottom"),e.setAttribute("data-theme",n),e.setAttribute("data-lang","zh-CN"),e.setAttribute("data-loading","lazy"),e.setAttribute("crossorigin","anonymous"),e.async=!0,t&&t.appendChild(e)}createGusicScript()</script></article></main><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><span class=topInner><svg class="topSvg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
<span id=read_progress></span>
</span></a><script>document.addEventListener("scroll",function(){const t=document.getElementById("read_progress"),n=document.documentElement.scrollHeight,s=document.documentElement.clientHeight,o=document.documentElement.scrollTop||document.body.scrollTop;t.innerText=((o/(n-s)).toFixed(2)*100).toFixed(0)})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>let mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>200||document.documentElement.scrollTop>200?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{(function(){document.cookie="change-themes="+escape("false")})(),document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light"),sendMessage({setConfig:{theme:"light"}})):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"),sendMessage({setConfig:{theme:"dark"}}))})</script><script>document.body.addEventListener("copy",function(e){if(window.getSelection().toString()&&window.getSelection().toString().length>50){let t=e.clipboardData||window.clipboardData;if(t){e.preventDefault();let n=window.getSelection().toString()+`\r

â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r
ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€ŒLorenwe Blogã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚\r
åŸæ–‡é“¾æ¥ï¼š`+location.href,s=window.getSelection().toString()+`\r

â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r
ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€ŒLorenwe Blogã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚\r
åŸæ–‡é“¾æ¥ï¼š`+location.href;t.setData("text/html",n),t.setData("text/plain",s)}}})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="å¤åˆ¶";function i(){t.innerText="å·²å¤åˆ¶ï¼",setTimeout(()=>{t.innerText="å¤åˆ¶"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){let t=e.textContent+`\r
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r
ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€ŒLorenwe Blogã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚\r
åŸæ–‡é“¾æ¥ï¼š`+location.href;navigator.clipboard.writeText(t),i();return}const n=document.createRange();n.selectNodeContents(e);const s=window.getSelection();s.removeAllRanges(),s.addRange(n);try{document.execCommand("copy"),i()}catch{}s.removeRange(n)});let l=e.className.replaceAll("language-",""),n=document.createElement("div"),a=document.createElement("div"),r=document.createElement("div"),c=document.createElement("div"),o=document.createElement("div");o.innerText=l,n.setAttribute("class","mac-tool"),a.setAttribute("class","mac bb1"),r.setAttribute("class","mac bb2"),c.setAttribute("class","mac bb3"),o.setAttribute("class","language-type"),n.appendChild(a),n.appendChild(r),n.appendChild(c),n.appendChild(o),s.classList.contains("highlight")?(s.appendChild(t),s.appendChild(n)):s.parentNode.firstChild==s||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?(e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t),s.appendChild(n)):(e.parentNode.appendChild(t),s.appendChild(n)))})</script></body></html>